<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>GoBeauty 2025 - Premium Beauty Platform</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Premium 2025 Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <!-- Font Awesome 6.5 Latest -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="database.js"></script>
  <style>
    /* Base Reset - Ultra Smooth */
    html,body{height:100%;width:100%;margin:0;padding:0;overscroll-behavior:none}
    *{-ms-overflow-style:none;scrollbar-width:none;-webkit-tap-highlight-color:transparent;box-sizing:border-box}
    *::-webkit-scrollbar{display:none}
    body{font-family:'Inter',sans-serif;background:#f8fafc;color:#1e293b;overflow:hidden;font-size:14px;line-height:1.4}
    .font-display{font-family:'Playfair Display',serif}
    
    /* Smooth Scrolling */
    .smooth-scroll{scroll-behavior:smooth;-webkit-overflow-scrolling:touch}
    
    /* Premium Glass Effects - More Transparent */
    .glass{background:rgba(255,255,255,0.65);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,0.2)}
    .glass-dark{background:rgba(15,23,42,0.75);backdrop-filter:blur(24px) saturate(180%);-webkit-backdrop-filter:blur(24px) saturate(180%);border:1px solid rgba(255,255,255,0.08)}
    .glass-card{background:rgba(255,255,255,0.75);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.6);box-shadow:0 2px 12px rgba(0,0,0,0.04)}
    .glass-nav{background:rgba(15,15,15,0.45);backdrop-filter:blur(24px) saturate(200%);-webkit-backdrop-filter:blur(24px) saturate(200%);box-shadow:0 -4px 20px rgba(0,0,0,0.08);border:1px solid rgba(255,255,255,0.06)}
    
    /* Compact Gradients */
    .gradient-primary{background:linear-gradient(135deg,#ec4899 0%,#8b5cf6 100%)}
    .gradient-secondary{background:linear-gradient(135deg,#3b82f6 0%,#8b5cf6 100%)}
    .gradient-success{background:linear-gradient(135deg,#10b981 0%,#059669 100%)}
    .gradient-warm{background:linear-gradient(135deg,#f97316 0%,#ec4899 100%)}
    .gradient-dark{background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%)}
    
    /* Text Gradients */
    .text-gradient{background:linear-gradient(135deg,#ec4899 0%,#8b5cf6 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    
    /* Minimal Shadows */
    .shadow-sm{box-shadow:0 1px 3px rgba(0,0,0,0.06)}
    .shadow-md{box-shadow:0 2px 8px rgba(0,0,0,0.08)}
    .shadow-lg{box-shadow:0 4px 16px rgba(0,0,0,0.1)}
    
    /* Smooth Animations */
    @keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
    @keyframes slideDown{from{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}
    @keyframes scaleIn{from{transform:scale(0.95);opacity:0}to{transform:scale(1);opacity:1}}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes pulse-radar{0%{transform:scale(0.6);opacity:0}50%{opacity:0.4}100%{transform:scale(1.6);opacity:0}}
    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
    
    .anim-slide-up{animation:slideUp 0.35s cubic-bezier(0.16,1,0.3,1) forwards}
    .anim-slide-down{animation:slideDown 0.35s cubic-bezier(0.16,1,0.3,1) forwards}
    .anim-scale{animation:scaleIn 0.3s cubic-bezier(0.16,1,0.3,1) forwards}
    .anim-fade{animation:fadeIn 0.3s ease forwards}
    .spinner{animation:spin 0.8s linear infinite}
    
    /* Compact Map Markers */
    .leaflet-container{font-family:'Inter',sans-serif;z-index:1;background:#f1f5f9}
    .custom-marker-container{position:relative;width:40px;height:40px;display:flex;justify-content:center;align-items:center}
    .custom-marker-radar{position:absolute;inset:0;border-radius:50%;background:rgba(236,72,153,0.3);animation:pulse-radar 2s infinite ease-out}
    .custom-marker-img{position:relative;width:34px;height:34px;border-radius:50%;overflow:hidden;background:white;border:2px solid white;box-shadow:0 2px 8px rgba(0,0,0,0.15);z-index:2}
    .custom-marker-img img{width:100%;height:100%;object-fit:cover}
    .live-dot{position:absolute;top:-1px;right:0;width:8px;height:8px;background:#22c55e;border:1.5px solid white;border-radius:50%;z-index:3}
    
    /* Compact Buttons */
    .btn-press:active{transform:scale(0.97)}
    .btn-primary{background:linear-gradient(135deg,#ec4899 0%,#8b5cf6 100%);color:white;font-weight:600;border-radius:12px;padding:12px 20px;font-size:13px;transition:all 0.2s;box-shadow:0 4px 12px rgba(236,72,153,0.25)}
    .btn-secondary{background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);color:white;font-weight:600;border-radius:12px;padding:12px 20px;font-size:13px;transition:all 0.2s}
    
    /* Compact Inputs */
    .input-premium{background:rgba(255,255,255,0.9);border:1.5px solid #e2e8f0;border-radius:12px;padding:12px 16px;padding-left:44px;font-size:14px;font-weight:500;transition:all 0.2s}
    .input-premium:focus{background:white;border-color:#ec4899;box-shadow:0 0 0 3px rgba(236,72,153,0.1)}
    
    /* Compact Social Buttons */
    .btn-social{display:flex;align-items:center;justify-content:center;gap:10px;padding:11px 16px;border-radius:12px;font-weight:600;font-size:13px;transition:all 0.2s;border:1.5px solid #e2e8f0}
    .btn-google{background:white;color:#1e293b}
    .btn-facebook{background:white;color:#1e293b}
    .btn-apple{background:white;color:#1e293b}
    
    /* Toast - Compact */
    .toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);z-index:9999;font-size:13px}
    
    /* Mobile Container */
    @media(min-width:768px){.mobile-container{max-width:390px;margin:0 auto;box-shadow:0 0 40px rgba(0,0,0,0.06);border-radius:32px;overflow:hidden}}
    
    /* No Scrollbar but Smooth */
    .no-scrollbar{-ms-overflow-style:none;scrollbar-width:none;-webkit-overflow-scrolling:touch}
    .no-scrollbar::-webkit-scrollbar{display:none}
    
    /* Compact Cards */
    .card-compact{padding:12px;border-radius:14px}
    
    /* Smaller Icons */
    .icon-xs{font-size:10px}
    .icon-sm{font-size:12px}
    .icon-md{font-size:14px}
    .icon-lg{font-size:16px}
    
    /* Touch Scroll - Horizontal */
    .touch-scroll{overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;scroll-behavior:smooth;-ms-overflow-style:none;scrollbar-width:none}
    .touch-scroll::-webkit-scrollbar{display:none}
    
    /* 3D Cube Effect */
    .scene{perspective:1000px;width:120px;height:120px;margin:0 auto}
    .cube{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform 0.8s cubic-bezier(0.16,1,0.3,1)}
    .cube-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:24px;overflow:hidden;box-shadow:0 20px 40px rgba(0,0,0,0.15);border:3px solid white}
    .cube-face-front{transform:rotateY(0deg) translateZ(60px)}
    .cube-face-back{transform:rotateY(180deg) translateZ(60px)}
    .cube.show-pro{transform:rotateY(-180deg)}
    
    /* Decorative Blobs */
    .blob-1{position:absolute;width:250px;height:250px;background:linear-gradient(135deg,rgba(236,72,153,0.25) 0%,rgba(139,92,246,0.25) 100%);border-radius:60% 40% 30% 70%/60% 30% 70% 40%;filter:blur(40px);animation:blob 8s ease-in-out infinite}
    .blob-2{position:absolute;width:200px;height:200px;background:linear-gradient(135deg,rgba(59,130,246,0.2) 0%,rgba(139,92,246,0.2) 100%);border-radius:40% 60% 70% 30%/40% 50% 60% 50%;filter:blur(40px);animation:blob 10s ease-in-out infinite reverse}
    @keyframes blob{0%,100%{border-radius:60% 40% 30% 70%/60% 30% 70% 40%}50%{border-radius:30% 60% 70% 40%/50% 60% 30% 60%}}
    
    /* Skeleton Loading Animation */
    @keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
    .skeleton{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:8px}
    .skeleton-text{height:14px;margin-bottom:8px}
    .skeleton-title{height:20px;width:60%;margin-bottom:12px}
    .skeleton-avatar{width:48px;height:48px;border-radius:12px}
    .skeleton-card{height:120px;border-radius:16px}
    .skeleton-btn{height:44px;border-radius:12px}
    
    /* Pull to Refresh Indicator */
    .pull-indicator{position:absolute;top:-50px;left:50%;transform:translateX(-50%);transition:all 0.3s}
    .pull-indicator.visible{top:20px}
    
    /* Empty State Styles */
    .empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center}
    .empty-state-icon{font-size:64px;color:#e2e8f0;margin-bottom:16px}
    .empty-state-title{font-size:18px;font-weight:700;color:#64748b;margin-bottom:8px}
    .empty-state-desc{font-size:14px;color:#94a3b8;max-width:250px}
    
    /* Dynamic Theme Colors (will be overridden by JS) */
    :root{--primary-color:#ec4899;--secondary-color:#8b5cf6;--accent-color:#10b981}
    .theme-primary{background:var(--primary-color)}
    .theme-gradient{background:linear-gradient(135deg,var(--primary-color) 0%,var(--secondary-color) 100%)}
  </style>
</head>
<body>
<div id="root" style="height:100%"></div>
<script type="text/babel">
const{useState,useEffect,useRef,createContext,useContext}=React;

// DB is loaded from database.js

const ToastContext=createContext(null);
const useToast=()=>useContext(ToastContext);

const Icon=({name,className=''})=>{
  const map={home:"fa-house",search:"fa-magnifying-glass",calendar:"fa-calendar-check",user:"fa-user",bell:"fa-bell",filter:"fa-sliders",heart:"fa-heart",star:"fa-star",map:"fa-map-location-dot",location:"fa-location-dot",clock:"fa-clock",all:"fa-layer-group",spa:"fa-spa",nails:"fa-hand-sparkles",hair:"fa-scissors",makeup:"fa-wand-magic-sparkles",arrowRight:"fa-arrow-right",settings:"fa-gear",wallet:"fa-wallet",help:"fa-circle-question",logout:"fa-right-from-bracket",edit:"fa-pen",chevronRight:"fa-chevron-right",arrowLeft:"fa-arrow-left",check:"fa-check",save:"fa-floppy-disk",mail:"fa-envelope",lock:"fa-lock",briefcase:"fa-briefcase",dashboard:"fa-chart-line",users:"fa-users",services:"fa-concierge-bell",categories:"fa-tags",bookings:"fa-calendar-alt",money:"fa-money-bill-wave",plus:"fa-plus",trash:"fa-trash",eye:"fa-eye",eyeSlash:"fa-eye-slash",times:"fa-times",bars:"fa-bars",store:"fa-store",info:"fa-info-circle",warning:"fa-exclamation-triangle",success:"fa-check-circle",error:"fa-times-circle",phone:"fa-phone"};
  return <i className={`fa-solid ${map[name]||name} ${className}`}></i>
};

const Toast=({message,type='info',onClose})=>{
  useEffect(()=>{const t=setTimeout(onClose,3000);return()=>clearTimeout(t)},[onClose]);
  const colors={success:'bg-green-500',error:'bg-red-500',warning:'bg-yellow-500',info:'bg-blue-500'};
  return <div className={`toast ${colors[type]} text-white px-6 py-3 rounded-2xl shadow-lg flex items-center gap-3 anim-slide-up`}><Icon name={type}/><span className="font-medium">{message}</span></div>
};

const Loading=({size='md'})=>{
  const sizes={sm:'w-4 h-4',md:'w-8 h-8',lg:'w-12 h-12'};
  return <div className={`${sizes[size]} border-2 border-pink-200 border-t-pink-600 rounded-full spinner`}></div>
};

const Modal=({isOpen,onClose,title,children})=>{
  if(!isOpen)return null;
  return(
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div className="absolute inset-0 bg-black/50 backdrop-blur-sm" onClick={onClose}></div>
      <div className="relative bg-white rounded-3xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden anim-scale">
        <div className="flex items-center justify-between p-6 border-b"><h2 className="text-xl font-bold">{title}</h2><button onClick={onClose} className="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center"><Icon name="times"/></button></div>
        <div className="p-6 overflow-y-auto max-h-[calc(90vh-140px)]">{children}</div>
      </div>
    </div>
  )
};

const ConfirmDialog=({isOpen,onClose,onConfirm,title,message})=>{
  if(!isOpen)return null;
  return(
    <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
      <div className="bg-white rounded-2xl p-6 shadow-2xl w-full max-w-xs anim-scale">
        <h3 className="text-lg font-bold mb-2">{title}</h3>
        <p className="text-gray-500 text-sm mb-6">{message}</p>
        <div className="flex gap-3">
          <button onClick={onClose} className="flex-1 py-3 bg-gray-100 text-gray-700 font-bold rounded-xl text-sm">Cancel</button>
          <button onClick={onConfirm} className="flex-1 py-3 bg-red-500 text-white font-bold rounded-xl text-sm">Confirm</button>
        </div>
      </div>
    </div>
  )
};

// Skeleton Loading Components
const SkeletonCard=()=>(
  <div className="bg-white rounded-2xl overflow-hidden shadow-sm border">
    <div className="skeleton h-32 w-full rounded-none"></div>
    <div className="p-3">
      <div className="skeleton skeleton-title"></div>
      <div className="skeleton skeleton-text w-3/4"></div>
      <div className="flex gap-2 mt-2">
        <div className="skeleton w-16 h-5 rounded-full"></div>
        <div className="skeleton w-12 h-5 rounded-full"></div>
      </div>
    </div>
  </div>
);

const SkeletonListItem=()=>(
  <div className="bg-white rounded-2xl p-4 flex items-center gap-3 border">
    <div className="skeleton w-14 h-14 rounded-xl"></div>
    <div className="flex-1">
      <div className="skeleton skeleton-title"></div>
      <div className="skeleton skeleton-text w-1/2"></div>
    </div>
    <div className="skeleton w-16 h-8 rounded-lg"></div>
  </div>
);

const SkeletonFeatured=()=>(
  <div className="flex gap-3 overflow-hidden">
    {[1,2,3].map(i=>(
      <div key={i} className="min-w-[200px] w-[200px]">
        <SkeletonCard/>
      </div>
    ))}
  </div>
);

const SkeletonCategories=()=>(
  <div className="flex gap-2">
    {[1,2,3,4,5].map(i=>(
      <div key={i} className="skeleton w-20 h-8 rounded-full"></div>
    ))}
  </div>
);

// Empty State Component
const EmptyState=({icon='fa-inbox',title,description,action,actionLabel})=>(
  <div className="empty-state py-16">
    <div className="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
      <i className={`fa-solid ${icon} text-4xl text-gray-300`}></i>
    </div>
    <h3 className="empty-state-title">{title}</h3>
    <p className="empty-state-desc">{description}</p>
    {action&&(
      <button onClick={action} className="mt-4 px-6 py-2.5 gradient-primary text-white rounded-xl font-bold text-sm">
        {actionLabel||'Get Started'}
      </button>
    )}
  </div>
);

// App Settings Hook - Sync with Admin Dashboard
const useAppSettings=()=>{
  const[settings,setSettings]=useState(()=>{
    try{
      const saved=localStorage.getItem('gb_app_settings');
      return saved?JSON.parse(saved):{
        appName:'GoBeauty',
        primaryColor:'#ec4899',
        secondaryColor:'#8b5cf6',
        accentColor:'#10b981',
        customerFeatures:{wallet:true,reviews:true,chat:true,homeService:true,favorites:true,notifications:true,offers:true,membership:true,giftCards:true,map:true,search:true,filters:true},
        proFeatures:{earnings:true,calendar:true,analytics:true,chat:true,notifications:true,gallery:true,services:true,reviews:true,blockSlots:true,withdraw:true},
        customerNav:{home:true,map:true,bookings:true,favorites:true,profile:true},
        proNav:{dashboard:true,bookings:true,services:true,reviews:true,earnings:true,profile:true},
        uiSettings:{showDistance:true,showRating:true,showPrice:true,showVerifiedBadge:true,showNewBadge:true}
      };
    }catch(e){return{}}
  });
  
  useEffect(()=>{
    const handleStorage=()=>{
      const saved=localStorage.getItem('gb_app_settings');
      if(saved)setSettings(JSON.parse(saved));
    };
    window.addEventListener('storage',handleStorage);
    // Also check periodically for changes from admin panel in same tab
    const interval=setInterval(()=>{
      const saved=localStorage.getItem('gb_app_settings');
      if(saved){
        const parsed=JSON.parse(saved);
        if(JSON.stringify(parsed)!==JSON.stringify(settings))setSettings(parsed);
      }
    },2000);
    return()=>{window.removeEventListener('storage',handleStorage);clearInterval(interval)};
  },[settings]);
  
  // Apply theme colors to CSS variables
  useEffect(()=>{
    document.documentElement.style.setProperty('--primary-color',settings.primaryColor||'#ec4899');
    document.documentElement.style.setProperty('--secondary-color',settings.secondaryColor||'#8b5cf6');
    document.documentElement.style.setProperty('--accent-color',settings.accentColor||'#10b981');
  },[settings]);
  
  return settings;
};

// LOGIN - Premium 2025 UI
const LoginScreen=({onLoggedIn,goRegister,goForgotPassword})=>{
  const[userType,setUserType]=useState('user');
  const[loading,setLoading]=useState(false);
  const[email,setEmail]=useState('');
  const[password,setPassword]=useState('');
  const[showPwd,setShowPwd]=useState(false);
  const[rememberMe,setRememberMe]=useState(false);
  const[error,setError]=useState('');
  const[emailError,setEmailError]=useState('');
  const[passwordError,setPasswordError]=useState('');
  const toast=useToast();

  // Email validation
  const validateEmail=(e)=>{
    const regex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if(!e)setEmailError('Email is required');
    else if(!regex.test(e))setEmailError('Invalid email format');
    else setEmailError('');
  };

  // Password validation
  const validatePassword=(p)=>{
    if(!p)setPasswordError('Password is required');
    else if(p.length<6)setPasswordError('Minimum 6 characters');
    else setPasswordError('');
  };

  const handleLogin=async e=>{
    e.preventDefault();
    validateEmail(email);
    validatePassword(password);
    if(emailError||passwordError||!email||!password)return;
    
    setError('');setLoading(true);
    await new Promise(r=>setTimeout(r,800));
    const user=DB.getUserByEmail(email);
    if(!user){setError('No account found with this email');setLoading(false);return}
    if(user.password!==password){setError('Incorrect password');setLoading(false);return}
    if(user.status==='blocked'){setError('Your account has been suspended');setLoading(false);return}
    if(userType==='pro'&&user.role!=='professional'){setError('This is not a professional account');setLoading(false);return}
    if(userType==='user'&&user.role!=='user'){setError('Please use professional login');setLoading(false);return}
    
    if(rememberMe)localStorage.setItem('gb_remember',email);
    toast.show('Welcome back! ðŸŽ‰','success');
    onLoggedIn(user);
    setLoading(false);
  };

  // Check remembered email
  useEffect(()=>{
    const saved=localStorage.getItem('gb_remember');
    if(saved){setEmail(saved);setRememberMe(true)}
  },[]);

  return(
    <div className="flex-1 flex flex-col h-full bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 relative overflow-hidden">
      {/* Decorative Blobs */}
      <div className="blob-1 -top-20 -right-20 opacity-60"></div>
      <div className="blob-2 top-1/3 -left-20 opacity-40"></div>
      <div className="blob-1 -bottom-20 right-1/4 opacity-50" style={{animationDelay:'-4s'}}></div>
      
      <div className="flex-1 overflow-y-auto px-6 pt-8 pb-8 z-10">
        {/* Logo & 3D Cube */}
        <div className="mb-8 text-center anim-slide-down" style={{animationDelay:'0.1s'}}>
          <div className="scene mb-5">
            <div className={`cube ${userType==='pro'?'show-pro':''}`}>
              <div className="cube-face cube-face-front">
                <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=300&q=80" className="w-full h-full object-cover"/>
                <div className="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent flex items-end justify-center pb-4">
                  <span className="text-white text-xs font-bold uppercase tracking-[0.2em]">Customer</span>
                </div>
              </div>
              <div className="cube-face cube-face-back">
                <img src="https://images.unsplash.com/photo-1560066984-138dadb4c035?w=300&q=80" className="w-full h-full object-cover"/>
                <div className="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent flex items-end justify-center pb-4">
                  <span className="text-white text-xs font-bold uppercase tracking-[0.2em]">Professional</span>
                </div>
              </div>
            </div>
          </div>
          <h1 className="text-4xl font-bold text-gray-900">
            <span className="font-display">Go</span>Beauty<span className="text-gradient">.</span>
          </h1>
          <p className="text-gray-500 text-sm mt-2 font-medium">
            {userType==='user'?'Discover beauty services near you':'Manage your beauty business'}
          </p>
        </div>

        {/* User Type Toggle */}
        <div className="glass rounded-2xl p-1.5 flex relative mb-6 shadow-premium anim-slide-up" style={{animationDelay:'0.2s'}}>
          <div className="absolute top-1.5 bottom-1.5 w-[calc(50%-6px)] gradient-primary rounded-xl shadow-lg transition-all duration-500 ease-out" style={{left:userType==='user'?'6px':'calc(50%)'}}></div>
          {[{id:'user',icon:'fa-user',label:'Customer'},{id:'pro',icon:'fa-scissors',label:'Professional'}].map(t=>(
            <button key={t.id} type="button" onClick={()=>setUserType(t.id)} className={`flex-1 flex items-center justify-center gap-2 py-3.5 text-sm font-bold rounded-xl relative z-10 transition-colors duration-300 ${userType===t.id?'text-white':'text-gray-500'}`}>
              <i className={`fa-solid ${t.icon}`}></i>{t.label}
            </button>
          ))}
        </div>

        {/* Error Message */}
        {error&&(
          <div className="bg-red-50 border-2 border-red-100 text-red-600 px-4 py-3 rounded-2xl mb-5 text-sm flex items-center gap-3 anim-scale">
            <div className="w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center shrink-0">
              <i className="fa-solid fa-circle-exclamation text-lg"></i>
            </div>
            <span className="font-medium">{error}</span>
          </div>
        )}

        {/* Login Form */}
        <form onSubmit={handleLogin} className="space-y-4 anim-slide-up" style={{animationDelay:'0.3s'}}>
          {/* Email */}
          <div>
            <div className="relative">
              <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <i className={`fa-solid fa-envelope text-lg ${emailError?'text-red-400':'text-gray-400'}`}></i>
              </div>
              <input 
                type="email" 
                value={email} 
                onChange={e=>{setEmail(e.target.value);validateEmail(e.target.value)}}
                onBlur={e=>validateEmail(e.target.value)}
                placeholder="Email address" 
                className={`w-full input-premium ${emailError?'border-red-300 bg-red-50':''}`}
              />
              {email&&!emailError&&(
                <div className="absolute inset-y-0 right-4 flex items-center">
                  <i className="fa-solid fa-circle-check text-green-500"></i>
                </div>
              )}
            </div>
            {emailError&&<p className="text-red-500 text-xs mt-1.5 ml-1 font-medium">{emailError}</p>}
          </div>

          {/* Password */}
          <div>
            <div className="relative">
              <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <i className={`fa-solid fa-lock text-lg ${passwordError?'text-red-400':'text-gray-400'}`}></i>
              </div>
              <input 
                type={showPwd?"text":"password"} 
                value={password} 
                onChange={e=>{setPassword(e.target.value);validatePassword(e.target.value)}}
                onBlur={e=>validatePassword(e.target.value)}
                placeholder="Password" 
                className={`w-full input-premium pr-12 ${passwordError?'border-red-300 bg-red-50':''}`}
              />
              <button type="button" onClick={()=>setShowPwd(!showPwd)} className="absolute inset-y-0 right-0 pr-4 flex items-center">
                <i className={`fa-solid ${showPwd?'fa-eye-slash':'fa-eye'} text-gray-400 hover:text-gray-600 transition-colors`}></i>
              </button>
            </div>
            {passwordError&&<p className="text-red-500 text-xs mt-1.5 ml-1 font-medium">{passwordError}</p>}
          </div>

          {/* Remember Me & Forgot Password */}
          <div className="flex items-center justify-between pt-1">
            <label className="flex items-center gap-2 cursor-pointer">
              <div className={`w-5 h-5 rounded-md border-2 flex items-center justify-center transition-all ${rememberMe?'bg-pink-500 border-pink-500':'border-gray-300'}`} onClick={()=>setRememberMe(!rememberMe)}>
                {rememberMe&&<i className="fa-solid fa-check text-white text-xs"></i>}
              </div>
              <span className="text-sm text-gray-600 font-medium">Remember me</span>
            </label>
            <button type="button" onClick={goForgotPassword} className="text-sm font-semibold text-pink-600 hover:text-pink-700">
              Forgot Password?
            </button>
          </div>

          {/* Login Button */}
          <button type="submit" disabled={loading} className="w-full btn-primary flex justify-center items-center gap-3 disabled:opacity-60 disabled:transform-none mt-6">
            {loading?(
              <>
                <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div>
                <span>Signing in...</span>
              </>
            ):(
              <>
                <span>Sign In</span>
                <i className="fa-solid fa-arrow-right"></i>
              </>
            )}
          </button>
        </form>

        {/* Divider */}
        <div className="flex items-center gap-4 my-6 anim-fade" style={{animationDelay:'0.4s'}}>
          <div className="flex-1 h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent"></div>
          <span className="text-gray-400 text-sm font-medium">or continue with</span>
          <div className="flex-1 h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent"></div>
        </div>

        {/* Social Login */}
        <div className="grid grid-cols-3 gap-3 anim-slide-up" style={{animationDelay:'0.5s'}}>
          <button type="button" className="btn-social btn-google">
            <i className="fa-brands fa-google text-xl text-red-500"></i>
          </button>
          <button type="button" className="btn-social btn-facebook">
            <i className="fa-brands fa-facebook-f text-xl text-blue-600"></i>
          </button>
          <button type="button" className="btn-social btn-apple">
            <i className="fa-brands fa-apple text-xl text-gray-900"></i>
          </button>
        </div>

        {/* Register Link */}
        <div className="pt-8 text-center anim-fade" style={{animationDelay:'0.6s'}}>
          <span className="text-gray-500">Don't have an account?</span>
          <button onClick={goRegister} className="font-bold text-pink-600 ml-1.5 hover:text-pink-700">Create Account</button>
        </div>

        {/* Admin Link */}
        <div className="pt-4 text-center anim-fade" style={{animationDelay:'0.7s'}}>
          <a href="admin.html" className="text-gray-400 text-xs hover:text-gray-600 inline-flex items-center gap-1.5">
            <i className="fa-solid fa-shield-halved"></i>Admin Panel
          </a>
        </div>
      </div>
    </div>
  )
};

// REGISTER - Premium 2025 UI
const RegisterScreen=({onRegistered,goLogin})=>{
  const[userType,setUserType]=useState('user');
  const[step,setStep]=useState(1);
  const[loading,setLoading]=useState(false);
  const[error,setError]=useState('');
  const[showPwd,setShowPwd]=useState(false);
  const[agreeTerms,setAgreeTerms]=useState(false);
  const toast=useToast();
  
  // Form fields
  const[name,setName]=useState('');
  const[email,setEmail]=useState('');
  const[password,setPassword]=useState('');
  const[phone,setPhone]=useState('');
  const[businessName,setBusinessName]=useState('');
  const[category,setCategory]=useState('');
  const[country,setCountry]=useState('');
  const[city,setCity]=useState('');
  const[address,setAddress]=useState('');
  const[description,setDescription]=useState('');
  
  const categories=DB.getCategories();
  const locations=DB.getLocations();
  
  // Get cities for selected country
  const selectedCountry=locations.regions?.find(r=>r.id===country);
  const cities=selectedCountry?.cities||[];
  const selectedCity=cities.find(c=>c.id===city);

  // Password strength
  const getPasswordStrength=()=>{
    if(!password)return{level:0,text:'',color:''};
    let score=0;
    if(password.length>=6)score++;
    if(password.length>=8)score++;
    if(/[A-Z]/.test(password))score++;
    if(/[0-9]/.test(password))score++;
    if(/[^A-Za-z0-9]/.test(password))score++;
    
    if(score<=2)return{level:score,text:'Weak',color:'bg-red-500'};
    if(score<=3)return{level:score,text:'Medium',color:'bg-yellow-500'};
    return{level:score,text:'Strong',color:'bg-green-500'};
  };
  const pwdStrength=getPasswordStrength();

  const handleRegister=async e=>{
    e.preventDefault();
    if(!agreeTerms){toast.show('Please agree to terms','warning');return}
    setError('');setLoading(true);
    await new Promise(r=>setTimeout(r,800));
    if(DB.getUserByEmail(email)){setError('An account with this email already exists');setLoading(false);return}
    const userId='user_'+Date.now();
    const newUser={id:userId,name,email,password,phone,role:userType==='pro'?'professional':'user',status:'active',createdAt:new Date().toISOString(),walletBalance:0,points:0};
    DB.addUser(newUser);
    if(userType==='pro'){
      // Get location - try GPS first, then city location with random offset
      let lat=selectedCity?.lat||33.6844;
      let lng=selectedCity?.lng||73.0479;
      
      // Add random offset (0.001 to 0.01 degrees = ~100m to 1km) for unique positioning
      const randomOffset=()=>(Math.random()-0.5)*0.02; // ~2km variation
      lat+=randomOffset();
      lng+=randomOffset();
      
      // Try to get exact GPS location
      if(navigator.geolocation){
        try{
          const pos=await new Promise((resolve,reject)=>{
            navigator.geolocation.getCurrentPosition(resolve,reject,{timeout:5000,enableHighAccuracy:true});
          });
          lat=pos.coords.latitude;
          lng=pos.coords.longitude;
        }catch(e){
          // GPS not available, use city location with offset
          console.log('GPS not available, using city location');
        }
      }
      
      DB.addProvider({
        id:'provider_'+Date.now(),userId,businessName,categoryId:category,
        country,city,cityName:selectedCity?.name||'',countryName:selectedCountry?.name||'',
        address,description,
        image:`https://ui-avatars.com/api/?name=${encodeURIComponent(businessName)}&background=ec4899&color=fff&size=200`,
        coverImage:'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=800&q=80',
        lat,lng,
        rating:0,reviewCount:0,status:'pending',verified:false,featured:false,homeService:true,homeServiceFee:15,createdAt:new Date().toISOString()
      });
    }
    toast.show('Welcome to GoBeauty! ðŸŽ‰','success');
    onRegistered(newUser);
    setLoading(false);
  };

  return(
    <div className="flex-1 flex flex-col h-full bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 relative overflow-hidden">
      {/* Decorative Blobs */}
      <div className="blob-2 -top-32 -left-20 opacity-50"></div>
      <div className="blob-1 bottom-20 -right-20 opacity-40"></div>
      
      <div className="flex-1 overflow-y-auto px-6 pt-6 pb-8 z-10">
        {/* Header */}
        <div className="mb-6 anim-slide-down">
          {/* Progress Steps */}
          {userType==='pro'&&(
            <div className="flex items-center justify-center gap-3 mb-6">
              <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm ${step>=1?'gradient-primary text-white shadow-glow':'bg-gray-200 text-gray-500'}`}>1</div>
              <div className={`w-16 h-1 rounded-full ${step>=2?'gradient-primary':'bg-gray-200'}`}></div>
              <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm ${step>=2?'gradient-primary text-white shadow-glow':'bg-gray-200 text-gray-500'}`}>2</div>
            </div>
          )}
          
          <h1 className="text-3xl font-bold text-gray-900 text-center">
            {step===1?'Create Account':'Business Details'}<span className="text-gradient">.</span>
          </h1>
          <p className="text-gray-500 text-sm mt-2 text-center font-medium">
            {step===1?'Join the GoBeauty community':'Tell us about your business'}
          </p>
        </div>

        {/* Error Message */}
        {error&&(
          <div className="bg-red-50 border-2 border-red-100 text-red-600 px-4 py-3 rounded-2xl mb-5 text-sm flex items-center gap-3 anim-scale">
            <div className="w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center shrink-0">
              <i className="fa-solid fa-circle-exclamation text-lg"></i>
            </div>
            <span className="font-medium">{error}</span>
          </div>
        )}

        <form onSubmit={handleRegister}>
          {step===1&&(
            <div className="anim-slide-up">
              {/* User Type Toggle */}
              <div className="glass rounded-2xl p-1.5 flex relative mb-6 shadow-premium">
                <div className="absolute top-1.5 bottom-1.5 w-[calc(50%-6px)] gradient-primary rounded-xl shadow-lg transition-all duration-500 ease-out" style={{left:userType==='user'?'6px':'calc(50%)'}}></div>
                <button type="button" onClick={()=>setUserType('user')} className={`flex-1 flex items-center justify-center gap-2 py-3.5 text-sm font-bold rounded-xl relative z-10 transition-colors duration-300 ${userType==='user'?'text-white':'text-gray-500'}`}>
                  <i className="fa-solid fa-user"></i>Customer
                </button>
                <button type="button" onClick={()=>setUserType('pro')} className={`flex-1 flex items-center justify-center gap-2 py-3.5 text-sm font-bold rounded-xl relative z-10 transition-colors duration-300 ${userType==='pro'?'text-white':'text-gray-500'}`}>
                  <i className="fa-solid fa-scissors"></i>Professional
                </button>
              </div>

              <div className="space-y-4">
                {/* Name */}
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i className="fa-solid fa-user text-lg text-gray-400"></i>
                  </div>
                  <input value={name} onChange={e=>setName(e.target.value)} required placeholder="Full Name" className="w-full input-premium"/>
                </div>

                {/* Email */}
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i className="fa-solid fa-envelope text-lg text-gray-400"></i>
                  </div>
                  <input value={email} onChange={e=>setEmail(e.target.value)} type="email" required placeholder="Email address" className="w-full input-premium"/>
                </div>

                {/* Phone */}
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i className="fa-solid fa-phone text-lg text-gray-400"></i>
                  </div>
                  <input value={phone} onChange={e=>setPhone(e.target.value)} type="tel" required placeholder="Phone number" className="w-full input-premium"/>
                </div>

                {/* Password */}
                <div>
                  <div className="relative">
                    <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                      <i className="fa-solid fa-lock text-lg text-gray-400"></i>
                    </div>
                    <input value={password} onChange={e=>setPassword(e.target.value)} type={showPwd?"text":"password"} required placeholder="Password (min 6 characters)" minLength={6} className="w-full input-premium pr-12"/>
                    <button type="button" onClick={()=>setShowPwd(!showPwd)} className="absolute inset-y-0 right-0 pr-4 flex items-center">
                      <i className={`fa-solid ${showPwd?'fa-eye-slash':'fa-eye'} text-gray-400`}></i>
                    </button>
                  </div>
                  {/* Password Strength */}
                  {password&&(
                    <div className="mt-2 flex items-center gap-2">
                      <div className="flex-1 h-1.5 bg-gray-200 rounded-full overflow-hidden flex gap-1">
                        {[1,2,3,4,5].map(i=>(
                          <div key={i} className={`flex-1 rounded-full transition-all ${i<=pwdStrength.level?pwdStrength.color:'bg-gray-200'}`}></div>
                        ))}
                      </div>
                      <span className={`text-xs font-semibold ${pwdStrength.color.replace('bg-','text-')}`}>{pwdStrength.text}</span>
                    </div>
                  )}
                </div>

                {/* Terms */}
                <label className="flex items-start gap-3 cursor-pointer pt-2">
                  <div className={`w-5 h-5 rounded-md border-2 flex items-center justify-center transition-all shrink-0 mt-0.5 ${agreeTerms?'bg-pink-500 border-pink-500':'border-gray-300'}`} onClick={()=>setAgreeTerms(!agreeTerms)}>
                    {agreeTerms&&<i className="fa-solid fa-check text-white text-xs"></i>}
                  </div>
                  <span className="text-sm text-gray-600">I agree to the <a href="#" className="text-pink-600 font-semibold">Terms of Service</a> and <a href="#" className="text-pink-600 font-semibold">Privacy Policy</a></span>
                </label>
              </div>

              {userType==='pro'?(
                <button type="button" onClick={()=>setStep(2)} disabled={!name||!email||!phone||password.length<6||!agreeTerms} className="w-full btn-secondary flex justify-center items-center gap-3 disabled:opacity-50 mt-6">
                  <span>Continue</span>
                  <i className="fa-solid fa-arrow-right"></i>
                </button>
              ):(
                <button type="submit" disabled={loading||!agreeTerms} className="w-full btn-primary flex justify-center items-center gap-3 disabled:opacity-50 mt-6">
                  {loading?(
                    <>
                      <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div>
                      <span>Creating account...</span>
                    </>
                  ):(
                    <>
                      <span>Create Account</span>
                      <i className="fa-solid fa-arrow-right"></i>
                    </>
                  )}
                </button>
              )}

              {/* Divider */}
              <div className="flex items-center gap-4 my-6">
                <div className="flex-1 h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent"></div>
                <span className="text-gray-400 text-sm font-medium">or</span>
                <div className="flex-1 h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent"></div>
              </div>

              {/* Social Register */}
              <div className="grid grid-cols-3 gap-3">
                <button type="button" className="btn-social btn-google">
                  <i className="fa-brands fa-google text-xl text-red-500"></i>
                </button>
                <button type="button" className="btn-social btn-facebook">
                  <i className="fa-brands fa-facebook-f text-xl text-blue-600"></i>
                </button>
                <button type="button" className="btn-social btn-apple">
                  <i className="fa-brands fa-apple text-xl text-gray-900"></i>
                </button>
              </div>
            </div>
          )}

          {step===2&&(
            <div className="anim-slide-up space-y-4">
              {/* Back Button */}
              <button type="button" onClick={()=>setStep(1)} className="flex items-center gap-2 text-gray-500 hover:text-gray-700 font-medium mb-2">
                <i className="fa-solid fa-arrow-left"></i>Back
              </button>

              {/* Business Name */}
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <i className="fa-solid fa-store text-lg text-gray-400"></i>
                </div>
                <input value={businessName} onChange={e=>setBusinessName(e.target.value)} required placeholder="Business/Salon Name" className="w-full input-premium"/>
              </div>

              {/* Category */}
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <i className="fa-solid fa-spa text-lg text-gray-400"></i>
                </div>
                <select value={category} onChange={e=>setCategory(e.target.value)} required className="w-full input-premium appearance-none cursor-pointer">
                  <option value="">Select Category</option>
                  {categories.filter(c=>c.status==='active').map(c=><option key={c.id} value={c.id}>{c.name}</option>)}
                </select>
                <div className="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                  <i className="fa-solid fa-chevron-down text-gray-400"></i>
                </div>
              </div>

              {/* Country/Region */}
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <i className="fa-solid fa-globe text-lg text-gray-400"></i>
                </div>
                <select value={country} onChange={e=>{setCountry(e.target.value);setCity('')}} required className="w-full input-premium appearance-none cursor-pointer">
                  <option value="">Select Country/Region</option>
                  {locations.regions?.map(r=><option key={r.id} value={r.id}>{r.name}</option>)}
                </select>
                <div className="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                  <i className="fa-solid fa-chevron-down text-gray-400"></i>
                </div>
              </div>

              {/* City */}
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <i className="fa-solid fa-city text-lg text-gray-400"></i>
                </div>
                <select value={city} onChange={e=>setCity(e.target.value)} required disabled={!country} className="w-full input-premium appearance-none cursor-pointer disabled:opacity-50">
                  <option value="">Select City</option>
                  {cities.map(c=><option key={c.id} value={c.id}>{c.name}</option>)}
                </select>
                <div className="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                  <i className="fa-solid fa-chevron-down text-gray-400"></i>
                </div>
              </div>

              {/* Address */}
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <i className="fa-solid fa-location-dot text-lg text-gray-400"></i>
                </div>
                <input value={address} onChange={e=>setAddress(e.target.value)} required placeholder="Full Address (Street, Area)" className="w-full input-premium"/>
              </div>

              {/* Description */}
              <div className="relative">
                <div className="absolute top-4 left-0 pl-4 pointer-events-none">
                  <i className="fa-solid fa-align-left text-lg text-gray-400"></i>
                </div>
                <textarea value={description} onChange={e=>setDescription(e.target.value)} placeholder="Describe your services (optional)" rows={3} className="w-full input-premium resize-none !pt-4" style={{paddingLeft:'52px'}}/>
              </div>

              {/* Submit */}
              <button type="submit" disabled={loading||!businessName||!category||!country||!city||!address} className="w-full btn-primary flex justify-center items-center gap-3 disabled:opacity-50 mt-2">
                {loading?(
                  <>
                    <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div>
                    <span>Creating business...</span>
                  </>
                ):(
                  <>
                    <span>Complete Registration</span>
                    <i className="fa-solid fa-check"></i>
                  </>
                )}
              </button>
            </div>
          )}
        </form>

        {/* Login Link */}
        <div className="pt-6 text-center">
          <span className="text-gray-500">Already have an account?</span>
          <button onClick={goLogin} className="font-bold text-pink-600 ml-1.5 hover:text-pink-700">Sign In</button>
        </div>
      </div>
    </div>
  )
};

// CUSTOMER APP - Premium 2025 UI (Complete 10 Modules + Bonus)
const CustomerApp=({user,onLogout})=>{
  const[tab,setTab]=useState('home');
  const[selectedCat,setSelectedCat]=useState('All');
  const[selectedProvider,setSelectedProvider]=useState(null);
  const[bookingProvider,setBookingProvider]=useState(null);
  const[search,setSearch]=useState('');
  const[showFilters,setShowFilters]=useState(false);
  const[favorites,setFavorites]=useState(JSON.parse(localStorage.getItem('gb_favorites')||'[]'));
  const[showWallet,setShowWallet]=useState(false);
  const[showOffers,setShowOffers]=useState(false);
  const[showMembership,setShowMembership]=useState(false);
  const[showGiftCards,setShowGiftCards]=useState(false);
  const[showLanguage,setShowLanguage]=useState(false);
  const[showLiveTracking,setShowLiveTracking]=useState(null);
  const[currentLang,setCurrentLang]=useState(DB.getCurrentLanguage());
  const[userData,setUserData]=useState(user);
  const[userLocation,setUserLocation]=useState({lat:48.8566,lng:2.3522,country:'France'});
  const[filters,setFilters]=useState({minRating:0,maxDistance:50,sortBy:'distance',minPrice:null,maxPrice:null,verifiedOnly:false,topRatedOnly:false,homeServiceOnly:false,category:null});
  const[refresh,setRefresh]=useState(0);
  const[isLoading,setIsLoading]=useState(true);
  const toast=useToast();
  const appSettings=useAppSettings();

  // Simulate initial data loading
  useEffect(()=>{
    const timer=setTimeout(()=>setIsLoading(false),800);
    return()=>clearTimeout(timer);
  },[]);

  // Get user's real location
  useEffect(()=>{
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(
        async(pos)=>{
          const lat=pos.coords.latitude;
          const lng=pos.coords.longitude;
          try{
            const resp=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`);
            const data=await resp.json();
            setUserLocation({lat,lng,country:data.address?.country||'Unknown',city:data.address?.city||data.address?.town||''});
          }catch(e){setUserLocation({lat,lng,country:'Unknown'})}
        },
        ()=>{},
        {enableHighAccuracy:true,timeout:10000}
      );
    }
  },[]);

  // Save favorites to localStorage
  useEffect(()=>{localStorage.setItem('gb_favorites',JSON.stringify(favorites))},[favorites]);

  const categories=DB.getCategories();
  const allProviders=DB.getProviders().filter(p=>p.status==='approved');
  const userBookings=DB.getBookingsByUser(user.id);

  // Distance calculation
  const getDistance=(lat1,lng1,lat2,lng2)=>{
    const R=6371;
    const dLat=(lat2-lat1)*Math.PI/180;
    const dLng=(lng2-lng1)*Math.PI/180;
    const a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)*Math.sin(dLng/2);
    return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  };

  // Providers with distance
  const providers=allProviders.map(p=>({...p,distance:getDistance(userLocation.lat,userLocation.lng,p.lat,p.lng),isFavorite:favorites.includes(p.id)}));

  // PLAN K: Apply enhanced filters using DB functions
  const filtered=(()=>{
    let result=[...providers];
    
    // Category filter (from tab selection)
    if(selectedCat!=='All'){
      const cat=categories.find(c=>c.name===selectedCat);
      if(cat)result=result.filter(p=>p.categoryId===cat.id);
    }
    
    // Category filter (from filters modal)
    if(filters.category){
      result=result.filter(p=>p.categoryId===filters.category);
    }
    
    // Search filter
    if(search){
      result=DB.searchProviders(search,result);
    }
    
    // Rating filter
    if(filters.minRating>0){
      result=DB.filterByRating(result,filters.minRating);
    }
    
    // Distance filter
    if(filters.maxDistance<50&&userLocation.lat&&userLocation.lng){
      result=DB.filterByDistance(result,filters.maxDistance,userLocation.lat,userLocation.lng);
    }
    
    // Price filter
    if(filters.minPrice||filters.maxPrice){
      result=DB.filterByPriceRange(result,filters.minPrice,filters.maxPrice);
    }
    
    // Verified only
    if(filters.verifiedOnly){
      result=result.filter(p=>p.verified);
    }
    
    // Top rated only
    if(filters.topRatedOnly){
      result=result.filter(p=>p.topRated);
    }
    
    // Home service only
    if(filters.homeServiceOnly){
      result=result.filter(p=>p.homeService);
    }
    
    // Apply sorting
    result=DB.sortProviders(result,filters.sortBy||'distance',userLocation.lat,userLocation.lng);
    
    return result;
  })();

  // Toggle favorite
  const toggleFavorite=(id)=>{
    setFavorites(prev=>prev.includes(id)?prev.filter(x=>x!==id):[...prev,id]);
    toast.show(favorites.includes(id)?'Removed from favorites':'Added to favorites! â¤ï¸','success');
  };

  // Components - Compact with Touch Scroll
  const Categories=({active,onSelect})=>(
    <div className="touch-scroll px-4 pb-1">
      <div className="flex gap-2" style={{width:'max-content'}}>
        <button onClick={()=>onSelect('All')} className={`shrink-0 px-3 py-1.5 rounded-lg text-[11px] font-semibold flex items-center gap-1.5 transition-all ${active==='All'?'gradient-primary text-white':'bg-white text-gray-600 border border-gray-200'}`}>
          <i className="fa-solid fa-layer-group text-[10px]"></i>All
        </button>
        {categories.filter(c=>c.status==='active').map(c=>(
          <button key={c.id} onClick={()=>onSelect(c.name)} className={`shrink-0 px-3 py-1.5 rounded-lg text-[11px] font-semibold flex items-center gap-1.5 transition-all whitespace-nowrap ${active===c.name?'gradient-primary text-white':'bg-white text-gray-600 border border-gray-200'}`}>
            <i className={`fa-solid fa-${c.icon} text-[10px]`}></i>{c.name}
          </button>
        ))}
      </div>
    </div>
  );

  // PLAN K: Enhanced SearchBar with suggestions
  const[showSearchDropdown,setShowSearchDropdown]=useState(false);
  const[recentSearches,setRecentSearches]=useState(()=>DB.getRecentSearches(user.id));
  const searchInputRef=useRef(null);
  
  // Save search function
  const saveSearchQuery=(q)=>{
    if(q&&q.trim().length>2){
      DB.saveRecentSearch(user.id,q.trim());
      setRecentSearches(DB.getRecentSearches(user.id));
    }
  };
  
  // Render Search Bar inline instead of as separate component to prevent focus loss
  const renderSearchBar=(value,onSearch,showFilter=false,className='')=>{
    const activeFilterCount=Object.entries(filters).filter(([k,v])=>v&&v!==0&&k!=='sortBy'&&v!==50).length;
    
    return(
    <div className={`relative ${className}`}>
      <div className="flex gap-2">
        <div className="flex-1 px-3 py-2.5 bg-white rounded-xl flex items-center gap-2.5 shadow-sm border border-gray-100">
          <i className="fa-solid fa-magnifying-glass text-gray-400 text-xs"></i>
          <input 
            ref={searchInputRef}
            type="text" 
            value={value} 
            placeholder="Search salons, services..." 
            className="bg-transparent w-full outline-none text-gray-700 placeholder-gray-400 font-medium text-[13px]" 
            onChange={(e)=>onSearch(e.target.value)}
            onFocus={()=>setShowSearchDropdown(true)}
            onBlur={()=>{saveSearchQuery(value);setTimeout(()=>setShowSearchDropdown(false),200)}}
            onKeyDown={(e)=>{if(e.key==='Enter'){e.target.blur()}}}
          />
          {value&&<button onMouseDown={(e)=>{e.preventDefault();onSearch('');setTimeout(()=>searchInputRef.current?.focus(),10)}} className="text-gray-400"><i className="fa-solid fa-times text-xs"></i></button>}
        </div>
        {showFilter&&(
          <button onClick={()=>setShowFilters(true)} className="w-10 h-10 bg-white rounded-xl flex items-center justify-center shadow-sm border border-gray-100 relative">
            <i className="fa-solid fa-sliders text-gray-600 text-sm"></i>
            {activeFilterCount>0&&<span className="absolute -top-1 -right-1 w-4 h-4 bg-pink-500 text-white text-[9px] rounded-full flex items-center justify-center">{activeFilterCount}</span>}
          </button>
        )}
      </div>
      
      {/* Search Dropdown */}
      {showSearchDropdown&&!value&&recentSearches.length>0&&(
        <div className="absolute top-full left-0 right-0 mt-1.5 bg-white rounded-xl shadow-lg border z-50 overflow-hidden">
          <div className="px-3 py-2 border-b flex items-center justify-between">
            <span className="text-[10px] text-gray-500 font-medium">Recent</span>
            <button onMouseDown={(e)=>{e.preventDefault();DB.clearRecentSearches(user.id);setRecentSearches([])}} className="text-[10px] text-pink-500">Clear</button>
          </div>
          {recentSearches.slice(0,4).map((s,i)=>(
            <button key={i} onMouseDown={(e)=>{e.preventDefault();onSearch(s);setShowSearchDropdown(false)}} className="w-full px-3 py-2 text-left flex items-center gap-2 hover:bg-gray-50">
              <i className="fa-solid fa-clock text-gray-300 text-[10px]"></i>
              <span className="text-[12px]">{s}</span>
            </button>
          ))}
        </div>
      )}
      
      {/* Search Suggestions */}
      {showSearchDropdown&&value&&value.length>=2&&(
        <div className="absolute top-full left-0 right-0 mt-2 bg-white rounded-2xl shadow-xl border z-50 overflow-hidden max-h-60 overflow-y-auto">
          {/* Category suggestions */}
          {categories.filter(c=>c.name.toLowerCase().includes(value.toLowerCase())).slice(0,3).map(c=>(
            <button key={c.id} onMouseDown={(e)=>{e.preventDefault();setFilters(f=>({...f,category:c.id}));onSearch('');setShowSearchDropdown(false)}} className="w-full px-4 py-3 text-left flex items-center gap-3 hover:bg-gray-50 border-b">
              <div className="w-8 h-8 bg-pink-100 rounded-lg flex items-center justify-center">
                <i className={`fa-solid fa-${c.icon} text-pink-500 text-sm`}></i>
              </div>
              <div>
                <p className="text-sm font-medium">{c.name}</p>
                <p className="text-xs text-gray-400">Category</p>
              </div>
            </button>
          ))}
          {/* Provider suggestions */}
          {allProviders.filter(p=>p.businessName?.toLowerCase().includes(value.toLowerCase())).slice(0,4).map(p=>(
            <button key={p.id} onMouseDown={(e)=>{e.preventDefault();setSelectedProvider(p);setShowSearchDropdown(false)}} className="w-full px-4 py-3 text-left flex items-center gap-3 hover:bg-gray-50">
              <img src={p.image} className="w-8 h-8 rounded-lg object-cover"/>
              <div className="flex-1 min-w-0">
                <p className="text-sm font-medium truncate">{p.businessName}</p>
                <p className="text-xs text-gray-400 truncate">{p.address}</p>
              </div>
              <div className="flex items-center gap-1 text-xs">
                <i className="fa-solid fa-star text-yellow-400"></i>
                <span>{p.rating||'New'}</span>
              </div>
            </button>
          ))}
          {categories.filter(c=>c.name.toLowerCase().includes(value.toLowerCase())).length===0&&
           allProviders.filter(p=>p.businessName?.toLowerCase().includes(value.toLowerCase())).length===0&&(
            <div className="p-4 text-center text-gray-500 text-sm">
              <i className="fa-solid fa-search mb-2"></i>
              <p>No results for "{value}"</p>
            </div>
          )}
        </div>
      )}
    </div>
  )};

  const ProviderCard=({data,onClick,featured=false,showFav=true})=>{
    const cat=categories.find(c=>c.id===data.categoryId);
    const distanceText=data.distance<1?`${Math.round(data.distance*1000)}m`:`${data.distance.toFixed(1)}km`;
    const priceRange=DB.getProviderPriceRange(data.id);
    
    if(featured)return(
      <div onClick={()=>onClick(data)} className="bg-white rounded-2xl overflow-hidden shadow-sm border min-w-[200px] w-[200px] cursor-pointer transition-all">
        <div className="h-28 w-full relative">
          <img src={data.coverImage} className="w-full h-full object-cover"/>
          <div className="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
          <div className="absolute top-2 right-2 bg-white/95 px-2 py-0.5 rounded-lg text-[10px] font-bold flex items-center gap-1">
            <i className="fa-solid fa-star text-yellow-400 text-[9px]"></i>{data.rating||'New'}
          </div>
          <div className="absolute top-2 left-2 bg-black/60 text-white px-2 py-0.5 rounded-lg text-[10px] font-medium backdrop-blur-sm">
            <i className="fa-solid fa-location-dot mr-0.5 text-[9px]"></i>{distanceText}
          </div>
          {showFav&&(
            <button onClick={e=>{e.stopPropagation();toggleFavorite(data.id)}} className="absolute bottom-2 right-2 w-7 h-7 bg-white/90 rounded-full flex items-center justify-center shadow">
              <i className={`fa-${data.isFavorite?'solid':'regular'} fa-heart text-xs ${data.isFavorite?'text-red-500':'text-gray-400'}`}></i>
            </button>
          )}
          {data.verified&&<div className="absolute bottom-2 left-2 bg-blue-500/90 text-white px-1.5 py-0.5 rounded text-[9px] font-medium"><i className="fa-solid fa-check text-[8px] mr-0.5"></i>Verified</div>}
        </div>
        <div className="p-2.5">
          <h3 className="font-semibold text-[13px] truncate mb-0.5">{data.businessName}</h3>
          <p className="text-[10px] text-gray-500"><i className={`fa-solid fa-${cat?.icon||'spa'} mr-1 text-[9px]`}></i>{cat?.name}</p>
        </div>
      </div>
    );

    return(
      <div onClick={()=>onClick(data)} className="bg-white rounded-xl p-2.5 shadow-sm border flex gap-3 cursor-pointer transition-all mb-2">
        <div className="w-16 h-16 rounded-xl overflow-hidden shrink-0 relative">
          <img src={data.image} className="w-full h-full object-cover"/>
          {data.verified&&<div className="absolute bottom-0.5 right-0.5 w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center"><i className="fa-solid fa-check text-white text-[6px]"></i></div>}
        </div>
        <div className="flex-1 min-w-0">
          <div className="flex items-start justify-between">
            <h3 className="font-semibold text-[13px] truncate pr-2">{data.businessName}</h3>
            {showFav&&(
              <button onClick={e=>{e.stopPropagation();toggleFavorite(data.id)}} className="shrink-0">
                <i className={`fa-${data.isFavorite?'solid':'regular'} fa-heart text-xs ${data.isFavorite?'text-red-500':'text-gray-300'}`}></i>
              </button>
            )}
          </div>
          <p className="text-[10px] text-gray-500"><i className={`fa-solid fa-${cat?.icon||'spa'} mr-1 text-[9px]`}></i>{cat?.name}</p>
          <div className="flex items-center gap-2 mt-1.5 flex-wrap">
            <span className="text-[10px] font-semibold flex items-center gap-0.5"><i className="fa-solid fa-star text-yellow-400 text-[9px]"></i>{data.rating||'New'}</span>
            <span className="text-[10px] text-gray-400">({data.reviewCount||0})</span>
            <span className="text-[10px] text-pink-600 font-medium"><i className="fa-solid fa-location-dot mr-0.5 text-[9px]"></i>{distanceText}</span>
            {priceRange.min>0&&<span className="text-[10px] text-green-600 font-medium">â‚¬{priceRange.min}+</span>}
          </div>
        </div>
      </div>
    );
  };

  // MODULE 23: Map View with Address Display
  const MapView=({providers,onSelect,userLocation})=>{
    const mapRef=useRef(null);
    const leafletRef=useRef(null);
    const markersRef=useRef(null);

    useEffect(()=>{
      if(typeof L==='undefined'||!L.markerClusterGroup||leafletRef.current)return;
      markersRef.current=L.markerClusterGroup({showCoverageOnHover:false,maxClusterRadius:40});
      const map=L.map(mapRef.current,{zoomControl:false,attributionControl:false}).setView([userLocation?.lat||48.8566,userLocation?.lng||2.3522],13);
      L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',{maxZoom:20}).addTo(map);
      map.addLayer(markersRef.current);
      leafletRef.current=map;

      // Add user location marker with pulse
      if(userLocation?.lat){
        const userIcon=L.divIcon({
          className:'',
          html:`<div style="position:relative"><div style="width:20px;height:20px;background:#ec4899;border-radius:50%;border:3px solid white;box-shadow:0 2px 10px rgba(236,72,153,0.5)"></div><div style="position:absolute;top:-5px;left:-5px;width:30px;height:30px;background:rgba(236,72,153,0.3);border-radius:50%;animation:pulse 2s infinite"></div></div>`,
          iconSize:[20,20],iconAnchor:[10,10]
        });
        L.marker([userLocation.lat,userLocation.lng],{icon:userIcon}).addTo(map).bindPopup('<b>ðŸ“ You are here</b>');
      }
    },[]);

    useEffect(()=>{
      if(leafletRef.current&&userLocation?.lat)leafletRef.current.setView([userLocation.lat,userLocation.lng],13);
    },[userLocation]);

    useEffect(()=>{
      if(!markersRef.current||typeof L==='undefined')return;
      markersRef.current.clearLayers();
      providers.forEach(p=>{
        const icon=L.divIcon({
          className:'',
          html:`<div class="custom-marker-container"><div class="custom-marker-radar"></div><div class="custom-marker-img"><img src="${p.image}"><div class="live-dot"></div></div></div>`,
          iconSize:[40,40],iconAnchor:[20,20]
        });
        const marker=L.marker([p.lat,p.lng],{icon});
        
        // Add popup with address
        marker.bindPopup(`
          <div style="min-width:180px;font-family:system-ui">
            <b style="font-size:14px">${p.businessName}</b><br>
            <span style="color:#666;font-size:12px">â­ ${p.rating||'New'} (${p.reviewCount||0})</span><br>
            <span style="color:#888;font-size:11px">ðŸ“ ${p.address||'Address not set'}</span>
          </div>
        `);
        
        marker.on('click',()=>onSelect(p));
        marker.addTo(markersRef.current);
      });
    },[providers,onSelect]);

    return <div ref={mapRef} className="w-full h-full bg-gray-100"/>
  };

  // MODULE 25 + PLAN J: Booking Flow with Multi-Service & Recurring
  const BookingDrawer=({provider,onClose})=>{
    const[step,setStep]=useState(1);
    const[selectedService,setSelectedService]=useState(null);
    const[selectedServices,setSelectedServices]=useState([]); // For multi-service
    const[multiService,setMultiService]=useState(false);
    const[selectedDate,setSelectedDate]=useState('');
    const[selectedTime,setSelectedTime]=useState('');
    const[notes,setNotes]=useState('');
    const[couponCode,setCouponCode]=useState('');
    const[couponApplied,setCouponApplied]=useState(false);
    const[paymentMethod,setPaymentMethod]=useState('cash');
    const[loading,setLoading]=useState(false);
    const[serviceType,setServiceType]=useState('salon'); // 'salon' or 'home'
    const[groupSize,setGroupSize]=useState(1);
    const[isRecurring,setIsRecurring]=useState(false);
    const[recurringFrequency,setRecurringFrequency]=useState('weekly');
    const[recurringCount,setRecurringCount]=useState(4);
    const[reminderEnabled,setReminderEnabled]=useState(true);
    
    if(!provider)return null;
    
    const providerServices=DB.getServices().filter(s=>s.categoryId===provider.categoryId);
    const selectedSrv=multiService?null:providerServices.find(s=>s.id===selectedService);
    const selectedSrvs=multiService?providerServices.filter(s=>selectedServices.includes(s.id)):[];
    const times=['09:00','09:30','10:00','10:30','11:00','11:30','14:00','14:30','15:00','15:30','16:00','16:30','17:00','17:30'];
    const dates=Array.from({length:14},(_,i)=>{const d=new Date();d.setDate(d.getDate()+i);return{value:d.toISOString().split('T')[0],day:d.toLocaleDateString('en',{weekday:'short'}),date:d.getDate(),month:d.toLocaleDateString('en',{month:'short'})}});
    
    // Check blocked slots
    const blockedSlots=DB.getBlockedSlots(provider.id);
    const isBlocked=(date,time)=>blockedSlots.some(b=>b.date===date&&time>=b.startTime&&time<b.endTime);
    
    const homeServiceFee=serviceType==='home'?15:0;
    const groupDiscount=DB.getGroupDiscount(groupSize);
    const membershipDiscount=DB.getMembershipDiscount(user.id);
    const couponDiscount=couponApplied?10:0;
    
    // Calculate subtotal for multi-service
    const basePrice=multiService?selectedSrvs.reduce((sum,s)=>sum+s.basePrice,0):(selectedSrv?.basePrice||0);
    const subtotal=basePrice*groupSize;
    const recurringMultiplier=isRecurring?recurringCount:1;
    const totalDiscountPercent=groupDiscount+membershipDiscount;
    const discountAmount=Math.round(subtotal*(totalDiscountPercent/100))+couponDiscount;
    const singleTotal=Math.max(0,subtotal-discountAmount+homeServiceFee);
    const total=singleTotal*recurringMultiplier;

    const applyCoupon=()=>{
      if(couponCode.toLowerCase()==='save10'){setCouponApplied(true);toast.show('Coupon applied! â‚¬10 off','success')}
      else{toast.show('Invalid coupon code','error')}
    };

    const handleBook=async()=>{
      const hasService=multiService?selectedServices.length>0:selectedService;
      if(!hasService||!selectedDate||!selectedTime){toast.show('Please select all options','warning');return}
      
      // PLAN M: Check wallet balance if wallet payment
      const walletBalance=DB.getWallet(user.id).balance;
      if(paymentMethod==='wallet'&&walletBalance<total){
        toast.show('Insufficient wallet balance. Please top up or use another method.','error');
        return;
      }
      
      setLoading(true);
      
      // PLAN M: Process Payment
      let paymentResult={success:true};
      
      if(paymentMethod==='wallet'){
        // Deduct from wallet
        paymentResult=DB.deductFromWallet(user.id,total,`Booking at ${provider.businessName}`);
      }else if(paymentMethod==='card'){
        // Process card payment
        paymentResult=await DB.processPayment({
          userId:user.id,
          amount:total,
          method:'card',
          cardId:DB.getSavedCards(user.id)[0]?.id,
          description:`Booking at ${provider.businessName}`
        });
      }else if(paymentMethod==='split'){
        // Split payment
        paymentResult=await DB.processSplitPayment({
          userId:user.id,
          totalAmount:total,
          walletAmount:walletBalance,
          cardAmount:total-walletBalance,
          cardId:DB.getSavedCards(user.id)[0]?.id,
          description:`Booking at ${provider.businessName}`
        });
      }
      // Cash - no payment processing needed
      
      if(!paymentResult.success){
        toast.show(paymentResult.error||'Payment failed','error');
        setLoading(false);
        return;
      }
      
      const serviceName=multiService?selectedSrvs.map(s=>s.name).join(', '):selectedSrv?.name;
      const serviceId=multiService?selectedServices[0]:selectedService;
      
      const bookingData={
        userId:user.id,
        providerId:provider.id,
        serviceId,
        serviceName,
        services:multiService?selectedSrvs:[selectedSrv],
        date:selectedDate,
        time:selectedTime,
        price:singleTotal,
        paymentMethod,
        paymentStatus:paymentMethod==='cash'?'pending':'paid',
        transactionId:paymentResult.transaction?.id,
        notes,
        serviceType,
        groupSize,
        isMultiService:multiService&&selectedServices.length>1
      };

      if(isRecurring){
        // Create recurring bookings
        DB.createRecurringBooking(bookingData,recurringFrequency,recurringCount);
        toast.show(`${recurringCount} recurring appointments scheduled! ðŸ”`,'success');
      }else if(groupSize>1){
        // Group booking
        DB.addGroupBooking({...bookingData,status:'pending'});
        toast.show(`Booking confirmed for ${groupSize} people! ðŸŽ‰`,'success');
      }else{
        // Single booking
        const booking=DB.addBooking({id:'booking_'+Date.now(),...bookingData,status:'pending',createdAt:new Date().toISOString()});
        
        // Schedule reminder if enabled
        if(reminderEnabled&&booking){
          DB.scheduleReminder(booking.id,'oneday');
          DB.scheduleReminder(booking.id,'onehour');
        }
        
        if(paymentMethod!=='cash'){
          toast.show('Payment successful! Booking confirmed! ðŸŽ‰','success');
        }else{
          toast.show('Booking confirmed! Pay at salon ðŸŽ‰','success');
        }
      }
      
      setLoading(false);
      onClose();
      setRefresh(r=>r+1);
      
      // If home service, show live tracking option
      if(serviceType==='home'){
        setTimeout(()=>toast.show('You can track your provider when they arrive!','info'),2000);
      }
    };

    return(
      <div className="fixed inset-0 z-50 flex items-end justify-center">
        <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={onClose}></div>
        <div className="w-full max-w-md bg-white rounded-t-[32px] shadow-2xl anim-slide-up relative z-50 max-h-[90vh] overflow-hidden flex flex-col">
          {/* Header */}
          <div className="p-5 border-b shrink-0">
            <div className="w-12 h-1.5 bg-gray-300 rounded-full mx-auto mb-4"></div>
            <div className="flex gap-4 items-center">
              <img src={provider.image} className="w-14 h-14 rounded-2xl object-cover shadow"/>
              <div className="flex-1 min-w-0">
                <h2 className="font-bold truncate">{provider.businessName}</h2>
                <p className="text-sm text-gray-500 truncate">{provider.address?.slice(0,30)}</p>
              </div>
              <button onClick={onClose} className="w-9 h-9 bg-gray-100 rounded-xl flex items-center justify-center">
                <i className="fa-solid fa-times text-gray-500"></i>
              </button>
            </div>
            {/* Steps */}
            <div className="flex items-center gap-2 mt-4">
              {[1,2,3].map(s=>(
                <div key={s} className={`flex-1 h-1 rounded-full ${step>=s?'gradient-primary':'bg-gray-200'}`}></div>
              ))}
            </div>
          </div>

          {/* Content */}
          <div className="flex-1 overflow-y-auto p-5">
            {step===1&&(
              <div className="anim-fade">
                {/* Service Type: Home or Salon */}
                <h3 className="font-bold mb-3">Service Location</h3>
                <div className="grid grid-cols-2 gap-3 mb-6">
                  <button onClick={()=>setServiceType('salon')} className={`p-4 rounded-2xl border-2 text-center transition-all ${serviceType==='salon'?'border-pink-500 bg-pink-50':'border-gray-200'}`}>
                    <i className={`fa-solid fa-store text-2xl mb-2 ${serviceType==='salon'?'text-pink-500':'text-gray-400'}`}></i>
                    <p className="font-bold text-sm">At Salon</p>
                  </button>
                  <button onClick={()=>setServiceType('home')} className={`p-4 rounded-2xl border-2 text-center transition-all ${serviceType==='home'?'border-pink-500 bg-pink-50':'border-gray-200'} relative`}>
                    <i className={`fa-solid fa-house text-2xl mb-2 ${serviceType==='home'?'text-pink-500':'text-gray-400'}`}></i>
                    <p className="font-bold text-sm">Home Service</p>
                    <span className="absolute -top-2 -right-2 bg-green-500 text-white text-[10px] px-2 py-0.5 rounded-full">+â‚¬15</span>
                  </button>
                </div>

                {/* Group Booking */}
                <h3 className="font-bold mb-3">Number of People</h3>
                <div className="flex items-center gap-4 mb-6 bg-gray-50 rounded-2xl p-4">
                  <button onClick={()=>setGroupSize(Math.max(1,groupSize-1))} className="w-10 h-10 bg-white rounded-xl flex items-center justify-center border shadow-sm">
                    <i className="fa-solid fa-minus text-gray-600"></i>
                  </button>
                  <div className="flex-1 text-center">
                    <p className="text-3xl font-bold">{groupSize}</p>
                    <p className="text-xs text-gray-500">{groupSize===1?'Person':'People'}</p>
                  </div>
                  <button onClick={()=>setGroupSize(Math.min(10,groupSize+1))} className="w-10 h-10 bg-white rounded-xl flex items-center justify-center border shadow-sm">
                    <i className="fa-solid fa-plus text-gray-600"></i>
                  </button>
                </div>
                {groupSize>=3&&(
                  <div className="bg-green-50 border border-green-200 rounded-2xl p-3 mb-4 flex items-center gap-3">
                    <i className="fa-solid fa-tag text-green-500"></i>
                    <p className="text-sm text-green-700 font-medium">Group discount: {DB.getGroupDiscount(groupSize)}% off!</p>
                  </div>
                )}

                {/* Multi-Service Toggle */}
                <div className="flex items-center justify-between bg-purple-50 rounded-2xl p-4 mb-4">
                  <div className="flex items-center gap-3">
                    <i className="fa-solid fa-layer-group text-purple-500"></i>
                    <div>
                      <p className="font-bold text-sm">Multiple Services</p>
                      <p className="text-xs text-gray-500">Select more than one service</p>
                    </div>
                  </div>
                  <button onClick={()=>setMultiService(!multiService)} className={`w-12 h-7 rounded-full transition-all ${multiService?'bg-purple-500':'bg-gray-300'}`}>
                    <div className={`w-5 h-5 bg-white rounded-full shadow transition-all ${multiService?'ml-6':'ml-1'}`}></div>
                  </button>
                </div>

                <h3 className="font-bold mb-3">Select Service{multiService?'s':''}</h3>
                <div className="space-y-3">
                  {providerServices.map(s=>{
                    const isSelected=multiService?selectedServices.includes(s.id):selectedService===s.id;
                    return(
                    <button key={s.id} onClick={()=>{
                      if(multiService){
                        setSelectedServices(prev=>prev.includes(s.id)?prev.filter(x=>x!==s.id):[...prev,s.id]);
                      }else{
                        setSelectedService(s.id);
                      }
                    }} className={`w-full flex justify-between items-center p-4 rounded-2xl border-2 transition-all ${isSelected?'border-pink-500 bg-pink-50':'border-gray-100 hover:border-gray-200'}`}>
                      <div className="text-left flex items-center gap-3">
                        {multiService&&(
                          <div className={`w-5 h-5 rounded-md border-2 flex items-center justify-center ${isSelected?'bg-pink-500 border-pink-500':'border-gray-300'}`}>
                            {isSelected&&<i className="fa-solid fa-check text-white text-xs"></i>}
                          </div>
                        )}
                        <div>
                          <p className="font-bold">{s.name}</p>
                          <p className="text-xs text-gray-500 mt-1"><i className="fa-regular fa-clock mr-1"></i>{s.duration} mins</p>
                        </div>
                      </div>
                      <span className="font-bold text-pink-600 text-lg">â‚¬{s.basePrice}</span>
                    </button>
                  )})}
                </div>
                {multiService&&selectedServices.length>0&&(
                  <div className="mt-3 bg-purple-50 rounded-xl p-3">
                    <p className="text-sm text-purple-700"><i className="fa-solid fa-check-double mr-1"></i>{selectedServices.length} services selected</p>
                  </div>
                )}
                {providerServices.length===0&&<p className="text-center py-8 text-gray-500">No services available</p>}
              </div>
            )}

            {step===2&&(
              <div className="anim-fade">
                <h3 className="font-bold mb-4">Select Date & Time</h3>
                {/* Date */}
                <p className="text-sm text-gray-500 mb-2">Date</p>
                <div className="flex gap-2 overflow-x-auto pb-4 no-scrollbar">
                  {dates.map(d=>{
                    const dayBlocked=blockedSlots.some(b=>b.date===d.value&&b.startTime==='00:00');
                    return(
                    <button key={d.value} onClick={()=>!dayBlocked&&setSelectedDate(d.value)} disabled={dayBlocked} className={`flex flex-col items-center min-w-[65px] py-3 px-3 rounded-2xl border-2 transition-all ${dayBlocked?'opacity-40 border-gray-200 bg-gray-100':selectedDate===d.value?'border-pink-500 bg-pink-50':'border-gray-100'}`}>
                      <span className="text-xs text-gray-500">{d.day}</span>
                      <span className="text-xl font-bold mt-1">{d.date}</span>
                      <span className="text-xs text-gray-400">{dayBlocked?'Closed':d.month}</span>
                    </button>
                  )})}
                </div>
                {/* Time */}
                <p className="text-sm text-gray-500 mb-2 mt-2">Time</p>
                <div className="grid grid-cols-4 gap-2">
                  {times.map(t=>{
                    const slotBlocked=selectedDate&&isBlocked(selectedDate,t);
                    return(
                    <button key={t} onClick={()=>!slotBlocked&&setSelectedTime(t)} disabled={slotBlocked} className={`py-3 rounded-xl text-sm font-bold border-2 transition-all ${slotBlocked?'opacity-40 bg-gray-100 border-gray-200 line-through':selectedTime===t?'border-pink-500 bg-pink-50 text-pink-600':'border-gray-100 text-gray-600'}`}>{t}</button>
                  )})}
                </div>

                {/* Recurring Booking Option */}
                <div className="mt-6 bg-purple-50 rounded-2xl p-4">
                  <div className="flex items-center justify-between mb-3">
                    <div className="flex items-center gap-3">
                      <i className="fa-solid fa-repeat text-purple-500"></i>
                      <div>
                        <p className="font-bold text-sm">Recurring Booking</p>
                        <p className="text-xs text-gray-500">Schedule regular appointments</p>
                      </div>
                    </div>
                    <button onClick={()=>setIsRecurring(!isRecurring)} className={`w-12 h-7 rounded-full transition-all ${isRecurring?'bg-purple-500':'bg-gray-300'}`}>
                      <div className={`w-5 h-5 bg-white rounded-full shadow transition-all ${isRecurring?'ml-6':'ml-1'}`}></div>
                    </button>
                  </div>
                  {isRecurring&&(
                    <div className="space-y-3 pt-3 border-t border-purple-200">
                      <div>
                        <p className="text-xs text-gray-600 mb-2">Repeat every</p>
                        <div className="flex gap-2">
                          {[{id:'weekly',label:'Week'},{id:'biweekly',label:'2 Weeks'},{id:'monthly',label:'Month'}].map(f=>(
                            <button key={f.id} onClick={()=>setRecurringFrequency(f.id)} className={`flex-1 py-2 rounded-xl text-sm font-medium ${recurringFrequency===f.id?'bg-purple-500 text-white':'bg-white'}`}>{f.label}</button>
                          ))}
                        </div>
                      </div>
                      <div>
                        <p className="text-xs text-gray-600 mb-2">Number of appointments: {recurringCount}</p>
                        <input type="range" min="2" max="12" value={recurringCount} onChange={e=>setRecurringCount(Number(e.target.value))} className="w-full"/>
                      </div>
                      <p className="text-xs text-purple-600"><i className="fa-solid fa-info-circle mr-1"></i>Total: â‚¬{singleTotal} Ã— {recurringCount} = â‚¬{total}</p>
                    </div>
                  )}
                </div>

                {/* Reminder Toggle */}
                <div className="mt-4 flex items-center justify-between bg-orange-50 rounded-2xl p-4">
                  <div className="flex items-center gap-3">
                    <i className="fa-solid fa-bell text-orange-500"></i>
                    <div>
                      <p className="font-bold text-sm">Reminder</p>
                      <p className="text-xs text-gray-500">Get notified before appointment</p>
                    </div>
                  </div>
                  <button onClick={()=>setReminderEnabled(!reminderEnabled)} className={`w-12 h-7 rounded-full transition-all ${reminderEnabled?'bg-orange-500':'bg-gray-300'}`}>
                    <div className={`w-5 h-5 bg-white rounded-full shadow transition-all ${reminderEnabled?'ml-6':'ml-1'}`}></div>
                  </button>
                </div>

                {/* Notes */}
                <p className="text-sm text-gray-500 mb-2 mt-4">Special Requests (Optional)</p>
                <textarea value={notes} onChange={e=>setNotes(e.target.value)} placeholder="Any notes for the provider..." className="w-full p-4 bg-gray-50 rounded-2xl text-sm resize-none h-20 outline-none focus:ring-2 ring-pink-200"></textarea>
              </div>
            )}

            {step===3&&(
              <div className="anim-fade">
                <h3 className="font-bold mb-4">Confirm & Pay</h3>
                {/* Summary */}
                <div className="bg-gray-50 rounded-2xl p-4 mb-4">
                  <p className="text-sm text-gray-500 mb-3">Booking Summary</p>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between"><span className="text-gray-600">Service</span><span className="font-bold">{multiService?`${selectedSrvs.length} services`:selectedSrv?.name}</span></div>
                    <div className="flex justify-between"><span className="text-gray-600">Location</span><span className="font-bold">{serviceType==='home'?'ðŸ  Home Service':'ðŸª At Salon'}</span></div>
                    <div className="flex justify-between"><span className="text-gray-600">People</span><span className="font-bold">{groupSize}</span></div>
                    <div className="flex justify-between"><span className="text-gray-600">Date</span><span className="font-bold">{selectedDate}</span></div>
                    <div className="flex justify-between"><span className="text-gray-600">Time</span><span className="font-bold">{selectedTime}</span></div>
                    {isRecurring&&<div className="flex justify-between text-purple-600"><span>Recurring</span><span className="font-bold">{recurringCount}x {recurringFrequency}</span></div>}
                  </div>
                </div>
                {/* Coupon */}
                <div className="flex gap-2 mb-4">
                  <input type="text" value={couponCode} onChange={e=>setCouponCode(e.target.value)} placeholder="Coupon code" disabled={couponApplied} className="flex-1 px-4 py-3 bg-gray-50 rounded-xl text-sm outline-none"/>
                  <button onClick={applyCoupon} disabled={couponApplied||!couponCode} className={`px-4 py-3 rounded-xl font-bold text-sm ${couponApplied?'bg-green-100 text-green-600':'bg-gray-900 text-white'}`}>
                    {couponApplied?<i className="fa-solid fa-check"></i>:'Apply'}
                  </button>
                </div>
                
                {/* PLAN M: Enhanced Payment Methods */}
                <p className="text-sm text-gray-500 mb-2">Payment Method</p>
                <div className="space-y-2 mb-4">
                  {/* Wallet Option with Balance */}
                  <button onClick={()=>setPaymentMethod('wallet')} className={`w-full p-3 rounded-xl border-2 flex items-center gap-3 transition-all ${paymentMethod==='wallet'?'border-pink-500 bg-pink-50':'border-gray-100'}`}>
                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${paymentMethod==='wallet'?'bg-pink-500 text-white':'bg-gray-100 text-gray-500'}`}>
                      <i className="fa-solid fa-wallet"></i>
                    </div>
                    <div className="flex-1 text-left">
                      <p className="font-bold text-sm">GoBeauty Wallet</p>
                      <p className="text-xs text-gray-500">Balance: â‚¬{DB.getWallet(user.id).balance.toFixed(2)}</p>
                    </div>
                    {paymentMethod==='wallet'&&<i className="fa-solid fa-check-circle text-pink-500"></i>}
                    {DB.getWallet(user.id).balance<total&&paymentMethod!=='wallet'&&<span className="text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded-full">Low</span>}
                  </button>
                  
                  {/* Card Option */}
                  <button onClick={()=>setPaymentMethod('card')} className={`w-full p-3 rounded-xl border-2 flex items-center gap-3 transition-all ${paymentMethod==='card'?'border-pink-500 bg-pink-50':'border-gray-100'}`}>
                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${paymentMethod==='card'?'bg-blue-500 text-white':'bg-gray-100 text-gray-500'}`}>
                      <i className="fa-solid fa-credit-card"></i>
                    </div>
                    <div className="flex-1 text-left">
                      <p className="font-bold text-sm">Credit/Debit Card</p>
                      <p className="text-xs text-gray-500">{DB.getSavedCards(user.id).length>0?`â€¢â€¢â€¢â€¢ ${DB.getSavedCards(user.id)[0].last4}`:'Add new card'}</p>
                    </div>
                    {paymentMethod==='card'&&<i className="fa-solid fa-check-circle text-pink-500"></i>}
                  </button>
                  
                  {/* Split Payment (if wallet has some balance) */}
                  {DB.getWallet(user.id).balance>0&&DB.getWallet(user.id).balance<total&&(
                    <button onClick={()=>setPaymentMethod('split')} className={`w-full p-3 rounded-xl border-2 flex items-center gap-3 transition-all ${paymentMethod==='split'?'border-pink-500 bg-pink-50':'border-gray-100'}`}>
                      <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${paymentMethod==='split'?'bg-purple-500 text-white':'bg-gray-100 text-gray-500'}`}>
                        <i className="fa-solid fa-arrows-split-up-and-left"></i>
                      </div>
                      <div className="flex-1 text-left">
                        <p className="font-bold text-sm">Split Payment</p>
                        <p className="text-xs text-gray-500">â‚¬{DB.getWallet(user.id).balance.toFixed(2)} wallet + â‚¬{(total-DB.getWallet(user.id).balance).toFixed(2)} card</p>
                      </div>
                      {paymentMethod==='split'&&<i className="fa-solid fa-check-circle text-pink-500"></i>}
                    </button>
                  )}
                  
                  {/* Cash Option */}
                  <button onClick={()=>setPaymentMethod('cash')} className={`w-full p-3 rounded-xl border-2 flex items-center gap-3 transition-all ${paymentMethod==='cash'?'border-pink-500 bg-pink-50':'border-gray-100'}`}>
                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${paymentMethod==='cash'?'bg-green-500 text-white':'bg-gray-100 text-gray-500'}`}>
                      <i className="fa-solid fa-money-bill"></i>
                    </div>
                    <div className="flex-1 text-left">
                      <p className="font-bold text-sm">Cash</p>
                      <p className="text-xs text-gray-500">Pay at the salon</p>
                    </div>
                    {paymentMethod==='cash'&&<i className="fa-solid fa-check-circle text-pink-500"></i>}
                  </button>
                </div>
                
                {/* Insufficient Balance Warning */}
                {paymentMethod==='wallet'&&DB.getWallet(user.id).balance<total&&(
                  <div className="bg-red-50 border border-red-200 rounded-xl p-3 mb-4 flex items-center gap-2">
                    <i className="fa-solid fa-exclamation-circle text-red-500"></i>
                    <p className="text-xs text-red-600">Insufficient wallet balance. Please top up or choose another method.</p>
                  </div>
                )}
                
                {/* Price Breakdown */}
                <div className="bg-gray-900 text-white rounded-2xl p-4">
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between"><span className="opacity-70">Service ({groupSize}x â‚¬{basePrice})</span><span>â‚¬{subtotal}</span></div>
                    {serviceType==='home'&&<div className="flex justify-between"><span className="opacity-70">Home Service Fee</span><span>+â‚¬{homeServiceFee}</span></div>}
                    {groupDiscount>0&&<div className="flex justify-between text-green-400"><span>Group Discount ({groupDiscount}%)</span><span>-â‚¬{Math.round(subtotal*(groupDiscount/100))}</span></div>}
                    {membershipDiscount>0&&<div className="flex justify-between text-yellow-400"><span>ðŸ’Ž Member ({membershipDiscount}%)</span><span>-â‚¬{Math.round(subtotal*(membershipDiscount/100))}</span></div>}
                    {couponApplied&&<div className="flex justify-between text-green-400"><span>Coupon</span><span>-â‚¬{couponDiscount}</span></div>}
                    <div className="flex justify-between text-lg font-bold pt-2 border-t border-white/20"><span>Total</span><span>â‚¬{total}</span></div>
                    {paymentMethod==='split'&&(
                      <div className="pt-2 border-t border-white/10 text-xs opacity-70">
                        <div className="flex justify-between"><span>From Wallet</span><span>â‚¬{DB.getWallet(user.id).balance.toFixed(2)}</span></div>
                        <div className="flex justify-between"><span>From Card</span><span>â‚¬{(total-DB.getWallet(user.id).balance).toFixed(2)}</span></div>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            )}
          </div>

          {/* Footer */}
          <div className="p-5 border-t shrink-0">
            <div className="flex gap-3">
              {step>1&&(
                <button onClick={()=>setStep(step-1)} className="w-14 h-14 bg-gray-100 rounded-2xl flex items-center justify-center">
                  <i className="fa-solid fa-arrow-left text-gray-600"></i>
                </button>
              )}
              {step<3?(
                <button onClick={()=>setStep(step+1)} disabled={step===1&&!selectedService||step===2&&(!selectedDate||!selectedTime)} className="flex-1 py-4 gradient-primary text-white rounded-2xl font-bold disabled:opacity-50">
                  Continue
                </button>
              ):(
                <button onClick={handleBook} disabled={loading} className="flex-1 py-4 gradient-primary text-white rounded-2xl font-bold flex items-center justify-center gap-2 disabled:opacity-50">
                  {loading?<><div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div>Processing...</>:<><i className="fa-solid fa-check"></i>Confirm Booking</>}
                </button>
              )}
            </div>
          </div>
        </div>
      </div>
    )
  };

  // MODULE 24: Provider Profile
  const ProviderProfile=({provider,onClose,onBook})=>{
    const[activeTab,setActiveTab]=useState('services');
    const[showReviewForm,setShowReviewForm]=useState(false);
    const[reviewRating,setReviewRating]=useState(0);
    const[reviewText,setReviewText]=useState('');
    const[reviewPhotos,setReviewPhotos]=useState([]);
    const[submittingReview,setSubmittingReview]=useState(false);
    const[showReportModal,setShowReportModal]=useState(false);
    const[reportingReview,setReportingReview]=useState(null);
    const[reportReason,setReportReason]=useState('');
    
    if(!provider)return null;
    
    const cat=categories.find(c=>c.id===provider.categoryId);
    const providerServices=DB.getServices().filter(s=>s.categoryId===provider.categoryId);
    const reviews=[{id:1,name:'Sarah M.',rating:5,text:'Amazing service! Highly recommend.',date:'2 days ago'},{id:2,name:'John D.',rating:4,text:'Great experience, will come back.',date:'1 week ago'}];
    
    return(
      <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
        {/* Scrollable Content */}
        <div className="flex-1 overflow-y-auto smooth-scroll">
          {/* Cover Image */}
          <div className="relative h-48 shrink-0">
            <img src={provider.coverImage} className="w-full h-full object-cover"/>
            <div className="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"></div>
            <button onClick={onClose} className="absolute top-3 left-3 w-9 h-9 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-white">
              <i className="fa-solid fa-arrow-left text-sm"></i>
            </button>
            <button onClick={()=>toggleFavorite(provider.id)} className="absolute top-3 right-3 w-9 h-9 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
              <i className={`fa-${favorites.includes(provider.id)?'solid':'regular'} fa-heart text-sm ${favorites.includes(provider.id)?'text-red-500':'text-white'}`}></i>
            </button>
            <div className="absolute bottom-3 left-3 right-3">
              <div className="flex items-end gap-3">
                <img src={provider.image} className="w-16 h-16 rounded-xl border-3 border-white shadow-lg object-cover"/>
                <div className="flex-1 text-white pb-1">
                  <div className="flex items-center gap-1.5">
                    <h1 className="text-lg font-bold">{provider.businessName}</h1>
                    {provider.verified&&<i className="fa-solid fa-badge-check text-blue-400 text-sm"></i>}
                  </div>
                  <p className="text-xs opacity-80">{cat?.name}</p>
                </div>
              </div>
            </div>
          </div>

          {/* Stats */}
          <div className="grid grid-cols-3 gap-2 p-3 bg-white border-b">
            <div className="text-center">
              <div className="flex items-center justify-center gap-1 text-base font-bold">
                <i className="fa-solid fa-star text-yellow-400 text-sm"></i>{provider.rating||'New'}
              </div>
              <p className="text-[10px] text-gray-500">{provider.reviewCount||0} Reviews</p>
            </div>
            <div className="text-center border-x">
              <p className="text-base font-bold">{providerServices.length}</p>
              <p className="text-[10px] text-gray-500">Services</p>
            </div>
            <div className="text-center">
              <p className="text-base font-bold">{Math.floor(Math.random()*50)+10}+</p>
              <p className="text-[10px] text-gray-500">Clients</p>
            </div>
          </div>

          {/* Tabs */}
          <div className="flex border-b sticky top-0 bg-white z-10">
            {['services','about','reviews'].map(t=>(
              <button key={t} onClick={()=>setActiveTab(t)} className={`flex-1 py-2.5 text-xs font-bold capitalize ${activeTab===t?'text-pink-500 border-b-2 border-pink-500':'text-gray-500'}`}>{t}</button>
            ))}
          </div>

          {/* Content */}
          <div className="p-3">
            {activeTab==='services'&&(
              <div className="space-y-2">
                {providerServices.map(s=>{
                  const serviceImg=DB.getServiceImage(provider.id,s.id);
                  return(
                  <div key={s.id} className="bg-gray-50 rounded-xl p-3 flex gap-2.5 items-center">
                    {serviceImg?(
                      <img src={serviceImg} className="w-14 h-14 rounded-lg object-cover shrink-0"/>
                    ):(
                      <div className="w-14 h-14 rounded-lg bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center shrink-0">
                        <i className="fa-solid fa-spa text-xl text-pink-400"></i>
                      </div>
                    )}
                    <div className="flex-1 min-w-0">
                      <p className="font-semibold text-[13px]">{s.name}</p>
                      <p className="text-[10px] text-gray-500 mt-0.5"><i className="fa-regular fa-clock mr-1"></i>{s.duration} mins</p>
                    </div>
                    <div className="text-right shrink-0">
                      <p className="font-bold text-pink-600 text-[13px]">â‚¬{s.basePrice}</p>
                      <button onClick={()=>onBook()} className="text-[10px] text-pink-500 font-bold mt-0.5">Book</button>
                    </div>
                  </div>
                )})}
              </div>
            )}
            {activeTab==='about'&&(
              <div className="space-y-3">
              {/* Gallery */}
              {DB.getProviderGallery(provider.id).length>0&&(
                <div>
                  <h3 className="font-bold mb-3">Gallery</h3>
                  <div className="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
                    {DB.getProviderGallery(provider.id).map(img=>(
                      <div key={img.id} className="w-24 h-24 shrink-0 rounded-xl overflow-hidden">
                        <img src={img.url} className="w-full h-full object-cover"/>
                      </div>
                    ))}
                  </div>
                </div>
              )}
              <div>
                <h3 className="font-bold mb-2">About</h3>
                <p className="text-sm text-gray-600">{provider.description||'Professional beauty services with experienced staff and premium products.'}</p>
              </div>
              <div>
                <h3 className="font-bold mb-2">Location</h3>
                <div className="bg-gray-100 rounded-2xl h-40 flex items-center justify-center">
                  <p className="text-gray-500 text-sm"><i className="fa-solid fa-location-dot mr-2"></i>{provider.address}</p>
                </div>
              </div>
              <div>
                <h3 className="font-bold mb-2">Working Hours</h3>
                <div className="text-sm text-gray-600 space-y-1">
                  <p>Monday - Friday: 9:00 AM - 6:00 PM</p>
                  <p>Saturday: 10:00 AM - 4:00 PM</p>
                  <p>Sunday: Closed</p>
                </div>
              </div>
            </div>
          )}
          {activeTab==='reviews'&&(
            <div className="space-y-4">
              {/* Write Review Button */}
              <button onClick={()=>setShowReviewForm(true)} className="w-full py-3 border-2 border-dashed border-pink-300 rounded-2xl text-pink-500 font-bold flex items-center justify-center gap-2">
                <i className="fa-solid fa-star"></i>Write a Review
              </button>
              
              {/* Reviews List */}
              {DB.getProviderReviews(provider.id).length>0?(
                DB.getProviderReviews(provider.id).map(r=>(
                  <div key={r.id} className="bg-gray-50 rounded-2xl p-4">
                    <div className="flex items-center gap-3 mb-2">
                      <div className="w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center font-bold text-pink-600">{r.userName?.charAt(0)||'U'}</div>
                      <div className="flex-1">
                        <p className="font-bold text-sm">{r.userName||'Customer'}</p>
                        <div className="flex items-center gap-2">
                          <div className="flex">{[1,2,3,4,5].map(i=><i key={i} className={`fa-solid fa-star text-xs ${i<=r.rating?'text-yellow-400':'text-gray-300'}`}></i>)}</div>
                          <span className="text-xs text-gray-400">{new Date(r.createdAt).toLocaleDateString()}</span>
                        </div>
                      </div>
                      {/* Report Button */}
                      <button onClick={()=>{setReportingReview(r);setShowReportModal(true)}} className="text-gray-400 hover:text-red-500">
                        <i className="fa-solid fa-flag text-xs"></i>
                      </button>
                    </div>
                    <p className="text-sm text-gray-600">{r.text}</p>
                    {r.photos&&r.photos.length>0&&(
                      <div className="flex gap-2 mt-3 overflow-x-auto">
                        {r.photos.map(p=>(
                          <img key={p.id} src={p.url} className="w-16 h-16 rounded-lg object-cover shrink-0"/>
                        ))}
                      </div>
                    )}
                    {/* Provider Reply */}
                    {r.reply&&(
                      <div className="mt-3 bg-blue-50 rounded-xl p-3 border-l-4 border-blue-400">
                        <div className="flex items-center gap-2 mb-1">
                          <i className="fa-solid fa-reply text-blue-500 text-xs"></i>
                          <span className="text-xs font-bold text-blue-600">{r.reply.by} replied</span>
                          <span className="text-xs text-gray-400">{new Date(r.reply.createdAt).toLocaleDateString()}</span>
                        </div>
                        <p className="text-sm text-gray-600">{r.reply.text}</p>
                      </div>
                    )}
                    {/* Helpful Button */}
                    <div className="flex items-center gap-4 mt-3 pt-2 border-t border-gray-100">
                      <button onClick={()=>{DB.markReviewHelpful(r.id);toast.show('Thanks for feedback!','success');setRefresh(x=>x+1)}} className="text-xs text-gray-500 hover:text-pink-500 flex items-center gap-1">
                        <i className="fa-regular fa-thumbs-up"></i>Helpful ({r.helpful||0})
                      </button>
                    </div>
                  </div>
                ))
              ):(
                reviews.map(r=>(
                  <div key={r.id} className="bg-gray-50 rounded-2xl p-4">
                    <div className="flex items-center gap-3 mb-2">
                      <div className="w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center font-bold text-pink-600">{r.name.charAt(0)}</div>
                      <div className="flex-1">
                        <p className="font-bold text-sm">{r.name}</p>
                        <div className="flex items-center gap-2">
                          <div className="flex">{[1,2,3,4,5].map(i=><i key={i} className={`fa-solid fa-star text-xs ${i<=r.rating?'text-yellow-400':'text-gray-300'}`}></i>)}</div>
                          <span className="text-xs text-gray-400">{r.date}</span>
                        </div>
                      </div>
                    </div>
                    <p className="text-sm text-gray-600">{r.text}</p>
                  </div>
                ))
              )}
            </div>
          )}
          </div>
        </div>

        {/* Book Button - Fixed at Bottom */}
        <div className="p-3 border-t shrink-0 bg-white">
          <button onClick={onBook} className="w-full py-3 gradient-primary text-white rounded-xl font-bold text-sm flex items-center justify-center gap-2">
            <i className="fa-solid fa-calendar-check text-sm"></i>Book Appointment
          </button>
        </div>

        {/* Report Review Modal */}
        {showReportModal&&reportingReview&&(
          <div className="absolute inset-0 bg-black/50 z-20 flex items-center justify-center p-4">
            <div className="bg-white rounded-3xl p-5 w-full max-w-sm anim-scale">
              <h3 className="text-lg font-bold mb-4">Report Review</h3>
              <p className="text-sm text-gray-500 mb-4">Why are you reporting this review?</p>
              <div className="space-y-2 mb-4">
                {['Spam or fake','Inappropriate content','Harassment','Off-topic','Other'].map(reason=>(
                  <button key={reason} onClick={()=>setReportReason(reason)} className={`w-full p-3 rounded-xl text-left text-sm font-medium border ${reportReason===reason?'border-pink-500 bg-pink-50 text-pink-600':'border-gray-200'}`}>
                    {reason}
                  </button>
                ))}
              </div>
              <div className="flex gap-3">
                <button onClick={()=>{setShowReportModal(false);setReportingReview(null);setReportReason('')}} className="flex-1 py-3 bg-gray-100 rounded-xl font-bold">Cancel</button>
                <button onClick={()=>{
                  if(!reportReason){toast.show('Select a reason','warning');return}
                  DB.reportReview(reportingReview.id,reportReason,user.id);
                  toast.show('Review reported. Thank you!','success');
                  setShowReportModal(false);setReportingReview(null);setReportReason('');
                  setRefresh(x=>x+1);
                }} disabled={!reportReason} className="flex-1 py-3 bg-red-500 text-white rounded-xl font-bold disabled:opacity-50">Report</button>
              </div>
            </div>
          </div>
        )}

        {/* Review Form Modal */}
        {showReviewForm&&(
          <div className="absolute inset-0 bg-white z-10 flex flex-col">
            <div className="p-5 border-b flex items-center gap-4">
              <button onClick={()=>setShowReviewForm(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
                <i className="fa-solid fa-arrow-left text-gray-600"></i>
              </button>
              <h1 className="text-xl font-bold">Write a Review</h1>
            </div>
            <div className="flex-1 overflow-y-auto p-5">
              {/* Rating */}
              <div className="text-center mb-6">
                <p className="text-sm text-gray-500 mb-3">Tap to rate</p>
                <div className="flex justify-center gap-2">
                  {[1,2,3,4,5].map(i=>(
                    <button key={i} onClick={()=>setReviewRating(i)} className="p-2">
                      <i className={`fa-solid fa-star text-3xl ${i<=reviewRating?'text-yellow-400':'text-gray-300'}`}></i>
                    </button>
                  ))}
                </div>
                <p className="text-sm font-medium mt-2">{reviewRating===0?'Select rating':reviewRating===1?'Poor':reviewRating===2?'Fair':reviewRating===3?'Good':reviewRating===4?'Very Good':'Excellent!'}</p>
              </div>

              {/* Review Text */}
              <textarea value={reviewText} onChange={e=>setReviewText(e.target.value)} placeholder="Share your experience..." className="w-full p-4 bg-gray-100 rounded-2xl resize-none h-32 outline-none focus:ring-2 ring-pink-200 mb-4"/>

              {/* Photos */}
              <div className="mb-4">
                <p className="text-sm font-bold mb-2">Add Photos (Optional)</p>
                <div className="flex gap-2 flex-wrap">
                  <label className="w-20 h-20 border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center text-gray-400 cursor-pointer hover:border-pink-400 hover:text-pink-400">
                    <i className="fa-solid fa-camera text-lg"></i>
                    <span className="text-[10px] mt-1">Add</span>
                    <input type="file" accept="image/*" multiple onChange={e=>{
                      const files=Array.from(e.target.files||[]).slice(0,5-reviewPhotos.length);
                      files.forEach(async f=>{
                        const base64=await DB.fileToBase64(f);
                        setReviewPhotos(prev=>[...prev,{id:Date.now(),file:f,preview:base64}]);
                      });
                    }} className="hidden"/>
                  </label>
                  {reviewPhotos.map((p,i)=>(
                    <div key={i} className="w-20 h-20 rounded-xl overflow-hidden relative">
                      <img src={p.preview} className="w-full h-full object-cover"/>
                      <button onClick={()=>setReviewPhotos(prev=>prev.filter((_,idx)=>idx!==i))} className="absolute top-1 right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs">
                        <i className="fa-solid fa-times"></i>
                      </button>
                    </div>
                  ))}
                </div>
                <p className="text-xs text-gray-400 mt-2">{reviewPhotos.length}/5 photos</p>
              </div>
            </div>

            <div className="p-5 border-t">
              <button onClick={async()=>{
                if(reviewRating===0){toast.show('Please select a rating','warning');return}
                if(!reviewText.trim()){toast.show('Please write something','warning');return}
                setSubmittingReview(true);
                const files=reviewPhotos.map(p=>p.file);
                const result=await DB.addReviewWithPhotos({
                  providerId:provider.id,
                  userId:user.id,
                  userName:userData.name,
                  rating:reviewRating,
                  text:reviewText
                },files);
                if(result.success){
                  toast.show('Review submitted! Thank you! ðŸŒŸ','success');
                  setShowReviewForm(false);
                  setReviewRating(0);setReviewText('');setReviewPhotos([]);
                  setRefresh(r=>r+1);
                }
                setSubmittingReview(false);
              }} disabled={submittingReview} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold flex items-center justify-center gap-2 disabled:opacity-50">
                {submittingReview?<><div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div>Submitting...</>:<><i className="fa-solid fa-paper-plane"></i>Submit Review</>}
              </button>
            </div>
          </div>
        )}
      </div>
    )
  };

  // MODULE 22: Filters Modal
  // PLAN K: Advanced Filters Modal (Modules 62-66)
  const filterOptions=DB.getFilterOptions();
  
  const FiltersModal=()=>{
    const[activeFilterTab,setActiveFilterTab]=useState('sort');
    const[tempFilters,setTempFilters]=useState({...filters});
    const[priceMin,setPriceMin]=useState(filters.minPrice||0);
    const[priceMax,setPriceMax]=useState(filters.maxPrice||200);
    
    const applyFilters=()=>{
      setFilters({...tempFilters,minPrice:priceMin>0?priceMin:null,maxPrice:priceMax<200?priceMax:null});
      setShowFilters(false);
    };
    
    const resetFilters=()=>{
      const defaultFilters={minRating:0,maxDistance:50,sortBy:'distance',minPrice:null,maxPrice:null,verifiedOnly:false,topRatedOnly:false,homeServiceOnly:false};
      setTempFilters(defaultFilters);
      setPriceMin(0);
      setPriceMax(200);
    };
    
    const activeCount=Object.entries(tempFilters).filter(([k,v])=>v&&v!==0&&v!=='distance'&&v!==50).length+(priceMin>0?1:0)+(priceMax<200?1:0);
    
    return showFilters&&(
      <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
        {/* Header */}
        <div className="p-5 border-b flex items-center justify-between shrink-0">
          <div className="flex items-center gap-3">
            <button onClick={()=>setShowFilters(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
              <i className="fa-solid fa-times text-gray-600"></i>
            </button>
            <h1 className="text-xl font-bold">Filters</h1>
            {activeCount>0&&<span className="bg-pink-500 text-white text-xs px-2 py-0.5 rounded-full">{activeCount} active</span>}
          </div>
          <button onClick={resetFilters} className="text-pink-500 font-bold text-sm">Reset All</button>
        </div>

        {/* Filter Tabs */}
        <div className="flex border-b px-2 shrink-0">
          {[{id:'sort',label:'Sort',icon:'fa-arrow-up-wide-short'},{id:'rating',label:'Rating',icon:'fa-star'},{id:'price',label:'Price',icon:'fa-tag'},{id:'distance',label:'Distance',icon:'fa-location-dot'},{id:'more',label:'More',icon:'fa-sliders'}].map(t=>(
            <button key={t.id} onClick={()=>setActiveFilterTab(t.id)} className={`flex-1 py-3 text-center text-xs font-bold border-b-2 transition-all ${activeFilterTab===t.id?'border-pink-500 text-pink-500':'border-transparent text-gray-500'}`}>
              <i className={`fa-solid ${t.icon} mr-1`}></i>{t.label}
            </button>
          ))}
        </div>

        {/* Filter Content */}
        <div className="flex-1 overflow-y-auto p-5">
          {/* Sort Tab */}
          {activeFilterTab==='sort'&&(
            <div className="space-y-3 anim-fade">
              <p className="text-sm text-gray-500 mb-4">Sort results by</p>
              {filterOptions.sortOptions.map(opt=>(
                <button key={opt.value} onClick={()=>setTempFilters(f=>({...f,sortBy:opt.value}))} className={`w-full p-4 rounded-2xl flex items-center gap-4 border-2 transition-all ${tempFilters.sortBy===opt.value?'border-pink-500 bg-pink-50':'border-gray-100'}`}>
                  <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${tempFilters.sortBy===opt.value?'bg-pink-500 text-white':'bg-gray-100 text-gray-500'}`}>
                    <i className={`fa-solid ${opt.icon}`}></i>
                  </div>
                  <span className="font-medium">{opt.label}</span>
                  {tempFilters.sortBy===opt.value&&<i className="fa-solid fa-check text-pink-500 ml-auto"></i>}
                </button>
              ))}
            </div>
          )}

          {/* Rating Tab */}
          {activeFilterTab==='rating'&&(
            <div className="anim-fade">
              <p className="text-sm text-gray-500 mb-4">Minimum rating</p>
              <div className="grid grid-cols-2 gap-3">
                <button onClick={()=>setTempFilters(f=>({...f,minRating:0}))} className={`p-4 rounded-2xl border-2 text-center ${tempFilters.minRating===0?'border-pink-500 bg-pink-50':'border-gray-100'}`}>
                  <p className="font-bold">All Ratings</p>
                  <p className="text-xs text-gray-500">Show everyone</p>
                </button>
                {filterOptions.ratings.map(r=>(
                  <button key={r.value} onClick={()=>setTempFilters(f=>({...f,minRating:r.value}))} className={`p-4 rounded-2xl border-2 text-center ${tempFilters.minRating===r.value?'border-pink-500 bg-pink-50':'border-gray-100'}`}>
                    <div className="flex items-center justify-center gap-1 mb-1">
                      <span className="text-xl font-bold">{r.value}</span>
                      <i className="fa-solid fa-star text-yellow-400"></i>
                    </div>
                    <p className="text-xs text-gray-500">& above</p>
                  </button>
                ))}
              </div>

              {/* Quick filters */}
              <div className="mt-6 space-y-3">
                <button onClick={()=>setTempFilters(f=>({...f,topRatedOnly:!f.topRatedOnly}))} className={`w-full p-4 rounded-2xl flex items-center gap-3 border-2 ${tempFilters.topRatedOnly?'border-yellow-500 bg-yellow-50':'border-gray-100'}`}>
                  <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${tempFilters.topRatedOnly?'bg-yellow-500 text-white':'bg-gray-100'}`}>
                    <i className="fa-solid fa-trophy"></i>
                  </div>
                  <div className="flex-1 text-left">
                    <p className="font-bold">Top Rated Only</p>
                    <p className="text-xs text-gray-500">4.5+ with 5+ reviews</p>
                  </div>
                  <div className={`w-12 h-7 rounded-full transition-all ${tempFilters.topRatedOnly?'bg-yellow-500':'bg-gray-300'}`}>
                    <div className={`w-5 h-5 bg-white rounded-full shadow mt-1 transition-all ${tempFilters.topRatedOnly?'ml-6':'ml-1'}`}></div>
                  </div>
                </button>
              </div>
            </div>
          )}

          {/* Price Tab */}
          {activeFilterTab==='price'&&(
            <div className="anim-fade">
              <p className="text-sm text-gray-500 mb-4">Price range per service</p>
              
              {/* Price Display */}
              <div className="bg-gradient-to-r from-pink-50 to-purple-50 rounded-2xl p-6 mb-6">
                <div className="flex items-center justify-between mb-4">
                  <div className="text-center">
                    <p className="text-xs text-gray-500">Min</p>
                    <p className="text-2xl font-bold text-pink-600">â‚¬{priceMin}</p>
                  </div>
                  <div className="text-gray-300">â€”</div>
                  <div className="text-center">
                    <p className="text-xs text-gray-500">Max</p>
                    <p className="text-2xl font-bold text-purple-600">â‚¬{priceMax}</p>
                  </div>
                </div>
                <div className="space-y-4">
                  <div>
                    <label className="text-xs text-gray-500">Minimum: â‚¬{priceMin}</label>
                    <input type="range" min="0" max="150" value={priceMin} onChange={e=>setPriceMin(Math.min(Number(e.target.value),priceMax-10))} className="w-full"/>
                  </div>
                  <div>
                    <label className="text-xs text-gray-500">Maximum: â‚¬{priceMax}</label>
                    <input type="range" min="10" max="200" value={priceMax} onChange={e=>setPriceMax(Math.max(Number(e.target.value),priceMin+10))} className="w-full"/>
                  </div>
                </div>
              </div>

              {/* Quick Price Options */}
              <p className="text-sm font-bold mb-3">Quick Select</p>
              <div className="grid grid-cols-2 gap-3">
                {filterOptions.priceRanges.map(pr=>(
                  <button key={pr.label} onClick={()=>{setPriceMin(pr.min);setPriceMax(pr.max)}} className={`p-3 rounded-xl border-2 text-center text-sm ${priceMin===pr.min&&priceMax===pr.max?'border-pink-500 bg-pink-50 font-bold':'border-gray-100'}`}>
                    {pr.label}
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* Distance Tab */}
          {activeFilterTab==='distance'&&(
            <div className="anim-fade">
              <p className="text-sm text-gray-500 mb-4">Maximum distance from you</p>
              
              {/* Distance Display */}
              <div className="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl p-6 mb-6 text-center">
                <i className="fa-solid fa-location-crosshairs text-3xl text-blue-500 mb-3"></i>
                <p className="text-4xl font-bold text-blue-600">{tempFilters.maxDistance} km</p>
                <p className="text-sm text-gray-500 mt-1">radius from your location</p>
                <input type="range" min="1" max="50" value={tempFilters.maxDistance} onChange={e=>setTempFilters(f=>({...f,maxDistance:Number(e.target.value)}))} className="w-full mt-4"/>
              </div>

              {/* Quick Distance Options */}
              <div className="grid grid-cols-3 gap-3">
                {filterOptions.distances.map(d=>(
                  <button key={d.value} onClick={()=>setTempFilters(f=>({...f,maxDistance:d.value}))} className={`p-3 rounded-xl border-2 text-center ${tempFilters.maxDistance===d.value?'border-blue-500 bg-blue-50':'border-gray-100'}`}>
                    <p className="font-bold text-sm">{d.value} km</p>
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* More Filters Tab */}
          {activeFilterTab==='more'&&(
            <div className="space-y-4 anim-fade">
              <p className="text-sm text-gray-500 mb-4">Additional filters</p>
              
              <button onClick={()=>setTempFilters(f=>({...f,verifiedOnly:!f.verifiedOnly}))} className={`w-full p-4 rounded-2xl flex items-center gap-3 border-2 ${tempFilters.verifiedOnly?'border-blue-500 bg-blue-50':'border-gray-100'}`}>
                <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${tempFilters.verifiedOnly?'bg-blue-500 text-white':'bg-gray-100 text-gray-500'}`}>
                  <i className="fa-solid fa-badge-check"></i>
                </div>
                <div className="flex-1 text-left">
                  <p className="font-bold">Verified Only</p>
                  <p className="text-xs text-gray-500">Show verified businesses</p>
                </div>
                <div className={`w-12 h-7 rounded-full transition-all ${tempFilters.verifiedOnly?'bg-blue-500':'bg-gray-300'}`}>
                  <div className={`w-5 h-5 bg-white rounded-full shadow mt-1 transition-all ${tempFilters.verifiedOnly?'ml-6':'ml-1'}`}></div>
                </div>
              </button>

              <button onClick={()=>setTempFilters(f=>({...f,homeServiceOnly:!f.homeServiceOnly}))} className={`w-full p-4 rounded-2xl flex items-center gap-3 border-2 ${tempFilters.homeServiceOnly?'border-green-500 bg-green-50':'border-gray-100'}`}>
                <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${tempFilters.homeServiceOnly?'bg-green-500 text-white':'bg-gray-100 text-gray-500'}`}>
                  <i className="fa-solid fa-house"></i>
                </div>
                <div className="flex-1 text-left">
                  <p className="font-bold">Home Service</p>
                  <p className="text-xs text-gray-500">Providers who come to you</p>
                </div>
                <div className={`w-12 h-7 rounded-full transition-all ${tempFilters.homeServiceOnly?'bg-green-500':'bg-gray-300'}`}>
                  <div className={`w-5 h-5 bg-white rounded-full shadow mt-1 transition-all ${tempFilters.homeServiceOnly?'ml-6':'ml-1'}`}></div>
                </div>
              </button>

              {/* Category Filter */}
              <div className="mt-6">
                <p className="font-bold mb-3">Category</p>
                <div className="flex flex-wrap gap-2">
                  <button onClick={()=>setTempFilters(f=>({...f,category:null}))} className={`px-4 py-2 rounded-xl text-sm font-medium ${!tempFilters.category?'bg-pink-500 text-white':'bg-gray-100'}`}>
                    All
                  </button>
                  {categories.map(c=>(
                    <button key={c.id} onClick={()=>setTempFilters(f=>({...f,category:c.id}))} className={`px-4 py-2 rounded-xl text-sm font-medium flex items-center gap-1 ${tempFilters.category===c.id?'bg-pink-500 text-white':'bg-gray-100'}`}>
                      <i className={`fa-solid fa-${c.icon}`}></i>{c.name}
                    </button>
                  ))}
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Footer */}
        <div className="p-5 border-t shrink-0 bg-white">
          <button onClick={applyFilters} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold flex items-center justify-center gap-2">
            <i className="fa-solid fa-check"></i>
            Apply Filters
            {activeCount>0&&<span className="bg-white/20 px-2 py-0.5 rounded-full text-sm">({activeCount})</span>}
          </button>
        </div>
      </div>
    );
  };

  // MODULE 21: Home
  const renderHome=()=>(
    <div className="pb-20 anim-fade smooth-scroll">
      {/* Header - Compact */}
      <div className="px-4 pt-4 pb-3">
        <div className="flex justify-between items-center mb-3">
          <div className="flex items-center gap-2.5">
            <div className="w-10 h-10 rounded-xl gradient-primary p-[2px]">
              <img src={`https://ui-avatars.com/api/?name=${userData.name}&background=ffffff&color=ec4899&bold=true&size=80`} className="w-full h-full rounded-[10px] object-cover"/>
            </div>
            <div>
              <p className="text-[10px] text-gray-500">Welcome back ðŸ‘‹</p>
              <h1 className="text-[15px] font-bold">{userData.name}</h1>
            </div>
          </div>
          <div className="flex gap-1.5">
            <button onClick={()=>setShowChat(true)} className="w-9 h-9 bg-white rounded-xl flex items-center justify-center shadow-sm border border-gray-100 relative">
              <i className="fa-solid fa-comments text-gray-500 text-sm"></i>
              {DB.getUserUnreadCount(user.id)>0&&<span className="absolute -top-0.5 -right-0.5 w-3.5 h-3.5 bg-purple-500 text-white text-[8px] rounded-full flex items-center justify-center">{DB.getUserUnreadCount(user.id)}</span>}
            </button>
            <button onClick={()=>setShowNotifications(true)} className="w-9 h-9 bg-white rounded-xl flex items-center justify-center shadow-sm border border-gray-100 relative">
              <i className="fa-solid fa-bell text-gray-500 text-sm"></i>
              {unreadCount>0&&<span className="absolute -top-0.5 -right-0.5 w-3.5 h-3.5 bg-red-500 text-white text-[8px] rounded-full flex items-center justify-center">{unreadCount}</span>}
            </button>
          </div>
        </div>
        {renderSearchBar(search,setSearch,true)}
      </div>

      {/* Location - Compact */}
      <div className="px-4 mb-3">
        <div className="bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl p-2.5 flex items-center gap-2.5 border border-pink-100/50">
          <div className="w-8 h-8 bg-white rounded-lg flex items-center justify-center shadow-sm">
            <i className="fa-solid fa-location-dot text-pink-500 text-xs"></i>
          </div>
          <div className="flex-1 min-w-0">
            <p className="text-[9px] text-gray-500">Your Location</p>
            <p className="font-semibold text-[12px] truncate">{userLocation.city||userLocation.country}</p>
          </div>
          <i className="fa-solid fa-chevron-right text-gray-400 text-[10px]"></i>
        </div>
      </div>

      {/* Categories */}
      <div className="mb-4">
        {isLoading?<div className="px-4"><SkeletonCategories/></div>:<Categories active={selectedCat} onSelect={setSelectedCat}/>}
      </div>

      {isLoading?(
        /* Skeleton Loading State */
        <div className="px-4 space-y-4">
          <div>
            <div className="flex justify-between items-center mb-3">
              <div className="skeleton w-24 h-5 rounded"></div>
              <div className="skeleton w-16 h-4 rounded"></div>
            </div>
            <SkeletonFeatured/>
          </div>
          <div>
            <div className="flex justify-between items-center mb-3">
              <div className="skeleton w-20 h-5 rounded"></div>
              <div className="skeleton w-12 h-4 rounded"></div>
            </div>
            <div className="space-y-3">
              <SkeletonListItem/>
              <SkeletonListItem/>
              <SkeletonListItem/>
            </div>
          </div>
        </div>
      ):filtered.length>0?(
        <>
          {/* Featured - Compact */}
          <div className="mb-4">
            <div className="flex justify-between items-center px-4 mb-2.5">
              <h2 className="text-[14px] font-bold">Featured</h2>
              <button className="text-pink-500 text-[11px] font-semibold">See All</button>
            </div>
            <div className="flex gap-3 px-4 overflow-x-auto pb-2 no-scrollbar smooth-scroll">
              {filtered.filter(p=>p.featured||p.verified).slice(0,5).map(p=><ProviderCard key={p.id} data={p} featured onClick={()=>setSelectedProvider(p)}/>)}
              {filtered.filter(p=>p.featured||p.verified).length===0&&filtered.slice(0,5).map(p=><ProviderCard key={p.id} data={p} featured onClick={()=>setSelectedProvider(p)}/>)}
            </div>
          </div>

          {/* Near You - Compact */}
          <div className="px-4">
            <div className="flex justify-between items-center mb-2.5">
              <h2 className="text-[14px] font-bold">Near You</h2>
              <span className="text-[11px] text-gray-500">{filtered.length} found</span>
            </div>
            {filtered.map(p=><ProviderCard key={p.id} data={p} onClick={()=>setSelectedProvider(p)}/>)}
          </div>
        </>
      ):(
        <EmptyState 
          icon="fa-search" 
          title="No salons found" 
          description="Try adjusting your filters or search for something else"
          action={()=>{setFilters({minRating:0,maxDistance:50,sortBy:'distance',minPrice:null,maxPrice:null,verifiedOnly:false,topRatedOnly:false,homeServiceOnly:false,category:null});setSelectedCat('All')}}
          actionLabel="Reset Filters"
        />
      )}
    </div>
  );

  // MODULE 23: Map
  const renderMap=()=>(
    <div className="w-full h-full absolute inset-0 pb-20">
      <div className="absolute top-0 left-0 right-0 z-[400] p-4 pointer-events-none">
        <div className="pointer-events-auto">{renderSearchBar(search,setSearch,true,'shadow-lg')}</div>
      </div>
      <MapView providers={filtered} onSelect={p=>setSelectedProvider(p)} userLocation={userLocation}/>
    </div>
  );

  // MODULE 26 + PLAN J: My Bookings with Reschedule
  const[showReschedule,setShowReschedule]=useState(null);
  const[rescheduleDate,setRescheduleDate]=useState('');
  const[rescheduleTime,setRescheduleTime]=useState('');
  const[bookingTab,setBookingTab]=useState('upcoming');

  const renderBookings=()=>{
    const upcoming=userBookings.filter(b=>['pending','confirmed'].includes(b.status));
    const completed=userBookings.filter(b=>b.status==='completed');
    const cancelled=userBookings.filter(b=>b.status==='cancelled');
    const current=bookingTab==='upcoming'?upcoming:bookingTab==='completed'?completed:cancelled;
    const waitlist=DB.getUserWaitlist(user.id);

    // Generate dates for reschedule
    const rescheduleDates=[];
    for(let i=1;i<=14;i++){
      const d=new Date();d.setDate(d.getDate()+i);
      rescheduleDates.push(d.toISOString().split('T')[0]);
    }

    // Generate times
    const rescheduleTimes=['09:00','09:30','10:00','10:30','11:00','11:30','12:00','14:00','14:30','15:00','15:30','16:00','16:30','17:00','17:30'];

    return(
      <div className="px-5 pt-6 pb-32 anim-fade">
        <h1 className="text-2xl font-bold mb-6">My Bookings</h1>
        
        {/* Waitlist Section */}
        {waitlist.length>0&&(
          <div className="bg-blue-50 rounded-2xl p-4 mb-6 border border-blue-100">
            <div className="flex items-center gap-2 mb-3">
              <i className="fa-solid fa-list text-blue-500"></i>
              <span className="font-bold text-sm">On Waitlist ({waitlist.length})</span>
            </div>
            {waitlist.slice(0,2).map(w=>{
              const p=allProviders.find(pr=>pr.id===w.providerId);
              return(
                <div key={w.id} className="flex items-center justify-between py-2 border-t border-blue-100">
                  <div>
                    <p className="text-sm font-medium">{p?.businessName}</p>
                    <p className="text-xs text-gray-500">{w.preferredDate} {w.preferredTime}</p>
                  </div>
                  <button onClick={()=>{DB.leaveWaitlist(w.id);toast.show('Removed from waitlist');setRefresh(r=>r+1)}} className="text-xs text-red-500">Remove</button>
                </div>
              )
            })}
          </div>
        )}

        {/* Tabs */}
        <div className="flex gap-2 mb-6">
          {[{id:'upcoming',count:upcoming.length},{id:'completed',count:completed.length},{id:'cancelled',count:cancelled.length}].map(t=>(
            <button key={t.id} onClick={()=>setBookingTab(t.id)} className={`flex-1 py-3 rounded-2xl text-sm font-bold capitalize ${bookingTab===t.id?'gradient-primary text-white':'bg-white text-gray-600 border'}`}>
              {t.id} ({t.count})
            </button>
          ))}
        </div>

        {current.length>0?(
          <div className="space-y-4">
            {current.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt)).map(b=>{
              const provider=allProviders.find(p=>p.id===b.providerId);
              const statusColors={pending:'bg-yellow-100 text-yellow-700',confirmed:'bg-blue-100 text-blue-700',completed:'bg-green-100 text-green-700',cancelled:'bg-red-100 text-red-700'};
              return(
                <div key={b.id} className="bg-white p-4 rounded-3xl shadow-sm border">
                  <div className="flex gap-4 mb-3">
                    <img src={provider?.image||'https://via.placeholder.com/100'} className="w-16 h-16 rounded-2xl object-cover"/>
                    <div className="flex-1 min-w-0">
                      <div className="flex justify-between items-start">
                        <div className="flex items-center gap-2">
                          <h4 className="font-bold truncate">{provider?.businessName||'Provider'}</h4>
                          {b.isRecurring&&<span className="text-[10px] bg-purple-100 text-purple-600 px-1.5 py-0.5 rounded font-bold"><i className="fa-solid fa-repeat mr-0.5"></i>{b.recurringIndex}/{b.recurringTotal}</span>}
                        </div>
                        <span className={`text-xs font-bold px-2.5 py-1 rounded-full shrink-0 ${statusColors[b.status]}`}>{b.status}</span>
                      </div>
                      <p className="text-sm text-gray-500 mt-1">{b.isMultiService?`${b.services?.length} services`:b.serviceName}</p>
                      <div className="flex items-center gap-3 mt-2 text-xs text-gray-400">
                        <span><i className="fa-solid fa-calendar mr-1"></i>{b.date}</span>
                        <span><i className="fa-solid fa-clock mr-1"></i>{b.time}</span>
                        {b.rescheduled&&<span className="text-blue-500"><i className="fa-solid fa-rotate mr-1"></i>Rescheduled</span>}
                      </div>
                    </div>
                  </div>
                  <div className="flex justify-between items-center pt-3 border-t">
                    <span className="font-bold text-pink-600">â‚¬{b.price}</span>
                    <div className="flex gap-3">
                      {['pending','confirmed'].includes(b.status)&&(
                        <>
                          <button onClick={()=>{setShowReschedule(b);setRescheduleDate('');setRescheduleTime('')}} className="text-sm text-blue-500 font-bold"><i className="fa-solid fa-calendar-alt mr-1"></i>Reschedule</button>
                          <button onClick={()=>{DB.updateBooking(b.id,{status:'cancelled'});toast.show('Booking cancelled','success');setRefresh(r=>r+1)}} className="text-sm text-red-500 font-bold">Cancel</button>
                        </>
                      )}
                      {b.status==='completed'&&<button onClick={()=>{setBookingProvider(provider)}} className="text-sm text-pink-500 font-bold">Book Again</button>}
                    </div>
                  </div>
                </div>
              )
            })}
          </div>
        ):(
          <div className="text-center py-16">
            <i className="fa-solid fa-calendar-xmark text-6xl text-gray-200 mb-4"></i>
            <p className="text-gray-500 font-medium">No {bookingTab} bookings</p>
          </div>
        )}

        {/* Reschedule Modal */}
        {showReschedule&&(
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50">
            <div className="bg-white rounded-3xl p-5 w-full max-w-md anim-scale max-h-[80vh] overflow-y-auto">
              <div className="flex items-center justify-between mb-4">
                <h3 className="text-lg font-bold">Reschedule Booking</h3>
                <button onClick={()=>setShowReschedule(null)} className="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
                  <i className="fa-solid fa-times text-gray-500"></i>
                </button>
              </div>

              {/* Current Booking Info */}
              <div className="bg-gray-50 rounded-xl p-3 mb-4">
                <p className="text-sm font-medium">{showReschedule.serviceName}</p>
                <p className="text-xs text-gray-500">Currently: {showReschedule.date} at {showReschedule.time}</p>
              </div>

              {/* New Date */}
              <p className="text-sm font-bold mb-2">Select New Date</p>
              <div className="flex gap-2 overflow-x-auto pb-2 mb-4 no-scrollbar">
                {rescheduleDates.map(d=>{
                  const date=new Date(d);
                  const day=date.toLocaleDateString('en',{weekday:'short'});
                  const num=date.getDate();
                  return(
                    <button key={d} onClick={()=>setRescheduleDate(d)} className={`flex flex-col items-center px-3 py-2 rounded-xl shrink-0 ${rescheduleDate===d?'gradient-primary text-white':'bg-gray-100'}`}>
                      <span className="text-xs">{day}</span>
                      <span className="text-lg font-bold">{num}</span>
                    </button>
                  )
                })}
              </div>

              {/* New Time */}
              <p className="text-sm font-bold mb-2">Select New Time</p>
              <div className="grid grid-cols-4 gap-2 mb-4">
                {rescheduleTimes.map(t=>(
                  <button key={t} onClick={()=>setRescheduleTime(t)} className={`py-2 rounded-xl text-sm font-medium ${rescheduleTime===t?'gradient-primary text-white':'bg-gray-100'}`}>{t}</button>
                ))}
              </div>

              <button onClick={()=>{
                if(!rescheduleDate||!rescheduleTime){toast.show('Select date and time','warning');return}
                DB.rescheduleBooking(showReschedule.id,rescheduleDate,rescheduleTime);
                toast.show('Booking rescheduled! ðŸ”„','success');
                setShowReschedule(null);
                setRefresh(r=>r+1);
              }} disabled={!rescheduleDate||!rescheduleTime} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold disabled:opacity-50">
                Confirm Reschedule
              </button>
            </div>
          </div>
        )}
      </div>
    );
  };

  // MODULE 27: Favorites
  const renderFavorites=()=>{
    const favProviders=providers.filter(p=>favorites.includes(p.id));
    return(
      <div className="px-5 pt-6 pb-32 anim-fade">
        <h1 className="text-2xl font-bold mb-6">Favorites</h1>
        {favProviders.length>0?(
          <div>{favProviders.map(p=><ProviderCard key={p.id} data={p} onClick={()=>setSelectedProvider(p)}/>)}</div>
        ):(
          <EmptyState 
            icon="fa-heart" 
            title="No favorites yet" 
            description="Tap the heart icon on any salon to save it here for quick access"
            action={()=>setTab('home')}
            actionLabel="Browse Salons"
          />
        )}
      </div>
    );
  };

  // MODULE 30 & 40: Profile with Photo Upload
  const[showEditProfile,setShowEditProfile]=useState(false);
  const userPhotoInputRef=useRef(null);

  const handleUserPhotoUpload=async(e)=>{
    const file=e.target.files?.[0];
    if(!file)return;
    if(file.size>5*1024*1024){toast.show('Image too large (max 5MB)','error');return}
    toast.show('Uploading...','info');
    const result=await DB.updateUserPhoto(user.id,file);
    if(result.success){
      setUserData({...userData,profilePhoto:result.photo});
      toast.show('Photo updated! ðŸ“¸','success');
    }else{
      toast.show('Upload failed','error');
    }
  };

  const renderProfile=()=>{
    const userPhoto=userData.profilePhoto||DB.getUserPhoto(user.id);
    const walletBalance=DB.getWallet(user.id).balance;
    return(
    <div className="pb-32 anim-fade">
      {/* Header */}
      <div className="gradient-primary pt-10 pb-20 px-5">
        <div className="flex items-center gap-4">
          <div className="relative">
            <div className="w-20 h-20 rounded-3xl bg-white p-1 shadow-lg">
              <img src={userPhoto||`https://ui-avatars.com/api/?name=${userData.name}&background=ec4899&color=fff&size=200`} className="w-full h-full rounded-[20px] object-cover"/>
            </div>
            <button onClick={()=>userPhotoInputRef.current?.click()} className="absolute -bottom-1 -right-1 w-8 h-8 bg-white rounded-full shadow-lg flex items-center justify-center border-2 border-pink-500">
              <i className="fa-solid fa-camera text-pink-500 text-xs"></i>
            </button>
            <input ref={userPhotoInputRef} type="file" accept="image/*" onChange={handleUserPhotoUpload} className="hidden"/>
          </div>
          <div className="text-white">
            <h1 className="text-2xl font-bold">{userData.name}</h1>
            <p className="opacity-80 text-sm">{userData.email}</p>
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="px-5 -mt-10">
        <div className="grid grid-cols-3 gap-3">
          <div className="bg-white rounded-2xl p-4 shadow-lg text-center">
            <p className="text-2xl font-bold">{userBookings.length}</p>
            <p className="text-xs text-gray-500">Bookings</p>
          </div>
          <div className="bg-white rounded-2xl p-4 shadow-lg text-center">
            <p className="text-2xl font-bold">{userData.points||0}</p>
            <p className="text-xs text-gray-500">Points</p>
          </div>
          <button onClick={()=>setShowWallet(true)} className="bg-white rounded-2xl p-4 shadow-lg text-center hover:shadow-xl transition-shadow">
            <p className="text-2xl font-bold text-green-600">â‚¬{walletBalance.toFixed(0)}</p>
            <p className="text-xs text-gray-500">Wallet</p>
          </button>
        </div>
      </div>

      {/* Menu */}
      <div className="px-5 mt-6 space-y-3">
        {[
          {icon:'fa-user',label:'Edit Profile',color:'bg-blue-100 text-blue-600',action:()=>setShowEditProfile(true)},
          {icon:'fa-wallet',label:'My Wallet',color:'bg-green-100 text-green-600',action:()=>setShowWallet(true),badge:`â‚¬${walletBalance.toFixed(0)}`},
          {icon:'fa-credit-card',label:'Payment Methods',color:'bg-indigo-100 text-indigo-600',action:()=>{setShowWallet(true);setWalletTab('cards')},badge:DB.getSavedCards(user.id).length>0?DB.getSavedCards(user.id).length:null},
          {icon:'fa-crown',label:'Membership',color:'bg-yellow-100 text-yellow-600',action:()=>setShowMembership(true)},
          {icon:'fa-gift',label:'Gift Cards',color:'bg-pink-100 text-pink-600',action:()=>setShowGiftCards(true)},
          {icon:'fa-ticket',label:'Offers & Coupons',color:'bg-purple-100 text-purple-600',action:()=>setShowOffers(true)},
          {icon:'fa-heart',label:'Favorites',color:'bg-red-100 text-red-600',action:()=>setTab('favorites')},
          {icon:'fa-location-dot',label:'Saved Addresses',color:'bg-orange-100 text-orange-600'},
          {icon:'fa-bell',label:'Notifications',color:'bg-yellow-100 text-yellow-600',action:()=>setShowNotifications(true)},
          {icon:'fa-globe',label:'Language',color:'bg-cyan-100 text-cyan-600',action:()=>setShowLanguage(true)},
          {icon:'fa-circle-question',label:'Help & Support',color:'bg-gray-100 text-gray-600'},
        ].map(item=>(
          <button key={item.label} onClick={item.action} className="w-full bg-white rounded-2xl p-4 flex items-center gap-4 shadow-sm border">
            <div className={`w-11 h-11 rounded-xl ${item.color} flex items-center justify-center`}>
              <i className={`fa-solid ${item.icon}`}></i>
            </div>
            <span className="flex-1 text-left font-medium">{item.label}</span>
            {item.badge&&<span className="px-2 py-1 bg-gray-100 rounded-lg text-xs font-bold text-gray-600">{item.badge}</span>}
            <i className="fa-solid fa-chevron-right text-gray-300"></i>
          </button>
        ))}

        <button onClick={onLogout} className="w-full bg-red-50 rounded-2xl p-4 flex items-center gap-4 border border-red-100 mt-6">
          <div className="w-11 h-11 rounded-xl bg-red-100 text-red-600 flex items-center justify-center">
            <i className="fa-solid fa-right-from-bracket"></i>
          </div>
          <span className="flex-1 text-left font-bold text-red-600">Log Out</span>
        </button>
      </div>
    </div>
  )};

  // PLAN H: Profile & Account System (Modules 45-50)
  const[showChangePassword,setShowChangePassword]=useState(false);
  const[showDeleteAccount,setShowDeleteAccount]=useState(false);
  const[showForgotPassword,setShowForgotPassword]=useState(false);
  const[showOTPVerify,setShowOTPVerify]=useState(false);
  const[otpPhone,setOtpPhone]=useState('');
  const[otpCode,setOtpCode]=useState(['','','','','','']);
  const[otpSent,setOtpSent]=useState(false);
  const[otpTimer,setOtpTimer]=useState(0);

  // Calculate profile completion
  const getProfileCompletion=()=>{
    let score=0;
    const checks=[
      {field:'name',label:'Add your name',done:!!userData.name},
      {field:'email',label:'Add email',done:!!userData.email},
      {field:'phone',label:'Add phone number',done:!!userData.phone},
      {field:'profilePhoto',label:'Upload profile photo',done:!!userData.profilePhoto},
      {field:'verified',label:'Verify phone/email',done:!!userData.verified},
    ];
    checks.forEach(c=>{if(c.done)score+=20});
    return {score,checks};
  };

  // Edit Profile Modal (Module 45)
  const EditProfileModal=()=>{
    const[editName,setEditName]=useState(userData.name);
    const[editPhone,setEditPhone]=useState(userData.phone||'');
    const[saving,setSaving]=useState(false);
    const{score,checks}=getProfileCompletion();

    const saveProfile=async()=>{
      setSaving(true);
      await new Promise(r=>setTimeout(r,500));
      DB.updateUser(user.id,{name:editName,phone:editPhone});
      setUserData({...userData,name:editName,phone:editPhone});
      toast.show('Profile updated!','success');
      setSaving(false);
      setShowEditProfile(false);
    };

    return showEditProfile&&(
      <div className="fixed inset-0 z-50 bg-white anim-fade overflow-y-auto">
        <div className="p-5 border-b flex items-center gap-4 sticky top-0 bg-white z-10">
          <button onClick={()=>setShowEditProfile(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
            <i className="fa-solid fa-arrow-left text-gray-600"></i>
          </button>
          <h1 className="text-xl font-bold">Edit Profile</h1>
        </div>

        <div className="p-5">
          {/* Profile Completion (Module 50) */}
          <div className="bg-gradient-to-r from-pink-50 to-purple-50 rounded-2xl p-4 mb-6">
            <div className="flex items-center justify-between mb-2">
              <span className="font-bold text-sm">Profile Completion</span>
              <span className="text-pink-600 font-bold">{score}%</span>
            </div>
            <div className="h-2 bg-white rounded-full overflow-hidden">
              <div className="h-full gradient-primary rounded-full transition-all" style={{width:`${score}%`}}></div>
            </div>
            {score<100&&(
              <div className="mt-3 space-y-1">
                {checks.filter(c=>!c.done).slice(0,2).map((c,i)=>(
                  <p key={i} className="text-xs text-gray-500"><i className="fa-solid fa-circle-plus text-pink-400 mr-2"></i>{c.label}</p>
                ))}
              </div>
            )}
          </div>

          {/* Photo */}
          <div className="flex flex-col items-center mb-8">
            <div className="relative">
              <div className="w-28 h-28 rounded-full bg-gradient-to-br from-pink-500 to-purple-500 p-1">
                <img src={userData.profilePhoto||`https://ui-avatars.com/api/?name=${userData.name}&background=ec4899&color=fff&size=200`} className="w-full h-full rounded-full object-cover bg-white"/>
              </div>
              <button onClick={()=>userPhotoInputRef.current?.click()} className="absolute bottom-0 right-0 w-10 h-10 bg-pink-500 rounded-full shadow-lg flex items-center justify-center text-white">
                <i className="fa-solid fa-camera"></i>
              </button>
            </div>
            <p className="text-sm text-gray-500 mt-3">Tap to change photo</p>
          </div>

          {/* Form */}
          <div className="space-y-4">
            <div>
              <label className="text-sm font-bold text-gray-700 mb-2 block">Full Name</label>
              <input value={editName} onChange={e=>setEditName(e.target.value)} className="w-full px-4 py-4 bg-gray-100 rounded-2xl outline-none focus:ring-2 ring-pink-200"/>
            </div>
            <div>
              <label className="text-sm font-bold text-gray-700 mb-2 block">Email</label>
              <div className="relative">
                <input value={userData.email} disabled className="w-full px-4 py-4 bg-gray-100 rounded-2xl outline-none text-gray-500 pr-20"/>
                {userData.emailVerified?(
                  <span className="absolute right-4 top-1/2 -translate-y-1/2 text-xs text-green-500 font-bold"><i className="fa-solid fa-check-circle mr-1"></i>Verified</span>
                ):(
                  <button onClick={()=>{setShowOTPVerify(true);setOtpPhone(userData.email)}} className="absolute right-4 top-1/2 -translate-y-1/2 text-xs text-pink-500 font-bold">Verify</button>
                )}
              </div>
            </div>
            <div>
              <label className="text-sm font-bold text-gray-700 mb-2 block">Phone</label>
              <div className="relative">
                <input value={editPhone} onChange={e=>setEditPhone(e.target.value)} placeholder="+92 300 1234567" className="w-full px-4 py-4 bg-gray-100 rounded-2xl outline-none focus:ring-2 ring-pink-200 pr-20"/>
                {userData.phoneVerified?(
                  <span className="absolute right-4 top-1/2 -translate-y-1/2 text-xs text-green-500 font-bold"><i className="fa-solid fa-check-circle mr-1"></i>Verified</span>
                ):(
                  editPhone&&<button onClick={()=>{setShowOTPVerify(true);setOtpPhone(editPhone)}} className="absolute right-4 top-1/2 -translate-y-1/2 text-xs text-pink-500 font-bold">Verify</button>
                )}
              </div>
            </div>
          </div>

          <button onClick={saveProfile} disabled={saving||!editName} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold mt-6 disabled:opacity-50 flex items-center justify-center gap-2">
            {saving?<><div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div>Saving...</>:<><i className="fa-solid fa-check"></i>Save Changes</>}
          </button>

          {/* Account Actions */}
          <div className="mt-8 pt-6 border-t space-y-3">
            <button onClick={()=>{setShowEditProfile(false);setShowChangePassword(true)}} className="w-full py-4 bg-gray-100 rounded-2xl font-bold flex items-center justify-center gap-2 text-gray-700">
              <i className="fa-solid fa-key"></i>Change Password
            </button>
            <button onClick={()=>{setShowEditProfile(false);setShowDeleteAccount(true)}} className="w-full py-4 bg-red-50 rounded-2xl font-bold flex items-center justify-center gap-2 text-red-500">
              <i className="fa-solid fa-trash"></i>Delete Account
            </button>
          </div>
        </div>
      </div>
    );
  };

  // Module 46: Change Password Modal
  const ChangePasswordModal=()=>{
    const[currentPwd,setCurrentPwd]=useState('');
    const[newPwd,setNewPwd]=useState('');
    const[confirmPwd,setConfirmPwd]=useState('');
    const[showPwds,setShowPwds]=useState({current:false,new:false,confirm:false});
    const[changing,setChanging]=useState(false);

    const changePassword=async()=>{
      if(currentPwd!==userData.password){toast.show('Current password is incorrect','error');return}
      if(newPwd.length<6){toast.show('Password must be at least 6 characters','error');return}
      if(newPwd!==confirmPwd){toast.show('Passwords do not match','error');return}
      
      setChanging(true);
      await new Promise(r=>setTimeout(r,800));
      DB.updateUser(user.id,{password:newPwd});
      setUserData({...userData,password:newPwd});
      toast.show('Password changed successfully! ðŸ”’','success');
      setChanging(false);
      setShowChangePassword(false);
    };

    return showChangePassword&&(
      <div className="fixed inset-0 z-50 bg-white anim-fade overflow-y-auto">
        <div className="p-5 border-b flex items-center gap-4 sticky top-0 bg-white z-10">
          <button onClick={()=>setShowChangePassword(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
            <i className="fa-solid fa-arrow-left text-gray-600"></i>
          </button>
          <h1 className="text-xl font-bold">Change Password</h1>
        </div>

        <div className="p-5">
          <div className="w-20 h-20 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-6">
            <i className="fa-solid fa-lock text-3xl text-pink-500"></i>
          </div>

          <div className="space-y-4">
            <div>
              <label className="text-sm font-bold text-gray-700 mb-2 block">Current Password</label>
              <div className="relative">
                <input type={showPwds.current?'text':'password'} value={currentPwd} onChange={e=>setCurrentPwd(e.target.value)} placeholder="Enter current password" className="w-full px-4 py-4 bg-gray-100 rounded-2xl outline-none focus:ring-2 ring-pink-200 pr-12"/>
                <button type="button" onClick={()=>setShowPwds(p=>({...p,current:!p.current}))} className="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">
                  <i className={`fa-solid ${showPwds.current?'fa-eye-slash':'fa-eye'}`}></i>
                </button>
              </div>
            </div>
            <div>
              <label className="text-sm font-bold text-gray-700 mb-2 block">New Password</label>
              <div className="relative">
                <input type={showPwds.new?'text':'password'} value={newPwd} onChange={e=>setNewPwd(e.target.value)} placeholder="Enter new password (min 6 chars)" className="w-full px-4 py-4 bg-gray-100 rounded-2xl outline-none focus:ring-2 ring-pink-200 pr-12"/>
                <button type="button" onClick={()=>setShowPwds(p=>({...p,new:!p.new}))} className="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">
                  <i className={`fa-solid ${showPwds.new?'fa-eye-slash':'fa-eye'}`}></i>
                </button>
              </div>
              {newPwd&&(
                <div className="mt-2 flex gap-1">
                  {[1,2,3,4,5].map(i=>(
                    <div key={i} className={`flex-1 h-1 rounded-full ${i<=(newPwd.length>=8&&/[A-Z]/.test(newPwd)&&/[0-9]/.test(newPwd)?5:newPwd.length>=6?3:1)?'bg-green-500':'bg-gray-200'}`}></div>
                  ))}
                </div>
              )}
            </div>
            <div>
              <label className="text-sm font-bold text-gray-700 mb-2 block">Confirm New Password</label>
              <div className="relative">
                <input type={showPwds.confirm?'text':'password'} value={confirmPwd} onChange={e=>setConfirmPwd(e.target.value)} placeholder="Re-enter new password" className="w-full px-4 py-4 bg-gray-100 rounded-2xl outline-none focus:ring-2 ring-pink-200 pr-12"/>
                <button type="button" onClick={()=>setShowPwds(p=>({...p,confirm:!p.confirm}))} className="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">
                  <i className={`fa-solid ${showPwds.confirm?'fa-eye-slash':'fa-eye'}`}></i>
                </button>
              </div>
              {confirmPwd&&newPwd&&(
                <p className={`text-xs mt-1 ${confirmPwd===newPwd?'text-green-500':'text-red-500'}`}>
                  <i className={`fa-solid ${confirmPwd===newPwd?'fa-check-circle':'fa-times-circle'} mr-1`}></i>
                  {confirmPwd===newPwd?'Passwords match':'Passwords do not match'}
                </p>
              )}
            </div>
          </div>

          <button onClick={changePassword} disabled={changing||!currentPwd||!newPwd||!confirmPwd} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold mt-8 disabled:opacity-50 flex items-center justify-center gap-2">
            {changing?<><div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div>Changing...</>:<><i className="fa-solid fa-check"></i>Change Password</>}
          </button>

          <button onClick={()=>{setShowChangePassword(false);setShowForgotPassword(true)}} className="w-full py-3 text-pink-500 font-bold mt-4">
            Forgot your password?
          </button>
        </div>
      </div>
    );
  };

  // Module 47: Forgot Password Modal
  const ForgotPasswordModal=()=>{
    const[resetEmail,setResetEmail]=useState('');
    const[resetStep,setResetStep]=useState(1);
    const[resetOTP,setResetOTP]=useState('');
    const[newResetPwd,setNewResetPwd]=useState('');
    const[sending,setSending]=useState(false);

    const sendResetOTP=async()=>{
      if(!resetEmail){toast.show('Enter your email','error');return}
      const user=DB.getUserByEmail(resetEmail);
      if(!user){toast.show('No account found with this email','error');return}
      
      setSending(true);
      await new Promise(r=>setTimeout(r,1000));
      // Simulate sending OTP
      toast.show('Reset code sent to your email! (Demo: 123456)','success');
      setResetStep(2);
      setSending(false);
    };

    const verifyAndReset=async()=>{
      if(resetOTP!=='123456'){toast.show('Invalid code','error');return}
      if(newResetPwd.length<6){toast.show('Password must be at least 6 characters','error');return}
      
      setSending(true);
      await new Promise(r=>setTimeout(r,800));
      const user=DB.getUserByEmail(resetEmail);
      if(user){
        DB.updateUser(user.id,{password:newResetPwd});
        toast.show('Password reset successful! Please login.','success');
        setShowForgotPassword(false);
        setResetStep(1);setResetEmail('');setResetOTP('');setNewResetPwd('');
      }
      setSending(false);
    };

    return showForgotPassword&&(
      <div className="fixed inset-0 z-50 bg-white anim-fade overflow-y-auto">
        <div className="p-5 border-b flex items-center gap-4 sticky top-0 bg-white z-10">
          <button onClick={()=>{setShowForgotPassword(false);setResetStep(1)}} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
            <i className="fa-solid fa-arrow-left text-gray-600"></i>
          </button>
          <h1 className="text-xl font-bold">Reset Password</h1>
        </div>

        <div className="p-5">
          <div className="w-20 h-20 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-6">
            <i className="fa-solid fa-key text-3xl text-orange-500"></i>
          </div>

          {resetStep===1?(
            <>
              <p className="text-center text-gray-500 mb-6">Enter your email and we'll send you a code to reset your password.</p>
              <input type="email" value={resetEmail} onChange={e=>setResetEmail(e.target.value)} placeholder="Enter your email" className="w-full px-4 py-4 bg-gray-100 rounded-2xl outline-none focus:ring-2 ring-pink-200 mb-4"/>
              <button onClick={sendResetOTP} disabled={sending||!resetEmail} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold disabled:opacity-50 flex items-center justify-center gap-2">
                {sending?<><div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div>Sending...</>:<><i className="fa-solid fa-paper-plane"></i>Send Reset Code</>}
              </button>
            </>
          ):(
            <>
              <p className="text-center text-gray-500 mb-6">Enter the code sent to {resetEmail}</p>
              <input type="text" value={resetOTP} onChange={e=>setResetOTP(e.target.value)} placeholder="Enter 6-digit code" maxLength={6} className="w-full px-4 py-4 bg-gray-100 rounded-2xl outline-none focus:ring-2 ring-pink-200 mb-4 text-center font-mono text-xl tracking-widest"/>
              <input type="password" value={newResetPwd} onChange={e=>setNewResetPwd(e.target.value)} placeholder="New password (min 6 chars)" className="w-full px-4 py-4 bg-gray-100 rounded-2xl outline-none focus:ring-2 ring-pink-200 mb-4"/>
              <button onClick={verifyAndReset} disabled={sending||!resetOTP||!newResetPwd} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold disabled:opacity-50 flex items-center justify-center gap-2">
                {sending?<><div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div>Resetting...</>:<><i className="fa-solid fa-check"></i>Reset Password</>}
              </button>
              <button onClick={()=>setResetStep(1)} className="w-full py-3 text-gray-500 font-medium mt-2">
                <i className="fa-solid fa-arrow-left mr-2"></i>Back
              </button>
            </>
          )}
        </div>
      </div>
    );
  };

  // Module 48: OTP Verification Modal
  const OTPVerifyModal=()=>{
    const[verifying,setVerifying]=useState(false);
    const otpInputs=useRef([]);

    const handleOTPChange=(index,value)=>{
      if(!/^\d*$/.test(value))return;
      const newOTP=[...otpCode];
      newOTP[index]=value;
      setOtpCode(newOTP);
      if(value&&index<5)otpInputs.current[index+1]?.focus();
    };

    const handleOTPKeyDown=(index,e)=>{
      if(e.key==='Backspace'&&!otpCode[index]&&index>0){
        otpInputs.current[index-1]?.focus();
      }
    };

    const sendOTP=async()=>{
      setOtpSent(true);
      setOtpTimer(60);
      toast.show(`OTP sent to ${otpPhone}! (Demo: 123456)`,'success');
      const interval=setInterval(()=>{
        setOtpTimer(t=>{
          if(t<=1){clearInterval(interval);return 0}
          return t-1;
        });
      },1000);
    };

    const verifyOTP=async()=>{
      const code=otpCode.join('');
      if(code!=='123456'){toast.show('Invalid OTP','error');return}
      
      setVerifying(true);
      await new Promise(r=>setTimeout(r,800));
      
      if(otpPhone.includes('@')){
        DB.updateUser(user.id,{emailVerified:true,verified:true});
        setUserData({...userData,emailVerified:true,verified:true});
      }else{
        DB.updateUser(user.id,{phoneVerified:true,verified:true});
        setUserData({...userData,phoneVerified:true,verified:true});
      }
      
      toast.show('Verified successfully! âœ“','success');
      setVerifying(false);
      setShowOTPVerify(false);
      setOtpCode(['','','','','','']);
      setOtpSent(false);
    };

    return showOTPVerify&&(
      <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div className="absolute inset-0 bg-black/50 backdrop-blur-sm" onClick={()=>setShowOTPVerify(false)}></div>
        <div className="bg-white rounded-3xl p-6 w-full max-w-sm relative z-10 anim-scale">
          <div className="text-center mb-6">
            <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i className="fa-solid fa-shield-check text-2xl text-green-500"></i>
            </div>
            <h2 className="text-xl font-bold">Verify {otpPhone.includes('@')?'Email':'Phone'}</h2>
            <p className="text-sm text-gray-500 mt-2">{otpSent?`Enter the code sent to ${otpPhone}`:`We'll send a verification code to ${otpPhone}`}</p>
          </div>

          {!otpSent?(
            <button onClick={sendOTP} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold">
              <i className="fa-solid fa-paper-plane mr-2"></i>Send OTP
            </button>
          ):(
            <>
              <div className="flex gap-2 justify-center mb-6">
                {[0,1,2,3,4,5].map(i=>(
                  <input key={i} ref={el=>otpInputs.current[i]=el} type="text" maxLength={1} value={otpCode[i]} onChange={e=>handleOTPChange(i,e.target.value)} onKeyDown={e=>handleOTPKeyDown(i,e)} className="w-11 h-14 bg-gray-100 rounded-xl text-center text-xl font-bold outline-none focus:ring-2 ring-pink-300"/>
                ))}
              </div>

              <button onClick={verifyOTP} disabled={verifying||otpCode.join('').length<6} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold disabled:opacity-50 flex items-center justify-center gap-2">
                {verifying?<><div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div>Verifying...</>:<><i className="fa-solid fa-check"></i>Verify</>}
              </button>

              <div className="text-center mt-4">
                {otpTimer>0?(
                  <p className="text-sm text-gray-500">Resend in <span className="text-pink-500 font-bold">{otpTimer}s</span></p>
                ):(
                  <button onClick={sendOTP} className="text-sm text-pink-500 font-bold">Resend OTP</button>
                )}
              </div>
            </>
          )}

          <button onClick={()=>{setShowOTPVerify(false);setOtpSent(false);setOtpCode(['','','','','',''])}} className="w-full py-3 text-gray-500 font-medium mt-2">Cancel</button>
        </div>
      </div>
    );
  };

  // Module 49: Delete Account Modal
  const DeleteAccountModal=()=>{
    const[deleteConfirm,setDeleteConfirm]=useState('');
    const[deleting,setDeleting]=useState(false);

    const deleteAccount=async()=>{
      if(deleteConfirm!=='DELETE'){toast.show('Please type DELETE to confirm','error');return}
      
      setDeleting(true);
      await new Promise(r=>setTimeout(r,1500));
      
      // Delete user data
      const users=DB.getUsers().filter(u=>u.id!==user.id);
      localStorage.setItem('gb_users',JSON.stringify(users));
      
      // Delete provider if exists
      const providers=DB.getProviders().filter(p=>p.userId!==user.id);
      localStorage.setItem('gb_providers',JSON.stringify(providers));
      
      toast.show('Account deleted. Goodbye! ðŸ‘‹','success');
      setDeleting(false);
      onLogout();
    };

    return showDeleteAccount&&(
      <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div className="absolute inset-0 bg-black/50 backdrop-blur-sm" onClick={()=>setShowDeleteAccount(false)}></div>
        <div className="bg-white rounded-3xl p-6 w-full max-w-sm relative z-10 anim-scale">
          <div className="text-center mb-6">
            <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i className="fa-solid fa-triangle-exclamation text-2xl text-red-500"></i>
            </div>
            <h2 className="text-xl font-bold text-red-600">Delete Account?</h2>
            <p className="text-sm text-gray-500 mt-2">This action cannot be undone. All your data will be permanently deleted.</p>
          </div>

          <div className="bg-red-50 border border-red-100 rounded-2xl p-4 mb-4">
            <p className="text-sm text-red-600 font-medium">You will lose:</p>
            <ul className="text-sm text-red-500 mt-2 space-y-1">
              <li><i className="fa-solid fa-times mr-2"></i>All bookings history</li>
              <li><i className="fa-solid fa-times mr-2"></i>Wallet balance (â‚¬{userData.walletBalance||0})</li>
              <li><i className="fa-solid fa-times mr-2"></i>Points ({userData.points||0})</li>
              <li><i className="fa-solid fa-times mr-2"></i>Saved favorites</li>
            </ul>
          </div>

          <p className="text-sm text-gray-600 mb-2">Type <span className="font-bold text-red-500">DELETE</span> to confirm:</p>
          <input type="text" value={deleteConfirm} onChange={e=>setDeleteConfirm(e.target.value.toUpperCase())} placeholder="Type DELETE" className="w-full px-4 py-3 bg-gray-100 rounded-xl outline-none focus:ring-2 ring-red-200 mb-4 font-mono"/>

          <div className="flex gap-3">
            <button onClick={()=>setShowDeleteAccount(false)} className="flex-1 py-3 bg-gray-100 rounded-xl font-bold text-gray-600">Cancel</button>
            <button onClick={deleteAccount} disabled={deleting||deleteConfirm!=='DELETE'} className="flex-1 py-3 bg-red-500 text-white rounded-xl font-bold disabled:opacity-50 flex items-center justify-center gap-2">
              {deleting?<div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full spinner"></div>:<i className="fa-solid fa-trash"></i>}
              {deleting?'Deleting...':'Delete'}
            </button>
          </div>
        </div>
      </div>
    );
  };

  // MODULE 28: Wallet Modal
  // PLAN M: Enhanced Wallet Modal with Payment System
  const[walletTab,setWalletTab]=useState('wallet');
  const[topUpAmount,setTopUpAmount]=useState(0);
  const[showAddCard,setShowAddCard]=useState(false);
  const[cardNumber,setCardNumber]=useState('');
  const[cardExpiry,setCardExpiry]=useState('');
  const[cardCVV,setCardCVV]=useState('');
  const[cardName,setCardName]=useState('');
  const[processing,setProcessing]=useState(false);
  
  const wallet=DB.getWallet(user.id);
  const savedCards=DB.getSavedCards(user.id);
  const transactions=DB.getTransactions(user.id);
  const txnSummary=DB.getTransactionsSummary(user.id);
  
  const handleTopUp=async(amount)=>{
    if(amount<=0)return;
    setProcessing(true);
    const result=await DB.topUpWallet(user.id,amount,'card',savedCards[0]?.id);
    setProcessing(false);
    if(result.success){
      toast.show(`â‚¬${amount} added to wallet! ðŸ’°`,'success');
      setTopUpAmount(0);
      setRefresh(r=>r+1);
    }else{
      toast.show(result.error||'Top-up failed','error');
    }
  };
  
  const handleAddCard=()=>{
    if(cardNumber.length<16||cardExpiry.length<5||cardCVV.length<3||!cardName){
      toast.show('Please fill all card details','warning');
      return;
    }
    DB.addCard(user.id,{number:cardNumber,expiry:cardExpiry,holderName:cardName});
    toast.show('Card added successfully! ðŸ’³','success');
    setShowAddCard(false);
    setCardNumber('');setCardExpiry('');setCardCVV('');setCardName('');
    setRefresh(r=>r+1);
  };
  
  const WalletModal=()=>(
    showWallet&&(
      <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
        {/* Header */}
        <div className="p-4 border-b flex items-center gap-3">
          <button onClick={()=>setShowWallet(false)} className="w-9 h-9 bg-gray-100 rounded-xl flex items-center justify-center">
            <i className="fa-solid fa-arrow-left text-gray-600 text-sm"></i>
          </button>
          <h1 className="text-lg font-bold">Wallet & Payments</h1>
        </div>
        
        {/* Tabs */}
        <div className="flex border-b">
          {[{id:'wallet',label:'Wallet'},{id:'cards',label:'Cards'},{id:'history',label:'History'}].map(t=>(
            <button key={t.id} onClick={()=>setWalletTab(t.id)} className={`flex-1 py-3 text-sm font-semibold ${walletTab===t.id?'text-pink-500 border-b-2 border-pink-500':'text-gray-500'}`}>{t.label}</button>
          ))}
        </div>
        
        <div className="flex-1 overflow-y-auto p-4">
          {/* Wallet Tab */}
          {walletTab==='wallet'&&(
            <div className="anim-fade">
              {/* Balance Card */}
              <div className="gradient-primary text-white rounded-2xl p-5 mb-4">
                <p className="text-xs opacity-80">Available Balance</p>
                <p className="text-3xl font-bold mt-1">â‚¬{wallet.balance.toFixed(2)}</p>
                <div className="flex gap-3 mt-4">
                  <div className="flex-1 bg-white/20 rounded-xl p-2 text-center">
                    <p className="text-lg font-bold">â‚¬{txnSummary.thisMonthSpent}</p>
                    <p className="text-[10px] opacity-80">This Month</p>
                  </div>
                  <div className="flex-1 bg-white/20 rounded-xl p-2 text-center">
                    <p className="text-lg font-bold">{txnSummary.transactionCount}</p>
                    <p className="text-[10px] opacity-80">Transactions</p>
                  </div>
                </div>
              </div>
              
              {/* Quick Top-up */}
              <h3 className="font-bold text-sm mb-2">Quick Top-up</h3>
              <div className="grid grid-cols-4 gap-2 mb-4">
                {[10,25,50,100].map(amt=>(
                  <button key={amt} onClick={()=>setTopUpAmount(amt)} className={`py-2.5 rounded-xl font-bold text-sm transition-all ${topUpAmount===amt?'gradient-primary text-white':'bg-gray-100 hover:bg-pink-50'}`}>â‚¬{amt}</button>
                ))}
              </div>
              
              {/* Custom Amount */}
              <div className="flex gap-2 mb-4">
                <div className="flex-1 relative">
                  <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 font-bold">â‚¬</span>
                  <input type="number" value={topUpAmount||''} onChange={e=>setTopUpAmount(Number(e.target.value))} placeholder="Custom amount" className="w-full pl-8 pr-4 py-3 bg-gray-100 rounded-xl outline-none text-sm font-medium"/>
                </div>
                <button onClick={()=>handleTopUp(topUpAmount)} disabled={topUpAmount<=0||processing} className="px-6 py-3 gradient-primary text-white rounded-xl font-bold text-sm disabled:opacity-50">
                  {processing?<i className="fa-solid fa-spinner spinner"></i>:'Add'}
                </button>
              </div>
              
              {/* Payment Methods Info */}
              <div className="bg-blue-50 rounded-xl p-3 flex items-center gap-3">
                <i className="fa-solid fa-shield-check text-blue-500"></i>
                <p className="text-xs text-blue-700">Secure payments powered by Stripe</p>
              </div>
            </div>
          )}
          
          {/* Cards Tab */}
          {walletTab==='cards'&&(
            <div className="anim-fade">
              {/* Saved Cards */}
              {savedCards.length>0?(
                <div className="space-y-3 mb-4">
                  {savedCards.map(card=>(
                    <div key={card.id} className={`p-4 rounded-xl border-2 flex items-center gap-3 ${card.isDefault?'border-pink-500 bg-pink-50':'border-gray-200'}`}>
                      <div className="w-12 h-8 bg-gradient-to-r from-gray-700 to-gray-900 rounded-lg flex items-center justify-center">
                        <i className={`fa-brands fa-cc-${card.brand.toLowerCase()} text-white text-lg`}></i>
                      </div>
                      <div className="flex-1">
                        <p className="font-bold text-sm">â€¢â€¢â€¢â€¢ {card.last4}</p>
                        <p className="text-xs text-gray-500">{card.brand} â€¢ Expires {card.expiry}</p>
                      </div>
                      {card.isDefault&&<span className="text-[10px] bg-pink-500 text-white px-2 py-0.5 rounded-full">Default</span>}
                      <button onClick={()=>{DB.removeCard(card.id);toast.show('Card removed');setRefresh(r=>r+1)}} className="text-red-400 text-sm"><i className="fa-solid fa-trash"></i></button>
                    </div>
                  ))}
                </div>
              ):(
                <div className="text-center py-8 mb-4">
                  <i className="fa-solid fa-credit-card text-4xl text-gray-200 mb-3"></i>
                  <p className="text-gray-500 text-sm">No saved cards</p>
                </div>
              )}
              
              {/* Add Card Form */}
              {showAddCard?(
                <div className="bg-gray-50 rounded-xl p-4 space-y-3">
                  <input type="text" value={cardNumber} onChange={e=>setCardNumber(e.target.value.replace(/\D/g,'').slice(0,16))} placeholder="Card Number" className="w-full p-3 bg-white rounded-xl border outline-none text-sm"/>
                  <div className="grid grid-cols-2 gap-3">
                    <input type="text" value={cardExpiry} onChange={e=>{let v=e.target.value.replace(/\D/g,'');if(v.length>=2)v=v.slice(0,2)+'/'+v.slice(2,4);setCardExpiry(v)}} placeholder="MM/YY" maxLength="5" className="p-3 bg-white rounded-xl border outline-none text-sm"/>
                    <input type="text" value={cardCVV} onChange={e=>setCardCVV(e.target.value.replace(/\D/g,'').slice(0,4))} placeholder="CVV" className="p-3 bg-white rounded-xl border outline-none text-sm"/>
                  </div>
                  <input type="text" value={cardName} onChange={e=>setCardName(e.target.value)} placeholder="Cardholder Name" className="w-full p-3 bg-white rounded-xl border outline-none text-sm"/>
                  <div className="flex gap-2">
                    <button onClick={()=>setShowAddCard(false)} className="flex-1 py-3 bg-gray-200 rounded-xl font-bold text-sm">Cancel</button>
                    <button onClick={handleAddCard} className="flex-1 py-3 gradient-primary text-white rounded-xl font-bold text-sm">Save Card</button>
                  </div>
                </div>
              ):(
                <button onClick={()=>setShowAddCard(true)} className="w-full py-3 border-2 border-dashed border-gray-300 rounded-xl text-gray-500 font-medium text-sm flex items-center justify-center gap-2">
                  <i className="fa-solid fa-plus"></i>Add New Card
                </button>
              )}
            </div>
          )}
          
          {/* History Tab */}
          {walletTab==='history'&&(
            <div className="anim-fade">
              {/* Summary */}
              <div className="grid grid-cols-3 gap-2 mb-4">
                <div className="bg-green-50 rounded-xl p-3 text-center">
                  <p className="text-lg font-bold text-green-600">â‚¬{txnSummary.totalTopUp}</p>
                  <p className="text-[10px] text-gray-500">Top-ups</p>
                </div>
                <div className="bg-red-50 rounded-xl p-3 text-center">
                  <p className="text-lg font-bold text-red-600">â‚¬{txnSummary.totalSpent}</p>
                  <p className="text-[10px] text-gray-500">Spent</p>
                </div>
                <div className="bg-blue-50 rounded-xl p-3 text-center">
                  <p className="text-lg font-bold text-blue-600">â‚¬{txnSummary.totalRefunds}</p>
                  <p className="text-[10px] text-gray-500">Refunds</p>
                </div>
              </div>
              
              {/* Transactions List */}
              {transactions.length>0?(
                <div className="space-y-2">
                  {transactions.slice(0,20).map(txn=>(
                    <div key={txn.id} className="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
                      <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${txn.amount>0?'bg-green-100 text-green-600':'bg-red-100 text-red-600'}`}>
                        <i className={`fa-solid ${txn.type==='topup'?'fa-arrow-down':txn.type==='refund'?'fa-rotate-left':'fa-arrow-up'} text-sm`}></i>
                      </div>
                      <div className="flex-1 min-w-0">
                        <p className="font-medium text-sm truncate">{txn.description}</p>
                        <p className="text-[10px] text-gray-400">{new Date(txn.createdAt).toLocaleDateString()}</p>
                      </div>
                      <p className={`font-bold text-sm ${txn.amount>0?'text-green-600':'text-red-600'}`}>
                        {txn.amount>0?'+':''}â‚¬{Math.abs(txn.amount).toFixed(2)}
                      </p>
                    </div>
                  ))}
                </div>
              ):(
                <div className="text-center py-8">
                  <i className="fa-solid fa-receipt text-4xl text-gray-200 mb-3"></i>
                  <p className="text-gray-500 text-sm">No transactions yet</p>
                </div>
              )}
            </div>
          )}
        </div>
      </div>
    )
  );

  // MODULE 29: Offers Modal
  const OffersModal=()=>(
    showOffers&&(
      <div className="fixed inset-0 z-50 flex items-end justify-center">
        <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={()=>setShowOffers(false)}></div>
        <div className="w-full max-w-md bg-white rounded-t-[32px] p-6 anim-slide-up relative z-50 max-h-[80vh] overflow-y-auto">
          <div className="w-12 h-1.5 bg-gray-300 rounded-full mx-auto mb-6"></div>
          <h2 className="text-xl font-bold mb-4">Offers & Rewards</h2>

          {/* Points */}
          <div className="bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-3xl p-5 mb-6">
            <div className="flex justify-between items-center">
              <div>
                <p className="text-sm opacity-80">Loyalty Points</p>
                <p className="text-3xl font-bold mt-1">{userData.points||0}</p>
              </div>
              <div className="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
                <i className="fa-solid fa-coins text-2xl"></i>
              </div>
            </div>
            <p className="text-xs opacity-70 mt-3">Earn 10 points for every â‚¬1 spent</p>
          </div>

          {/* Coupons */}
          <h3 className="font-bold mb-3">Available Coupons</h3>
          <div className="space-y-3">
            {[
              {code:'SAVE10',discount:'â‚¬10 OFF',desc:'On orders above â‚¬50',expires:'Dec 31'},
              {code:'FIRST20',discount:'20% OFF',desc:'First booking discount',expires:'Jan 15'},
            ].map(c=>(
              <div key={c.code} className="bg-gray-50 rounded-2xl p-4 flex items-center gap-4 border-2 border-dashed border-gray-200">
                <div className="w-16 h-16 gradient-primary rounded-xl flex items-center justify-center text-white">
                  <i className="fa-solid fa-ticket text-2xl"></i>
                </div>
                <div className="flex-1">
                  <p className="font-bold">{c.discount}</p>
                  <p className="text-xs text-gray-500">{c.desc}</p>
                  <p className="text-xs text-gray-400 mt-1">Expires: {c.expires}</p>
                </div>
                <button onClick={()=>{navigator.clipboard.writeText(c.code);toast.show('Code copied!','success')}} className="text-pink-500 font-bold text-sm">{c.code}</button>
              </div>
            ))}
          </div>

          {/* Referral */}
          <div className="mt-6 bg-green-50 rounded-2xl p-5 border border-green-100">
            <h3 className="font-bold text-green-800">Refer & Earn</h3>
            <p className="text-sm text-green-600 mt-1">Get â‚¬15 for each friend who books!</p>
            <button className="w-full mt-4 py-3 bg-green-500 text-white rounded-xl font-bold">Share Referral Code</button>
          </div>
        </div>
      </div>
    )
  );

  // MODULE 34: Language Modal
  const LanguageModal=()=>(
    showLanguage&&(
      <div className="fixed inset-0 z-50 flex items-end justify-center">
        <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={()=>setShowLanguage(false)}></div>
        <div className="w-full max-w-md bg-white rounded-t-[32px] p-6 anim-slide-up relative z-50">
          <div className="w-12 h-1.5 bg-gray-300 rounded-full mx-auto mb-6"></div>
          <h2 className="text-xl font-bold mb-6">ðŸŒ Select Language</h2>
          
          <div className="space-y-3">
            {Object.values(DB.languages).map(lang=>(
              <button key={lang.code} onClick={()=>{DB.setLanguage(lang.code);setCurrentLang(lang.code);setShowLanguage(false);toast.show(`Language changed to ${lang.name}`,'success')}} className={`w-full p-4 rounded-2xl border-2 flex items-center justify-between ${currentLang===lang.code?'border-pink-500 bg-pink-50':'border-gray-200'}`}>
                <div className="flex items-center gap-4">
                  <span className="text-2xl">{lang.code==='en'?'ðŸ‡¬ðŸ‡§':lang.code==='ur'?'ðŸ‡µðŸ‡°':'ðŸ‡«ðŸ‡·'}</span>
                  <div className="text-left">
                    <p className="font-bold">{lang.name}</p>
                    <p className="text-xs text-gray-500">{lang.code==='en'?'English':lang.code==='ur'?'Urdu':'French'}</p>
                  </div>
                </div>
                {currentLang===lang.code&&<i className="fa-solid fa-check-circle text-pink-500 text-xl"></i>}
              </button>
            ))}
          </div>
        </div>
      </div>
    )
  );

  // MODULE 37: Membership Modal
  const MembershipModal=()=>{
    const currentMembership=DB.getUserMembership(user.id);
    return showMembership&&(
      <div className="fixed inset-0 z-50 bg-white anim-fade overflow-y-auto">
        <div className="p-5 border-b flex items-center gap-4 sticky top-0 bg-white z-10">
          <button onClick={()=>setShowMembership(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
            <i className="fa-solid fa-arrow-left text-gray-600"></i>
          </button>
          <h1 className="text-xl font-bold">ðŸ’Ž Membership Plans</h1>
        </div>
        
        <div className="p-5">
          {currentMembership&&(
            <div className="bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-3xl p-5 mb-6">
              <div className="flex items-center gap-3 mb-3">
                <i className="fa-solid fa-crown text-2xl text-yellow-300"></i>
                <div>
                  <p className="text-sm opacity-80">Current Plan</p>
                  <p className="text-xl font-bold">{currentMembership.planName} Member</p>
                </div>
              </div>
              <p className="text-sm opacity-80">Valid until {new Date(currentMembership.endDate).toLocaleDateString()}</p>
            </div>
          )}

          <div className="space-y-4">
            {DB.getMembershipPlans().map(plan=>(
              <div key={plan.id} className={`bg-white rounded-3xl border-2 overflow-hidden ${plan.popular?'border-pink-500':'border-gray-200'}`}>
                {plan.popular&&<div className="bg-pink-500 text-white text-center py-1 text-xs font-bold">â­ MOST POPULAR</div>}
                <div className="p-5">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3">
                      <div className={`w-12 h-12 rounded-2xl bg-gradient-to-br ${plan.color} flex items-center justify-center text-white`}>
                        <i className="fa-solid fa-crown text-lg"></i>
                      </div>
                      <div>
                        <h3 className="font-bold text-lg">{plan.name}</h3>
                        <p className="text-xs text-gray-500">Monthly subscription</p>
                      </div>
                    </div>
                    <div className="text-right">
                      <p className="text-2xl font-bold">â‚¬{plan.price}</p>
                      <p className="text-xs text-gray-500">/month</p>
                    </div>
                  </div>
                  <div className="space-y-2 mb-4">
                    {plan.features.map((f,i)=>(
                      <div key={i} className="flex items-center gap-2 text-sm">
                        <i className="fa-solid fa-check text-green-500"></i>
                        <span>{f}</span>
                      </div>
                    ))}
                  </div>
                  <button onClick={()=>{DB.subscribeMembership(user.id,plan.id);toast.show(`Subscribed to ${plan.name}! ðŸŽ‰`,'success');setShowMembership(false)}} className={`w-full py-3 rounded-2xl font-bold ${currentMembership?.planId===plan.id?'bg-gray-100 text-gray-400':'bg-gradient-to-r '+plan.color+' text-white'}`} disabled={currentMembership?.planId===plan.id}>
                    {currentMembership?.planId===plan.id?'Current Plan':'Subscribe'}
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  // MODULE 38: Gift Cards Modal
  const GiftCardsModal=()=>{
    const[giftAmount,setGiftAmount]=useState(50);
    const[recipientEmail,setRecipientEmail]=useState('');
    const[giftMessage,setGiftMessage]=useState('');
    const[redeemCode,setRedeemCode]=useState('');
    const[giftTab,setGiftTab]=useState('buy');

    const buyGiftCard=()=>{
      if(!recipientEmail){toast.show('Enter recipient email','error');return}
      const gc=DB.purchaseGiftCard(user.id,giftAmount,recipientEmail,giftMessage);
      toast.show(`Gift card sent! Code: ${gc.code}`,'success');
      setRecipientEmail('');setGiftMessage('');
    };

    const redeemGiftCard=()=>{
      const result=DB.redeemGiftCard(redeemCode,user.id);
      if(result.success){
        toast.show(`â‚¬${result.amount} added to wallet! ðŸŽ‰`,'success');
        setRedeemCode('');
        setUserData({...userData,walletBalance:(userData.walletBalance||0)+result.amount});
      }else{
        toast.show(result.error,'error');
      }
    };

    return showGiftCards&&(
      <div className="fixed inset-0 z-50 flex items-end justify-center">
        <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={()=>setShowGiftCards(false)}></div>
        <div className="w-full max-w-md bg-white rounded-t-[32px] p-6 anim-slide-up relative z-50 max-h-[85vh] overflow-y-auto">
          <div className="w-12 h-1.5 bg-gray-300 rounded-full mx-auto mb-6"></div>
          <h2 className="text-xl font-bold mb-4">ðŸŽ Gift Cards</h2>

          <div className="flex gap-2 mb-6">
            <button onClick={()=>setGiftTab('buy')} className={`flex-1 py-3 rounded-xl font-bold ${giftTab==='buy'?'gradient-primary text-white':'bg-gray-100 text-gray-600'}`}>Buy Gift Card</button>
            <button onClick={()=>setGiftTab('redeem')} className={`flex-1 py-3 rounded-xl font-bold ${giftTab==='redeem'?'gradient-primary text-white':'bg-gray-100 text-gray-600'}`}>Redeem</button>
          </div>

          {giftTab==='buy'?(
            <>
              <div className="bg-gradient-to-br from-pink-500 via-purple-500 to-indigo-500 rounded-3xl p-6 text-white mb-6 relative overflow-hidden">
                <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"></div>
                <i className="fa-solid fa-gift text-4xl mb-3 opacity-80"></i>
                <p className="text-3xl font-bold">â‚¬{giftAmount}</p>
                <p className="text-sm opacity-80 mt-1">GoBeauty Gift Card</p>
              </div>

              <p className="font-bold mb-2">Select Amount</p>
              <div className="grid grid-cols-4 gap-2 mb-4">
                {[25,50,75,100].map(amt=>(
                  <button key={amt} onClick={()=>setGiftAmount(amt)} className={`py-3 rounded-xl font-bold ${giftAmount===amt?'gradient-primary text-white':'bg-gray-100 text-gray-600'}`}>â‚¬{amt}</button>
                ))}
              </div>

              <input type="email" value={recipientEmail} onChange={e=>setRecipientEmail(e.target.value)} placeholder="Recipient's email" className="w-full px-4 py-4 bg-gray-100 rounded-2xl mb-3 outline-none"/>
              <textarea value={giftMessage} onChange={e=>setGiftMessage(e.target.value)} placeholder="Add a personal message (optional)" className="w-full px-4 py-4 bg-gray-100 rounded-2xl mb-4 outline-none resize-none h-20"/>
              
              <button onClick={buyGiftCard} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold">
                <i className="fa-solid fa-gift mr-2"></i>Send Gift Card - â‚¬{giftAmount}
              </button>
            </>
          ):(
            <>
              <div className="text-center py-8">
                <div className="w-20 h-20 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i className="fa-solid fa-ticket text-3xl text-pink-500"></i>
                </div>
                <p className="text-gray-500">Enter your gift card code to redeem</p>
              </div>

              <input type="text" value={redeemCode} onChange={e=>setRedeemCode(e.target.value.toUpperCase())} placeholder="Enter code (e.g. GCXXX123)" className="w-full px-4 py-4 bg-gray-100 rounded-2xl mb-4 outline-none text-center font-mono text-lg uppercase"/>
              
              <button onClick={redeemGiftCard} disabled={!redeemCode} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold disabled:opacity-50">
                <i className="fa-solid fa-check mr-2"></i>Redeem Gift Card
              </button>
            </>
          )}
        </div>
      </div>
    );
  };

  // MODULE 39: Live Tracking Modal
  const LiveTrackingModal=()=>{
    const[eta,setEta]=useState(15);
    const[providerLoc,setProviderLoc]=useState(null);

    useEffect(()=>{
      if(showLiveTracking){
        const interval=setInterval(()=>{
          setEta(prev=>Math.max(prev-1,1));
        },60000);
        return()=>clearInterval(interval);
      }
    },[showLiveTracking]);

    if(!showLiveTracking)return null;
    const booking=DB.getBookings().find(b=>b.id===showLiveTracking);
    const provider=booking?DB.getProviderById(booking.providerId):null;

    return(
      <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
        <div className="p-5 border-b flex items-center gap-4">
          <button onClick={()=>setShowLiveTracking(null)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
            <i className="fa-solid fa-arrow-left text-gray-600"></i>
          </button>
          <h1 className="text-xl font-bold">ðŸ“ Live Tracking</h1>
        </div>

        <div className="flex-1 bg-gray-100 relative">
          <div className="absolute inset-0 flex items-center justify-center">
            <div className="text-center">
              <div className="w-20 h-20 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                <i className="fa-solid fa-location-dot text-3xl text-pink-500"></i>
              </div>
              <p className="text-gray-500">Map view coming soon</p>
            </div>
          </div>
        </div>

        <div className="p-5 bg-white rounded-t-3xl shadow-lg -mt-6 relative z-10">
          <div className="flex items-center gap-4 mb-4">
            <img src={provider?.image||'https://via.placeholder.com/50'} className="w-14 h-14 rounded-2xl object-cover"/>
            <div className="flex-1">
              <p className="font-bold">{provider?.businessName||'Provider'}</p>
              <p className="text-sm text-green-500"><i className="fa-solid fa-car mr-1"></i>On the way</p>
            </div>
            <button className="w-12 h-12 bg-green-100 rounded-2xl flex items-center justify-center">
              <i className="fa-solid fa-phone text-green-600"></i>
            </button>
          </div>

          <div className="bg-gradient-to-r from-pink-50 to-purple-50 rounded-2xl p-4 flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-500">Estimated Arrival</p>
              <p className="text-2xl font-bold text-pink-600">{eta} mins</p>
            </div>
            <div className="w-16 h-16 bg-white rounded-full flex items-center justify-center shadow">
              <i className="fa-solid fa-clock text-2xl text-pink-500"></i>
            </div>
          </div>

          <div className="flex gap-3 mt-4">
            <button className="flex-1 py-3 bg-gray-100 rounded-xl font-bold text-gray-600">
              <i className="fa-solid fa-comment mr-2"></i>Message
            </button>
            <button className="flex-1 py-3 bg-red-50 rounded-xl font-bold text-red-500">
              <i className="fa-solid fa-times mr-2"></i>Cancel
            </button>
          </div>
        </div>
      </div>
    );
  };

  // MODULE 31: Chat System
  const[showChat,setShowChat]=useState(false);
  const[activeChat,setActiveChat]=useState(null);
  const[chatMessage,setChatMessage]=useState('');

  const ChatList=()=>{
    const userChats=DB.getUserChats(user.id);
    return(
      <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
        <div className="p-5 border-b flex items-center gap-4">
          <button onClick={()=>setShowChat(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
            <i className="fa-solid fa-arrow-left text-gray-600"></i>
          </button>
          <h1 className="text-xl font-bold">Messages</h1>
        </div>
        <div className="flex-1 overflow-y-auto">
          {userChats.length>0?(
            <div className="divide-y">
              {userChats.map(chat=>(
                <button key={chat.id} onClick={()=>setActiveChat(chat)} className="w-full p-4 flex items-center gap-4 hover:bg-gray-50 text-left">
                  <div className="relative">
                    <img src={chat.provider?.image||'https://via.placeholder.com/50'} className="w-14 h-14 rounded-2xl object-cover"/>
                    {chat.unreadUser>0&&<span className="absolute -top-1 -right-1 w-5 h-5 bg-pink-500 text-white text-xs rounded-full flex items-center justify-center">{chat.unreadUser}</span>}
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="flex justify-between items-center">
                      <h3 className="font-bold truncate">{chat.provider?.businessName||'Provider'}</h3>
                      <span className="text-xs text-gray-400">{chat.lastMessageAt?new Date(chat.lastMessageAt).toLocaleDateString():''}</span>
                    </div>
                    <p className="text-sm text-gray-500 truncate">{chat.lastMessage||'Start a conversation'}</p>
                  </div>
                </button>
              ))}
            </div>
          ):(
            <div className="flex flex-col items-center justify-center h-full text-center p-8">
              <i className="fa-solid fa-comments text-6xl text-gray-200 mb-4"></i>
              <p className="text-gray-500 font-medium">No conversations yet</p>
              <p className="text-sm text-gray-400 mt-1">Book a service to start chatting</p>
            </div>
          )}
        </div>
      </div>
    );
  };

  const ChatWindow=()=>{
    if(!activeChat)return null;
    const messages=DB.getChatMessages(activeChat.id);
    const quickReplies=DB.getQuickReplies();

    const sendMsg=()=>{
      if(!chatMessage.trim())return;
      DB.sendMessage(activeChat.id,user.id,'user',chatMessage);
      setChatMessage('');
      setActiveChat({...activeChat,messages:DB.getChatMessages(activeChat.id)});
    };

    return(
      <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
        <div className="p-4 border-b flex items-center gap-4">
          <button onClick={()=>setActiveChat(null)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
            <i className="fa-solid fa-arrow-left text-gray-600"></i>
          </button>
          <img src={activeChat.provider?.image||'https://via.placeholder.com/50'} className="w-11 h-11 rounded-xl object-cover"/>
          <div className="flex-1">
            <h3 className="font-bold">{activeChat.provider?.businessName||'Provider'}</h3>
            <p className="text-xs text-green-500"><i className="fa-solid fa-circle text-[6px] mr-1"></i>Online</p>
          </div>
          <button className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
            <i className="fa-solid fa-phone text-gray-600"></i>
          </button>
        </div>
        
        <div className="flex-1 overflow-y-auto p-4 bg-gray-50">
          {messages.length===0&&(
            <div className="text-center py-8">
              <p className="text-gray-400 text-sm">Start the conversation!</p>
            </div>
          )}
          {messages.map(msg=>(
            <div key={msg.id} className={`flex mb-3 ${msg.senderType==='user'?'justify-end':'justify-start'}`}>
              <div className={`max-w-[75%] px-4 py-3 rounded-2xl ${msg.senderType==='user'?'gradient-primary text-white rounded-br-md':'bg-white border rounded-bl-md'}`}>
                <p className="text-sm">{msg.text}</p>
                <p className={`text-[10px] mt-1 ${msg.senderType==='user'?'text-white/70':'text-gray-400'}`}>{new Date(msg.createdAt).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</p>
              </div>
            </div>
          ))}
        </div>

        <div className="p-4 border-t bg-white">
          <div className="flex gap-2 overflow-x-auto pb-3 no-scrollbar">
            {quickReplies.slice(0,4).map(qr=>(
              <button key={qr.id} onClick={()=>setChatMessage(qr.text)} className="shrink-0 px-3 py-1.5 bg-gray-100 rounded-full text-xs font-medium text-gray-600">{qr.text}</button>
            ))}
          </div>
          <div className="flex gap-2">
            <button className="w-11 h-11 bg-gray-100 rounded-xl flex items-center justify-center shrink-0">
              <i className="fa-solid fa-image text-gray-500"></i>
            </button>
            <input type="text" value={chatMessage} onChange={e=>setChatMessage(e.target.value)} onKeyPress={e=>e.key==='Enter'&&sendMsg()} placeholder="Type a message..." className="flex-1 px-4 py-3 bg-gray-100 rounded-xl outline-none text-sm"/>
            <button onClick={sendMsg} disabled={!chatMessage.trim()} className="w-11 h-11 gradient-primary rounded-xl flex items-center justify-center shrink-0 disabled:opacity-50">
              <i className="fa-solid fa-paper-plane text-white"></i>
            </button>
          </div>
        </div>
      </div>
    );
  };

  // MODULE 32: Notifications
  const[showNotifications,setShowNotifications]=useState(false);
  const userNotifications=DB.getUserNotifications(user.id);
  const unreadCount=DB.getUnreadNotificationCount(user.id);

  // PLAN L: Enhanced Notifications Panel (Modules 67-71)
  const[notifTab,setNotifTab]=useState('all');
  const[showNotifSettings,setShowNotifSettings]=useState(false);
  const[showNotifHistory,setShowNotifHistory]=useState(false);
  const notifPrefs=DB.getNotificationPreferences(user.id);
  const notifStats=DB.getNotificationStats(user.id);
  const notifHistory=DB.getNotificationHistory(user.id);
  const dismissedPromos=DB.getDismissedPromos(user.id);
  const activePromos=DB.getActivePromos().filter(p=>!dismissedPromos.includes(p.id));
  
  const NotificationsPanel=()=>{
    const filteredNotifs=notifTab==='all'?userNotifications:userNotifications.filter(n=>!n.read);
    
    return showNotifications&&(
      <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
        {/* Header */}
        <div className="p-5 border-b">
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-4">
              <button onClick={()=>setShowNotifications(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
                <i className="fa-solid fa-arrow-left text-gray-600"></i>
              </button>
              <div>
                <h1 className="text-xl font-bold">Notifications</h1>
                <p className="text-xs text-gray-500">{notifStats.unread} unread</p>
              </div>
            </div>
            <div className="flex gap-2">
              <button onClick={()=>setShowNotifHistory(true)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
                <i className="fa-solid fa-clock-rotate-left text-gray-600"></i>
              </button>
              <button onClick={()=>setShowNotifSettings(true)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
                <i className="fa-solid fa-gear text-gray-600"></i>
              </button>
            </div>
          </div>
          
          {/* Stats Bar */}
          <div className="flex gap-3 mb-4">
            <div className="flex-1 bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl p-3 text-center">
              <p className="text-lg font-bold text-pink-600">{notifStats.today}</p>
              <p className="text-[10px] text-gray-500">Today</p>
            </div>
            <div className="flex-1 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl p-3 text-center">
              <p className="text-lg font-bold text-blue-600">{notifStats.thisWeek}</p>
              <p className="text-[10px] text-gray-500">This Week</p>
            </div>
            <div className="flex-1 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-3 text-center">
              <p className="text-lg font-bold text-green-600">{notifStats.total}</p>
              <p className="text-[10px] text-gray-500">All Time</p>
            </div>
          </div>

          {/* Tabs */}
          <div className="flex gap-2">
            <button onClick={()=>setNotifTab('all')} className={`flex-1 py-2.5 rounded-xl text-sm font-bold ${notifTab==='all'?'gradient-primary text-white':'bg-gray-100 text-gray-600'}`}>
              All ({userNotifications.length})
            </button>
            <button onClick={()=>setNotifTab('unread')} className={`flex-1 py-2.5 rounded-xl text-sm font-bold ${notifTab==='unread'?'gradient-primary text-white':'bg-gray-100 text-gray-600'}`}>
              Unread ({notifStats.unread})
            </button>
            {userNotifications.length>0&&(
              <button onClick={()=>{DB.markAllNotificationsRead(user.id);setRefresh(r=>r+1)}} className="px-4 py-2.5 bg-gray-100 rounded-xl text-sm font-bold text-pink-500">
                <i className="fa-solid fa-check-double"></i>
              </button>
            )}
          </div>
        </div>

        {/* Promo Banner */}
        {activePromos.length>0&&(
          <div className="px-5 py-3 bg-gradient-to-r from-yellow-400 to-orange-400">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <i className="fa-solid fa-gift text-white text-xl"></i>
                <div className="text-white">
                  <p className="font-bold text-sm">{activePromos[0].title}</p>
                  <p className="text-xs opacity-90">{activePromos[0].message}</p>
                </div>
              </div>
              <button onClick={()=>{DB.dismissPromoBanner(activePromos[0].id,user.id);setRefresh(r=>r+1)}} className="text-white/80 hover:text-white">
                <i className="fa-solid fa-times"></i>
              </button>
            </div>
          </div>
        )}

        {/* Notifications List */}
        <div className="flex-1 overflow-y-auto">
          {filteredNotifs.length>0?(
            <div className="divide-y">
              {filteredNotifs.map(notif=>{
                const typeInfo=DB.notificationTypes[notif.type]||{icon:'fa-bell',color:'gray'};
                const timeAgo=(date)=>{
                  const diff=(Date.now()-new Date(date))/1000;
                  if(diff<60)return 'Just now';
                  if(diff<3600)return Math.floor(diff/60)+'m ago';
                  if(diff<86400)return Math.floor(diff/3600)+'h ago';
                  return Math.floor(diff/86400)+'d ago';
                };
                return(
                  <div key={notif.id} className={`p-4 flex gap-4 ${!notif.read?'bg-pink-50/50':''}`}>
                    <div className={`w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 ${typeInfo.color==='green'?'bg-green-100 text-green-600':typeInfo.color==='red'?'bg-red-100 text-red-600':typeInfo.color==='blue'?'bg-blue-100 text-blue-600':typeInfo.color==='yellow'?'bg-yellow-100 text-yellow-600':typeInfo.color==='purple'?'bg-purple-100 text-purple-600':typeInfo.color==='orange'?'bg-orange-100 text-orange-600':typeInfo.color==='pink'?'bg-pink-100 text-pink-600':'bg-gray-100 text-gray-600'}`}>
                      <i className={`fa-solid ${typeInfo.icon} text-lg`}></i>
                    </div>
                    <div className="flex-1 min-w-0">
                      <div className="flex justify-between items-start">
                        <h3 className={`font-bold text-sm ${!notif.read?'text-gray-900':'text-gray-600'}`}>{notif.title}</h3>
                        <span className="text-[10px] text-gray-400 shrink-0">{timeAgo(notif.createdAt)}</span>
                      </div>
                      <p className="text-sm text-gray-500 mt-0.5">{notif.message}</p>
                      {!notif.read&&(
                        <button onClick={()=>{DB.markNotificationRead(notif.id);setRefresh(r=>r+1)}} className="text-xs text-pink-500 font-medium mt-2">Mark as read</button>
                      )}
                    </div>
                    <button onClick={()=>{DB.deleteNotification(notif.id);setRefresh(r=>r+1)}} className="text-gray-300 hover:text-red-500 shrink-0">
                      <i className="fa-solid fa-trash text-xs"></i>
                    </button>
                  </div>
                );
              })}
            </div>
          ):(
            <div className="flex flex-col items-center justify-center h-full text-center p-8">
              <i className="fa-solid fa-bell-slash text-6xl text-gray-200 mb-4"></i>
              <p className="text-gray-500 font-medium">{notifTab==='unread'?'All caught up!':'No notifications yet'}</p>
              <p className="text-xs text-gray-400 mt-1">We'll notify you when something happens</p>
            </div>
          )}
        </div>

        {/* Clear All Button */}
        {userNotifications.length>0&&(
          <div className="p-4 border-t">
            <button onClick={()=>{DB.clearNotifications(user.id);setRefresh(r=>r+1)}} className="w-full py-3 bg-gray-100 rounded-xl text-sm font-bold text-gray-600">
              <i className="fa-solid fa-trash mr-2"></i>Clear All Notifications
            </button>
          </div>
        )}

        {/* Settings Modal */}
        {showNotifSettings&&(
          <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
            <div className="p-5 border-b flex items-center gap-4">
              <button onClick={()=>setShowNotifSettings(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
                <i className="fa-solid fa-arrow-left text-gray-600"></i>
              </button>
              <h1 className="text-xl font-bold">Notification Settings</h1>
            </div>
            <div className="flex-1 overflow-y-auto p-5">
              {/* Push Notifications */}
              <div className="mb-6">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-10 h-10 bg-pink-100 rounded-xl flex items-center justify-center">
                    <i className="fa-solid fa-bell text-pink-500"></i>
                  </div>
                  <div className="flex-1">
                    <p className="font-bold">Push Notifications</p>
                    <p className="text-xs text-gray-500">In-app alerts</p>
                  </div>
                  <button onClick={()=>{DB.updateNotificationPreferences(user.id,{push_enabled:!notifPrefs.push_enabled});setRefresh(r=>r+1)}} className={`w-12 h-7 rounded-full ${notifPrefs.push_enabled?'bg-pink-500':'bg-gray-300'}`}>
                    <div className={`w-5 h-5 bg-white rounded-full shadow transition-all ${notifPrefs.push_enabled?'ml-6':'ml-1'}`}></div>
                  </button>
                </div>
                {notifPrefs.push_enabled&&(
                  <div className="space-y-3 pl-12">
                    {[{key:'push_bookings',label:'Booking updates'},{key:'push_messages',label:'New messages'},{key:'push_reminders',label:'Appointment reminders'},{key:'push_promos',label:'Promotions & offers'},{key:'push_reviews',label:'Review updates'}].map(item=>(
                      <div key={item.key} className="flex items-center justify-between py-2">
                        <span className="text-sm text-gray-600">{item.label}</span>
                        <button onClick={()=>{DB.updateNotificationPreferences(user.id,{[item.key]:!notifPrefs[item.key]});setRefresh(r=>r+1)}} className={`w-10 h-6 rounded-full ${notifPrefs[item.key]?'bg-pink-500':'bg-gray-300'}`}>
                          <div className={`w-4 h-4 bg-white rounded-full shadow transition-all ${notifPrefs[item.key]?'ml-5':'ml-1'}`}></div>
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              {/* Email Notifications */}
              <div className="mb-6">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                    <i className="fa-solid fa-envelope text-blue-500"></i>
                  </div>
                  <div className="flex-1">
                    <p className="font-bold">Email Notifications</p>
                    <p className="text-xs text-gray-500">Updates to your email</p>
                  </div>
                  <button onClick={()=>{DB.updateNotificationPreferences(user.id,{email_enabled:!notifPrefs.email_enabled});setRefresh(r=>r+1)}} className={`w-12 h-7 rounded-full ${notifPrefs.email_enabled?'bg-blue-500':'bg-gray-300'}`}>
                    <div className={`w-5 h-5 bg-white rounded-full shadow transition-all ${notifPrefs.email_enabled?'ml-6':'ml-1'}`}></div>
                  </button>
                </div>
                {notifPrefs.email_enabled&&(
                  <div className="space-y-3 pl-12">
                    {[{key:'email_bookings',label:'Booking confirmations'},{key:'email_reminders',label:'Appointment reminders'},{key:'email_promos',label:'Promotions & offers'},{key:'email_reviews',label:'Review responses'},{key:'email_weekly_summary',label:'Weekly summary'}].map(item=>(
                      <div key={item.key} className="flex items-center justify-between py-2">
                        <span className="text-sm text-gray-600">{item.label}</span>
                        <button onClick={()=>{DB.updateNotificationPreferences(user.id,{[item.key]:!notifPrefs[item.key]});setRefresh(r=>r+1)}} className={`w-10 h-6 rounded-full ${notifPrefs[item.key]?'bg-blue-500':'bg-gray-300'}`}>
                          <div className={`w-4 h-4 bg-white rounded-full shadow transition-all ${notifPrefs[item.key]?'ml-5':'ml-1'}`}></div>
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              {/* SMS Notifications */}
              <div className="mb-6">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
                    <i className="fa-solid fa-comment-sms text-green-500"></i>
                  </div>
                  <div className="flex-1">
                    <p className="font-bold">SMS Notifications</p>
                    <p className="text-xs text-gray-500">Text message alerts</p>
                  </div>
                  <button onClick={()=>{DB.updateNotificationPreferences(user.id,{sms_enabled:!notifPrefs.sms_enabled});setRefresh(r=>r+1)}} className={`w-12 h-7 rounded-full ${notifPrefs.sms_enabled?'bg-green-500':'bg-gray-300'}`}>
                    <div className={`w-5 h-5 bg-white rounded-full shadow transition-all ${notifPrefs.sms_enabled?'ml-6':'ml-1'}`}></div>
                  </button>
                </div>
                {notifPrefs.sms_enabled&&(
                  <div className="space-y-3 pl-12">
                    {[{key:'sms_bookings',label:'Booking updates'},{key:'sms_reminders',label:'Appointment reminders'},{key:'sms_urgent',label:'Urgent alerts only'}].map(item=>(
                      <div key={item.key} className="flex items-center justify-between py-2">
                        <span className="text-sm text-gray-600">{item.label}</span>
                        <button onClick={()=>{DB.updateNotificationPreferences(user.id,{[item.key]:!notifPrefs[item.key]});setRefresh(r=>r+1)}} className={`w-10 h-6 rounded-full ${notifPrefs[item.key]?'bg-green-500':'bg-gray-300'}`}>
                          <div className={`w-4 h-4 bg-white rounded-full shadow transition-all ${notifPrefs[item.key]?'ml-5':'ml-1'}`}></div>
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              {/* In-App Settings */}
              <div className="mb-6">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center">
                    <i className="fa-solid fa-mobile-screen text-purple-500"></i>
                  </div>
                  <p className="font-bold">In-App Alerts</p>
                </div>
                <div className="space-y-3 pl-12">
                  {[{key:'inapp_sound',label:'Sound',icon:'fa-volume-high'},{key:'inapp_vibrate',label:'Vibration',icon:'fa-mobile'},{key:'inapp_badge',label:'Badge count',icon:'fa-circle-1'},{key:'inapp_banner',label:'Banner alerts',icon:'fa-rectangle-ad'}].map(item=>(
                    <div key={item.key} className="flex items-center justify-between py-2">
                      <span className="text-sm text-gray-600"><i className={`fa-solid ${item.icon} mr-2 text-gray-400`}></i>{item.label}</span>
                      <button onClick={()=>{DB.updateNotificationPreferences(user.id,{[item.key]:!notifPrefs[item.key]});setRefresh(r=>r+1)}} className={`w-10 h-6 rounded-full ${notifPrefs[item.key]?'bg-purple-500':'bg-gray-300'}`}>
                        <div className={`w-4 h-4 bg-white rounded-full shadow transition-all ${notifPrefs[item.key]?'ml-5':'ml-1'}`}></div>
                      </button>
                    </div>
                  ))}
                </div>
              </div>

              {/* Quiet Hours */}
              <div className="bg-gradient-to-r from-gray-50 to-slate-50 rounded-2xl p-4">
                <div className="flex items-center justify-between mb-3">
                  <div className="flex items-center gap-3">
                    <i className="fa-solid fa-moon text-gray-500"></i>
                    <div>
                      <p className="font-bold text-sm">Quiet Hours</p>
                      <p className="text-xs text-gray-500">Pause notifications</p>
                    </div>
                  </div>
                  <button onClick={()=>{DB.updateNotificationPreferences(user.id,{quiet_enabled:!notifPrefs.quiet_enabled});setRefresh(r=>r+1)}} className={`w-12 h-7 rounded-full ${notifPrefs.quiet_enabled?'bg-gray-700':'bg-gray-300'}`}>
                    <div className={`w-5 h-5 bg-white rounded-full shadow transition-all ${notifPrefs.quiet_enabled?'ml-6':'ml-1'}`}></div>
                  </button>
                </div>
                {notifPrefs.quiet_enabled&&(
                  <div className="flex gap-3 mt-3">
                    <div className="flex-1">
                      <label className="text-xs text-gray-500">From</label>
                      <input type="time" value={notifPrefs.quiet_start} onChange={e=>{DB.updateNotificationPreferences(user.id,{quiet_start:e.target.value});setRefresh(r=>r+1)}} className="w-full px-3 py-2 bg-white rounded-xl text-sm outline-none"/>
                    </div>
                    <div className="flex-1">
                      <label className="text-xs text-gray-500">To</label>
                      <input type="time" value={notifPrefs.quiet_end} onChange={e=>{DB.updateNotificationPreferences(user.id,{quiet_end:e.target.value});setRefresh(r=>r+1)}} className="w-full px-3 py-2 bg-white rounded-xl text-sm outline-none"/>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        )}

        {/* History Modal */}
        {showNotifHistory&&(
          <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
            <div className="p-5 border-b flex items-center justify-between">
              <div className="flex items-center gap-4">
                <button onClick={()=>setShowNotifHistory(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
                  <i className="fa-solid fa-arrow-left text-gray-600"></i>
                </button>
                <div>
                  <h1 className="text-xl font-bold">Notification History</h1>
                  <p className="text-xs text-gray-500">{notifHistory.length} total notifications</p>
                </div>
              </div>
              {notifHistory.length>0&&(
                <button onClick={()=>{DB.clearNotificationHistory(user.id);setRefresh(r=>r+1)}} className="text-sm text-red-500 font-bold">Clear</button>
              )}
            </div>
            <div className="flex-1 overflow-y-auto">
              {notifHistory.length>0?(
                <div className="divide-y">
                  {notifHistory.map(notif=>{
                    const typeInfo=DB.notificationTypes[notif.type]||{icon:'fa-bell',color:'gray'};
                    return(
                      <div key={notif.id} className="p-4 flex gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center shrink-0 ${typeInfo.color==='green'?'bg-green-100 text-green-600':typeInfo.color==='red'?'bg-red-100 text-red-600':typeInfo.color==='blue'?'bg-blue-100 text-blue-600':typeInfo.color==='yellow'?'bg-yellow-100 text-yellow-600':'bg-gray-100 text-gray-600'}`}>
                          <i className={`fa-solid ${typeInfo.icon}`}></i>
                        </div>
                        <div className="flex-1 min-w-0">
                          <p className="font-medium text-sm">{notif.title}</p>
                          <p className="text-xs text-gray-500">{notif.message}</p>
                          <p className="text-[10px] text-gray-400 mt-1">{new Date(notif.createdAt).toLocaleString()}</p>
                        </div>
                      </div>
                    );
                  })}
                </div>
              ):(
                <div className="flex flex-col items-center justify-center h-full text-center p-8">
                  <i className="fa-solid fa-clock-rotate-left text-5xl text-gray-200 mb-4"></i>
                  <p className="text-gray-500 font-medium">No notification history</p>
                </div>
              )}
            </div>
          </div>
        )}
      </div>
    );
  };

  // Navigation items - filtered by appSettings
  const allNavItems=[
    {id:'home',icon:'fa-house',label:'Home'},
    {id:'map',icon:'fa-map-location-dot',label:'Map'},
    {id:'bookings',icon:'fa-calendar-check',label:'Bookings'},
    {id:'favorites',icon:'fa-heart',label:'Favorites'},
    {id:'profile',icon:'fa-user',label:'Profile'}
  ];
  const navItems=allNavItems.filter(n=>appSettings.customerNav?.[n.id]!==false);

  return(
    <div className="relative flex-1 overflow-y-auto bg-gray-50 h-full">
      {tab==='home'&&renderHome()}
      {tab==='map'&&renderMap()}
      {tab==='bookings'&&renderBookings()}
      {tab==='favorites'&&renderFavorites()}
      {tab==='profile'&&renderProfile()}

      {/* Bottom Nav - Compact & Glassy */}
      <div className="fixed bottom-3 left-1/2 -translate-x-1/2 w-[88%] max-w-sm z-50">
        <div className="glass-nav rounded-2xl px-1 py-1.5 flex justify-around items-center">
          {navItems.map(item=>(
            <button key={item.id} onClick={()=>setTab(item.id)} className={`flex flex-col items-center justify-center px-3 py-1.5 rounded-xl transition-all ${tab===item.id?'bg-white/15 text-white':'text-gray-400'}`}>
              <i className={`fa-solid ${item.icon} text-[13px]`}></i>
              <span className="text-[9px] font-medium mt-0.5">{item.label}</span>
            </button>
          ))}
        </div>
      </div>

      {/* Provider Profile */}
      {selectedProvider&&!bookingProvider&&(
        <ProviderProfile provider={selectedProvider} onClose={()=>setSelectedProvider(null)} onBook={()=>{setBookingProvider(selectedProvider);setSelectedProvider(null)}}/>
      )}

      {/* Booking Drawer */}
      <BookingDrawer provider={bookingProvider} onClose={()=>setBookingProvider(null)}/>

      {/* Modals */}
      <FiltersModal/>
      <WalletModal/>
      <OffersModal/>
      <EditProfileModal/>
      
      {/* Plan H: Account Modals */}
      <ChangePasswordModal/>
      <ForgotPasswordModal/>
      <OTPVerifyModal/>
      <DeleteAccountModal/>
      
      {/* Bonus Feature Modals */}
      <LanguageModal/>
      <MembershipModal/>
      <GiftCardsModal/>
      <LiveTrackingModal/>
      
      {/* Chat System */}
      {showChat&&!activeChat&&<ChatList/>}
      {activeChat&&<ChatWindow/>}
      
      {/* Notifications */}
      <NotificationsPanel/>
    </div>
  )
};

// PROFESSIONAL APP - Premium 2025 UI (Complete 7 Modules)
const ProfessionalApp=({user,onLogout})=>{
  const[tab,setTab]=useState('dashboard');
  const[refresh,setRefresh]=useState(0);
  const[editProfile,setEditProfile]=useState(false);
  const[editService,setEditService]=useState(null);
  const[showWithdraw,setShowWithdraw]=useState(false);
  const[showProChat,setShowProChat]=useState(false);
  const[activeProChat,setActiveProChat]=useState(null);
  const[proChatMessage,setProChatMessage]=useState('');
  const[showBlockModal,setShowBlockModal]=useState(false);
  const[showProNotifications,setShowProNotifications]=useState(false);
  const[bookingFilter,setBookingFilter]=useState('all');
  const[newServiceName,setNewServiceName]=useState('');
  const[newServicePrice,setNewServicePrice]=useState('');
  const[newServiceDuration,setNewServiceDuration]=useState('30');
  const toast=useToast();
  const appSettings=useAppSettings();
  
  // Data
  const provider=DB.getProviderByUserId(user.id);
  const bookings=provider?DB.getBookingsByProvider(provider.id):[];
  const categories=DB.getCategories();
  const allServices=DB.getServices();
  
  // Provider services (can add custom pricing)
  const[providerServices,setProviderServices]=useState(provider?.services||[]);

  // Not approved screens
  if(!provider)return(
    <div className="flex-1 flex items-center justify-center p-8 bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50">
      <div className="text-center anim-scale">
        <div className="w-24 h-24 gradient-warning rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-lg">
          <i className="fa-solid fa-circle-exclamation text-4xl text-white"></i>
        </div>
        <h2 className="text-2xl font-bold mb-2">Profile Not Found</h2>
        <p className="text-gray-500 mb-6">Your business profile could not be found</p>
        <button onClick={onLogout} className="btn-secondary px-8 py-3 rounded-2xl font-bold">Go Back</button>
      </div>
    </div>
  );

  if(provider.status==='pending')return(
    <div className="flex-1 flex items-center justify-center p-8 bg-gradient-to-br from-yellow-50 via-orange-50 to-pink-50">
      <div className="text-center anim-scale">
        <div className="w-24 h-24 gradient-warning rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-lg anim-float">
          <i className="fa-solid fa-clock text-4xl text-white"></i>
        </div>
        <h2 className="text-2xl font-bold mb-2">Approval Pending</h2>
        <p className="text-gray-500 mb-2">Your account is under review</p>
        <p className="text-sm text-gray-400 mb-6">This usually takes 24-48 hours</p>
        <button onClick={onLogout} className="btn-secondary px-8 py-3 rounded-2xl font-bold">
          <i className="fa-solid fa-right-from-bracket mr-2"></i>Log Out
        </button>
      </div>
    </div>
  );

  // Stats
  const stats={
    totalBookings:bookings.length,
    pendingBookings:bookings.filter(b=>b.status==='pending').length,
    confirmedBookings:bookings.filter(b=>b.status==='confirmed').length,
    completedBookings:bookings.filter(b=>b.status==='completed').length,
    cancelledBookings:bookings.filter(b=>b.status==='cancelled').length,
    totalEarnings:bookings.filter(b=>b.status==='completed').reduce((s,b)=>s+(b.price||0),0),
    thisMonthEarnings:bookings.filter(b=>b.status==='completed'&&new Date(b.createdAt).getMonth()===new Date().getMonth()).reduce((s,b)=>s+(b.price||0),0),
    avgRating:provider.rating||0,
    totalReviews:provider.reviewCount||0
  };

  const handleBookingAction=(id,action)=>{
    DB.updateBooking(id,{status:action});
    toast.show(`Booking ${action}!`,'success');
    setRefresh(r=>r+1);
  };

  // MODULE 14: Dashboard
  const renderDashboard=()=>(
    <div className="p-5 pb-32 anim-fade">
      {/* Header */}
      <div className="flex items-center justify-between mb-6">
        <div>
          <p className="text-gray-500 text-sm font-medium">Welcome back ðŸ‘‹</p>
          <h1 className="text-2xl font-bold">{provider.businessName}</h1>
        </div>
        <div className="flex items-center gap-3">
          <button onClick={()=>setShowProChat(true)} className="w-11 h-11 rounded-2xl bg-white border shadow-sm flex items-center justify-center relative">
            <i className="fa-solid fa-comments text-gray-600"></i>
            {DB.getProviderUnreadCount(provider.id)>0&&<span className="absolute -top-1 -right-1 w-5 h-5 bg-purple-500 text-white text-xs rounded-full flex items-center justify-center">{DB.getProviderUnreadCount(provider.id)}</span>}
          </button>
          <button onClick={()=>setShowProNotifications(true)} className="w-11 h-11 rounded-2xl bg-white border shadow-sm flex items-center justify-center relative">
            <i className="fa-solid fa-bell text-gray-600"></i>
            {DB.getUnreadNotificationCount(null,provider.id)>0&&<span className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">{DB.getUnreadNotificationCount(null,provider.id)}</span>}
          </button>
          <div className="w-11 h-11 rounded-2xl overflow-hidden border-2 border-pink-200">
            <img src={provider.image} className="w-full h-full object-cover"/>
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-2 gap-4 mb-6">
        <div className="gradient-primary rounded-3xl p-5 text-white relative overflow-hidden">
          <div className="absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"></div>
          <i className="fa-solid fa-euro-sign text-2xl mb-3 opacity-80"></i>
          <p className="text-3xl font-bold">â‚¬{stats.totalEarnings}</p>
          <p className="text-sm opacity-80 mt-1">Total Earnings</p>
        </div>
        <div className="bg-white rounded-3xl p-5 border shadow-sm">
          <i className="fa-solid fa-calendar-check text-2xl mb-3 text-pink-500"></i>
          <p className="text-3xl font-bold">{stats.totalBookings}</p>
          <p className="text-sm text-gray-500 mt-1">Total Bookings</p>
        </div>
        <div className="bg-white rounded-3xl p-5 border shadow-sm">
          <i className="fa-solid fa-star text-2xl mb-3 text-yellow-500"></i>
          <p className="text-3xl font-bold">{stats.avgRating||'New'}</p>
          <p className="text-sm text-gray-500 mt-1">{stats.totalReviews} Reviews</p>
        </div>
        <div className="bg-white rounded-3xl p-5 border shadow-sm">
          <i className="fa-solid fa-clock text-2xl mb-3 text-orange-500"></i>
          <p className="text-3xl font-bold">{stats.pendingBookings}</p>
          <p className="text-sm text-gray-500 mt-1">Pending</p>
        </div>
      </div>

      {/* Quick Stats Bar */}
      <div className="bg-white rounded-2xl p-4 border shadow-sm mb-6">
        <div className="flex justify-between items-center text-sm">
          <div className="text-center flex-1">
            <p className="font-bold text-green-600">{stats.completedBookings}</p>
            <p className="text-xs text-gray-400">Completed</p>
          </div>
          <div className="w-px h-8 bg-gray-200"></div>
          <div className="text-center flex-1">
            <p className="font-bold text-blue-600">{stats.confirmedBookings}</p>
            <p className="text-xs text-gray-400">Confirmed</p>
          </div>
          <div className="w-px h-8 bg-gray-200"></div>
          <div className="text-center flex-1">
            <p className="font-bold text-red-600">{stats.cancelledBookings}</p>
            <p className="text-xs text-gray-400">Cancelled</p>
          </div>
        </div>
      </div>

      {/* Pending Bookings */}
      <div className="flex justify-between items-center mb-4">
        <h2 className="text-lg font-bold">Pending Requests</h2>
        {stats.pendingBookings>0&&<span className="bg-orange-100 text-orange-600 text-xs font-bold px-3 py-1 rounded-full">{stats.pendingBookings} new</span>}
      </div>

      {bookings.filter(b=>b.status==='pending').length>0?(
        <div className="space-y-4">
          {bookings.filter(b=>b.status==='pending').slice(0,5).map(b=>{
            const customer=DB.getUserById(b.userId);
            return(
              <div key={b.id} className="bg-white rounded-3xl p-5 border shadow-sm anim-scale">
                <div className="flex items-start gap-4">
                  <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center shrink-0">
                    <i className="fa-solid fa-user text-pink-500"></i>
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="flex justify-between items-start">
                      <div>
                        <p className="font-bold">{customer?.name||'Customer'}</p>
                        <p className="text-sm text-gray-500">{b.serviceName}</p>
                      </div>
                      <span className="font-bold text-pink-600">â‚¬{b.price}</span>
                    </div>
                    <div className="flex items-center gap-4 mt-2 text-xs text-gray-400">
                      <span><i className="fa-solid fa-calendar mr-1"></i>{b.date}</span>
                      <span><i className="fa-solid fa-clock mr-1"></i>{b.time}</span>
                    </div>
                  </div>
                </div>
                <div className="flex gap-3 mt-4">
                  <button onClick={()=>handleBookingAction(b.id,'confirmed')} className="flex-1 py-3 gradient-success text-white rounded-2xl font-bold text-sm flex items-center justify-center gap-2">
                    <i className="fa-solid fa-check"></i>Accept
                  </button>
                  <button onClick={()=>handleBookingAction(b.id,'cancelled')} className="flex-1 py-3 bg-red-50 text-red-500 rounded-2xl font-bold text-sm flex items-center justify-center gap-2">
                    <i className="fa-solid fa-times"></i>Decline
                  </button>
                </div>
              </div>
            )
          })}
        </div>
      ):(
        <div className="bg-gradient-to-br from-green-50 to-emerald-50 rounded-3xl p-8 text-center border border-green-100">
          <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i className="fa-solid fa-check text-2xl text-green-500"></i>
          </div>
          <p className="font-bold text-green-700">All caught up!</p>
          <p className="text-sm text-green-600 mt-1">No pending bookings</p>
        </div>
      )}

      {/* Today's Schedule */}
      <h2 className="text-lg font-bold mt-8 mb-4">Today's Schedule</h2>
      {bookings.filter(b=>b.status==='confirmed'&&b.date===new Date().toISOString().split('T')[0]).length>0?(
        <div className="space-y-3">
          {bookings.filter(b=>b.status==='confirmed'&&b.date===new Date().toISOString().split('T')[0]).map(b=>{
            const customer=DB.getUserById(b.userId);
            return(
              <div key={b.id} className="bg-white rounded-2xl p-4 border shadow-sm flex items-center gap-4">
                <div className="bg-blue-100 text-blue-600 px-3 py-2 rounded-xl text-center">
                  <p className="text-xs font-bold">{b.time}</p>
                </div>
                <div className="flex-1">
                  <p className="font-bold text-sm">{customer?.name||'Customer'}</p>
                  <p className="text-xs text-gray-500">{b.serviceName}</p>
                </div>
                <button onClick={()=>handleBookingAction(b.id,'completed')} className="text-xs font-bold text-green-600 bg-green-50 px-3 py-2 rounded-xl">
                  Complete
                </button>
              </div>
            )
          })}
        </div>
      ):(
        <div className="bg-gray-50 rounded-2xl p-6 text-center">
          <i className="fa-solid fa-calendar-day text-3xl text-gray-300 mb-2"></i>
          <p className="text-gray-500 text-sm">No appointments today</p>
        </div>
      )}
    </div>
  );

  // MODULE 15: Booking Management
  const renderBookings=()=>{
    const filtered=bookingFilter==='all'?bookings:bookings.filter(b=>b.status===bookingFilter);
    
    return(
      <div className="p-5 pb-32 anim-fade">
        <h1 className="text-2xl font-bold mb-6">Bookings</h1>
        
        {/* Filter Tabs */}
        <div className="flex gap-2 overflow-x-auto pb-4 mb-4">
          {[{id:'all',label:'All'},{id:'pending',label:'Pending'},{id:'confirmed',label:'Confirmed'},{id:'completed',label:'Completed'},{id:'cancelled',label:'Cancelled'}].map(f=>(
            <button key={f.id} onClick={()=>setBookingFilter(f.id)} className={`shrink-0 px-4 py-2 rounded-xl text-sm font-bold ${bookingFilter===f.id?'gradient-primary text-white':'bg-white border text-gray-600'}`}>
              {f.label} {f.id!=='all'&&<span className="ml-1">({bookings.filter(b=>b.status===f.id).length})</span>}
            </button>
          ))}
        </div>

        {/* Calendar View Button */}
        <div className="bg-white rounded-2xl p-4 border shadow-sm mb-4 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="w-10 h-10 bg-pink-100 rounded-xl flex items-center justify-center">
              <i className="fa-solid fa-calendar text-pink-500"></i>
            </div>
            <div>
              <p className="font-bold text-sm">{new Date().toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'})}</p>
              <p className="text-xs text-gray-500">{filtered.length} bookings</p>
            </div>
          </div>
          <button className="text-pink-500 text-sm font-bold">View Calendar</button>
        </div>

        {/* Bookings List */}
        {filtered.length>0?(
          <div className="space-y-4">
            {filtered.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt)).map(b=>{
              const customer=DB.getUserById(b.userId);
              const statusColors={pending:'bg-yellow-100 text-yellow-700',confirmed:'bg-blue-100 text-blue-700',completed:'bg-green-100 text-green-700',cancelled:'bg-red-100 text-red-700'};
              return(
                <div key={b.id} className="bg-white rounded-3xl p-5 border shadow-sm">
                  <div className="flex justify-between items-start mb-3">
                    <div className="flex items-center gap-3">
                      <div className="w-11 h-11 rounded-2xl bg-gray-100 flex items-center justify-center">
                        <i className="fa-solid fa-user text-gray-400"></i>
                      </div>
                      <div>
                        <p className="font-bold">{customer?.name||'Customer'}</p>
                        <p className="text-xs text-gray-500">{customer?.phone||'N/A'}</p>
                      </div>
                    </div>
                    <span className={`text-xs font-bold px-3 py-1 rounded-full ${statusColors[b.status]||'bg-gray-100'}`}>{b.status}</span>
                  </div>
                  
                  <div className="bg-gray-50 rounded-2xl p-3 mb-3">
                    <p className="font-bold text-sm">{b.serviceName}</p>
                    <div className="flex items-center gap-4 mt-2 text-xs text-gray-500">
                      <span><i className="fa-solid fa-calendar mr-1"></i>{b.date}</span>
                      <span><i className="fa-solid fa-clock mr-1"></i>{b.time}</span>
                      <span className="font-bold text-pink-600">â‚¬{b.price}</span>
                    </div>
                  </div>

                  {b.status==='pending'&&(
                    <div className="flex gap-2">
                      <button onClick={()=>handleBookingAction(b.id,'confirmed')} className="flex-1 py-2.5 gradient-success text-white rounded-xl font-bold text-sm">Accept</button>
                      <button onClick={()=>handleBookingAction(b.id,'cancelled')} className="flex-1 py-2.5 bg-red-50 text-red-500 rounded-xl font-bold text-sm">Decline</button>
                    </div>
                  )}
                  {b.status==='confirmed'&&(
                    <button onClick={()=>handleBookingAction(b.id,'completed')} className="w-full py-2.5 gradient-success text-white rounded-xl font-bold text-sm">
                      <i className="fa-solid fa-check mr-2"></i>Mark as Completed
                    </button>
                  )}
                </div>
              )
            })}
          </div>
        ):(
          <EmptyState 
            icon="fa-calendar-xmark" 
            title="No bookings yet" 
            description="When customers book your services, they'll appear here"
          />
        )}
      </div>
    );
  };

  // MODULE 17: Services & Pricing
  const renderServices=()=>{
    const myCategory=categories.find(c=>c.id===provider.categoryId);
    const categoryServices=allServices.filter(s=>s.categoryId===provider.categoryId);
    
    return(
      <div className="p-5 pb-32 anim-fade">
        <div className="flex justify-between items-center mb-6">
          <h1 className="text-2xl font-bold">My Services</h1>
          <button onClick={()=>setEditService({})} className="w-10 h-10 gradient-primary rounded-xl flex items-center justify-center text-white shadow-lg">
            <i className="fa-solid fa-plus"></i>
          </button>
        </div>

        {/* Category Info */}
        <div className="bg-gradient-to-r from-pink-50 to-purple-50 rounded-2xl p-4 border border-pink-100 mb-6">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 gradient-primary rounded-xl flex items-center justify-center">
              <i className={`fa-solid fa-${myCategory?.icon||'spa'} text-white text-lg`}></i>
            </div>
            <div>
              <p className="font-bold">{myCategory?.name||'Your Category'}</p>
              <p className="text-sm text-gray-500">{categoryServices.length} services available</p>
            </div>
          </div>
        </div>

        {/* Services List */}
        <h2 className="font-bold mb-4">Available Services</h2>
        <div className="space-y-3">
          {categoryServices.map(srv=>(
            <div key={srv.id} className="bg-white rounded-2xl p-4 border shadow-sm flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
                  <i className="fa-solid fa-concierge-bell text-gray-400"></i>
                </div>
                <div>
                  <p className="font-bold text-sm">{srv.name}</p>
                  <p className="text-xs text-gray-500">{srv.duration} min</p>
                </div>
              </div>
              <div className="text-right">
                <p className="font-bold text-pink-600">â‚¬{srv.basePrice}</p>
                <button className="text-xs text-gray-400">Edit Price</button>
              </div>
            </div>
          ))}
        </div>

        {categoryServices.length===0&&(
          <div className="text-center py-12 bg-gray-50 rounded-2xl">
            <i className="fa-solid fa-concierge-bell text-4xl text-gray-300 mb-3"></i>
            <p className="text-gray-500">No services in your category</p>
          </div>
        )}
        
        {/* Add Service Modal */}
        {editService&&(
          <div className="fixed inset-0 z-50 flex items-end justify-center">
            <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={()=>setEditService(null)}></div>
            <div className="w-full max-w-md bg-white rounded-t-[32px] p-6 anim-slide-up relative z-50">
              <div className="w-12 h-1.5 bg-gray-300 rounded-full mx-auto mb-6"></div>
              <h2 className="text-xl font-bold mb-6">Add New Service</h2>
              
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Service Name</label>
                  <input type="text" value={newServiceName} onChange={e=>setNewServiceName(e.target.value)} placeholder="e.g., Special Massage" className="w-full p-4 bg-gray-50 rounded-2xl outline-none text-sm"/>
                </div>
                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Price (â‚¬)</label>
                    <input type="number" value={newServicePrice} onChange={e=>setNewServicePrice(e.target.value)} placeholder="50" className="w-full p-4 bg-gray-50 rounded-2xl outline-none text-sm"/>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Duration (mins)</label>
                    <input type="number" value={newServiceDuration} onChange={e=>setNewServiceDuration(e.target.value)} placeholder="60" className="w-full p-4 bg-gray-50 rounded-2xl outline-none text-sm"/>
                  </div>
                </div>
                
                <div className="bg-blue-50 rounded-xl p-3">
                  <p className="text-xs text-blue-600"><i className="fa-solid fa-info-circle mr-1"></i>This service will be added to your category: <b>{myCategory?.name}</b></p>
                </div>
              </div>
              
              <div className="flex gap-3 mt-6">
                <button onClick={()=>setEditService(null)} className="flex-1 py-4 bg-gray-100 rounded-2xl font-bold text-gray-600">Cancel</button>
                <button onClick={()=>{
                  if(!newServiceName||!newServicePrice){toast.show('Fill all fields','warning');return}
                  const newSrv={id:'srv_'+Date.now(),name:newServiceName,categoryId:provider.categoryId,basePrice:Number(newServicePrice),duration:Number(newServiceDuration)||30};
                  const srvs=[...allServices,newSrv];
                  localStorage.setItem('gb_services',JSON.stringify(srvs));
                  toast.show('Service added! ðŸŽ‰','success');
                  setNewServiceName('');setNewServicePrice('');setNewServiceDuration('30');
                  setEditService(null);setRefresh(r=>r+1);
                }} className="flex-1 py-4 gradient-primary text-white rounded-2xl font-bold">Add Service</button>
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  // MODULE 18: Earnings & Wallet
  const renderEarnings=()=>(
    <div className="p-5 pb-32 anim-fade">
      <h1 className="text-2xl font-bold mb-6">Earnings</h1>

      {/* Balance Card */}
      <div className="gradient-dark rounded-3xl p-6 text-white mb-6 relative overflow-hidden">
        <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/2"></div>
        <p className="text-sm opacity-70 mb-2">Available Balance</p>
        <p className="text-4xl font-bold mb-4">â‚¬{stats.totalEarnings}</p>
        <div className="flex gap-3">
          <button onClick={()=>setShowWithdraw(true)} className="flex-1 py-3 bg-white text-gray-900 rounded-2xl font-bold text-sm flex items-center justify-center gap-2">
            <i className="fa-solid fa-arrow-up-from-bracket"></i>Withdraw
          </button>
          <button className="px-4 py-3 bg-white/20 rounded-2xl">
            <i className="fa-solid fa-ellipsis"></i>
          </button>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-2 gap-4 mb-6">
        <div className="bg-white rounded-2xl p-4 border shadow-sm">
          <p className="text-xs text-gray-500 mb-1">This Month</p>
          <p className="text-xl font-bold">â‚¬{stats.thisMonthEarnings}</p>
        </div>
        <div className="bg-white rounded-2xl p-4 border shadow-sm">
          <p className="text-xs text-gray-500 mb-1">Commission (15%)</p>
          <p className="text-xl font-bold text-red-500">-â‚¬{Math.round(stats.totalEarnings*0.15)}</p>
        </div>
      </div>

      {/* Transactions */}
      <h2 className="font-bold mb-4">Recent Transactions</h2>
      {bookings.filter(b=>b.status==='completed').length>0?(
        <div className="space-y-3">
          {bookings.filter(b=>b.status==='completed').slice(0,10).map(b=>{
            const customer=DB.getUserById(b.userId);
            return(
              <div key={b.id} className="bg-white rounded-2xl p-4 border shadow-sm flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
                    <i className="fa-solid fa-arrow-down text-green-500"></i>
                  </div>
                  <div>
                    <p className="font-bold text-sm">{customer?.name||'Customer'}</p>
                    <p className="text-xs text-gray-500">{b.serviceName}</p>
                  </div>
                </div>
                <div className="text-right">
                  <p className="font-bold text-green-600">+â‚¬{b.price}</p>
                  <p className="text-xs text-gray-400">{new Date(b.createdAt).toLocaleDateString()}</p>
                </div>
              </div>
            )
          })}
        </div>
      ):(
        <div className="text-center py-12 bg-gray-50 rounded-2xl">
          <i className="fa-solid fa-receipt text-4xl text-gray-300 mb-3"></i>
          <p className="text-gray-500">No transactions yet</p>
        </div>
      )}

      {/* Withdraw Modal */}
      {showWithdraw&&(
        <div className="fixed inset-0 z-50 flex items-end justify-center">
          <div className="absolute inset-0 bg-black/50 backdrop-blur-sm" onClick={()=>setShowWithdraw(false)}></div>
          <div className="relative bg-white rounded-t-[32px] p-6 w-full max-w-md anim-slide-up">
            <div className="w-12 h-1.5 bg-gray-300 rounded-full mx-auto mb-6"></div>
            <h2 className="text-xl font-bold mb-4">Withdraw Funds</h2>
            <div className="bg-gray-50 rounded-2xl p-4 mb-4">
              <p className="text-sm text-gray-500 mb-1">Available</p>
              <p className="text-2xl font-bold">â‚¬{stats.totalEarnings}</p>
            </div>
            <input type="number" placeholder="Enter amount" className="w-full px-4 py-4 bg-gray-100 rounded-2xl font-bold text-lg mb-4 outline-none focus:ring-2 ring-pink-200"/>
            <input type="text" placeholder="Bank Account / IBAN" className="w-full px-4 py-4 bg-gray-100 rounded-2xl mb-4 outline-none focus:ring-2 ring-pink-200"/>
            <button onClick={()=>{toast.show('Withdrawal request submitted!','success');setShowWithdraw(false)}} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold">
              Request Withdrawal
            </button>
          </div>
        </div>
      )}
    </div>
  );

  // MODULE 19: Availability Settings  
  const renderAvailability=()=>{
    const[workDays,setWorkDays]=useState(['mon','tue','wed','thu','fri']);
    const[startTime,setStartTime]=useState('09:00');
    const[endTime,setEndTime]=useState('18:00');
    const[updatingLocation,setUpdatingLocation]=useState(false);
    const days=[{id:'mon',label:'Mon'},{id:'tue',label:'Tue'},{id:'wed',label:'Wed'},{id:'thu',label:'Thu'},{id:'fri',label:'Fri'},{id:'sat',label:'Sat'},{id:'sun',label:'Sun'}];

    const updateMyLocation=async()=>{
      if(!navigator.geolocation){toast.show('GPS not available','error');return}
      setUpdatingLocation(true);
      try{
        const pos=await new Promise((resolve,reject)=>{
          navigator.geolocation.getCurrentPosition(resolve,reject,{timeout:10000,enableHighAccuracy:true});
        });
        DB.updateProvider(provider.id,{lat:pos.coords.latitude,lng:pos.coords.longitude});
        toast.show('Location updated! Map will show your exact position ðŸ“','success');
        setRefresh(r=>r+1);
      }catch(e){
        toast.show('Could not get location. Please enable GPS.','error');
      }
      setUpdatingLocation(false);
    };

    return(
      <div className="p-5 pb-32 anim-fade">
        <h1 className="text-2xl font-bold mb-6">Availability</h1>

        {/* Location Setting */}
        <div className="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-3xl p-5 border border-blue-100 mb-4">
          <div className="flex items-center gap-4 mb-3">
            <div className="w-12 h-12 bg-blue-500 rounded-2xl flex items-center justify-center">
              <i className="fa-solid fa-location-crosshairs text-white text-xl"></i>
            </div>
            <div className="flex-1">
              <h3 className="font-bold">My Location</h3>
              <p className="text-xs text-gray-500">Update your business location on map</p>
            </div>
          </div>
          <div className="bg-white rounded-2xl p-3 mb-3">
            <p className="text-sm text-gray-600"><i className="fa-solid fa-map-marker-alt text-pink-500 mr-2"></i>{provider.address}</p>
            <p className="text-xs text-gray-400 mt-1">Lat: {provider.lat?.toFixed(4)}, Lng: {provider.lng?.toFixed(4)}</p>
          </div>
          <button onClick={updateMyLocation} disabled={updatingLocation} className="w-full py-3 bg-blue-500 text-white rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50">
            {updatingLocation?<><div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full spinner"></div>Getting location...</>:<><i className="fa-solid fa-crosshairs"></i>Update My GPS Location</>}
          </button>
        </div>

        {/* Working Days */}
        <div className="bg-white rounded-3xl p-5 border shadow-sm mb-4">
          <h3 className="font-bold mb-4">Working Days</h3>
          <div className="flex gap-2">
            {days.map(d=>(
              <button key={d.id} onClick={()=>setWorkDays(prev=>prev.includes(d.id)?prev.filter(x=>x!==d.id):[...prev,d.id])} className={`flex-1 py-3 rounded-xl text-sm font-bold ${workDays.includes(d.id)?'gradient-primary text-white':'bg-gray-100 text-gray-500'}`}>
                {d.label}
              </button>
            ))}
          </div>
        </div>

        {/* Working Hours */}
        <div className="bg-white rounded-3xl p-5 border shadow-sm mb-4">
          <h3 className="font-bold mb-4">Working Hours</h3>
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="text-xs text-gray-500 mb-2 block">Start Time</label>
              <input type="time" value={startTime} onChange={e=>setStartTime(e.target.value)} className="w-full px-4 py-3 bg-gray-100 rounded-xl font-bold outline-none"/>
            </div>
            <div>
              <label className="text-xs text-gray-500 mb-2 block">End Time</label>
              <input type="time" value={endTime} onChange={e=>setEndTime(e.target.value)} className="w-full px-4 py-3 bg-gray-100 rounded-xl font-bold outline-none"/>
            </div>
          </div>
        </div>

        {/* PLAN J Module 61: Time Slot Blocking */}
        <div className="bg-gradient-to-r from-red-50 to-orange-50 rounded-3xl p-5 border border-red-100 mb-4">
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 bg-red-500 rounded-2xl flex items-center justify-center">
                <i className="fa-solid fa-ban text-white text-xl"></i>
              </div>
              <div>
                <h3 className="font-bold">Block Time Slots</h3>
                <p className="text-xs text-gray-500">Mark times as unavailable</p>
              </div>
            </div>
            <button onClick={()=>setShowBlockModal(true)} className="px-4 py-2 bg-red-500 text-white rounded-xl text-sm font-bold">
              <i className="fa-solid fa-plus mr-1"></i>Block
            </button>
          </div>

          {/* Blocked Slots List */}
          {DB.getBlockedSlots(provider.id).length>0?(
            <div className="space-y-2">
              {DB.getBlockedSlots(provider.id).slice(0,5).map(block=>(
                <div key={block.id} className="bg-white rounded-xl p-3 flex items-center justify-between">
                  <div>
                    <p className="text-sm font-medium">{block.date}</p>
                    <p className="text-xs text-gray-500">{block.startTime==='00:00'&&block.endTime==='23:59'?'Full Day':block.startTime+' - '+block.endTime}</p>
                    {block.reason&&<p className="text-xs text-gray-400 mt-0.5">{block.reason}</p>}
                  </div>
                  <button onClick={()=>{DB.unblockTimeSlot(block.id);toast.show('Slot unblocked');setRefresh(r=>r+1)}} className="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center text-gray-500 hover:bg-red-100 hover:text-red-500">
                    <i className="fa-solid fa-trash text-xs"></i>
                  </button>
                </div>
              ))}
            </div>
          ):(
            <p className="text-sm text-gray-500 text-center py-4">No blocked slots</p>
          )}
        </div>

        {/* Holidays/Leave */}
        <div className="bg-gradient-to-r from-yellow-50 to-amber-50 rounded-3xl p-5 border border-yellow-100 mb-4">
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-yellow-500 rounded-xl flex items-center justify-center">
                <i className="fa-solid fa-umbrella-beach text-white"></i>
              </div>
              <div>
                <h3 className="font-bold text-sm">Holiday / Leave</h3>
                <p className="text-xs text-gray-500">Block full days</p>
              </div>
            </div>
          </div>
          <div className="flex gap-2">
            <input type="date" id="holidayDate" min={new Date().toISOString().split('T')[0]} className="flex-1 px-4 py-3 bg-white rounded-xl text-sm outline-none border"/>
            <button onClick={()=>{
              const date=document.getElementById('holidayDate').value;
              if(!date){toast.show('Select a date','warning');return}
              DB.blockFullDay(provider.id,date,'Holiday');
              toast.show('Day blocked as holiday! ðŸ–ï¸','success');
              setRefresh(r=>r+1);
            }} className="px-4 py-3 bg-yellow-500 text-white rounded-xl font-bold text-sm">
              <i className="fa-solid fa-plus mr-1"></i>Add
            </button>
          </div>
          {/* Upcoming Holidays */}
          {DB.getProviderHolidays(provider.id).length>0&&(
            <div className="mt-3 flex gap-2 flex-wrap">
              {DB.getProviderHolidays(provider.id).map(h=>(
                <span key={h.id} className="bg-white px-3 py-1 rounded-lg text-xs font-medium flex items-center gap-2">
                  {h.date}
                  <button onClick={()=>{DB.unblockTimeSlot(h.id);setRefresh(r=>r+1)}} className="text-red-500"><i className="fa-solid fa-times"></i></button>
                </span>
              ))}
            </div>
          )}
        </div>

        {/* Slot Duration */}
        <div className="bg-white rounded-3xl p-5 border shadow-sm mb-4">
          <h3 className="font-bold mb-4">Appointment Slot Duration</h3>
          <div className="flex gap-2">
            {[30,45,60,90].map(min=>(
              <button key={min} className="flex-1 py-3 rounded-xl text-sm font-bold bg-gray-100 text-gray-600 hover:bg-pink-100 hover:text-pink-600">
                {min} min
              </button>
            ))}
          </div>
        </div>

        {/* Break Time */}
        <div className="bg-white rounded-3xl p-5 border shadow-sm mb-6">
          <div className="flex justify-between items-center">
            <div>
              <h3 className="font-bold">Break Time</h3>
              <p className="text-sm text-gray-500">Add lunch or rest breaks</p>
            </div>
            <button className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
              <i className="fa-solid fa-plus text-gray-600"></i>
            </button>
          </div>
        </div>

        <button onClick={()=>toast.show('Availability saved!','success')} className="w-full py-4 gradient-primary text-white rounded-2xl font-bold">
          Save Changes
        </button>

        {/* Block Time Modal */}
        {showBlockModal&&(
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50">
            <div className="bg-white rounded-3xl p-5 w-full max-w-sm anim-scale">
              <h3 className="text-lg font-bold mb-4">Block Time Slot</h3>
              <div className="space-y-4">
                <div>
                  <label className="text-sm font-bold mb-2 block">Date</label>
                  <input type="date" id="blockDate" min={new Date().toISOString().split('T')[0]} className="w-full px-4 py-3 bg-gray-100 rounded-xl outline-none"/>
                </div>
                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="text-sm font-bold mb-2 block">Start Time</label>
                    <input type="time" id="blockStart" defaultValue="12:00" className="w-full px-4 py-3 bg-gray-100 rounded-xl outline-none"/>
                  </div>
                  <div>
                    <label className="text-sm font-bold mb-2 block">End Time</label>
                    <input type="time" id="blockEnd" defaultValue="13:00" className="w-full px-4 py-3 bg-gray-100 rounded-xl outline-none"/>
                  </div>
                </div>
                <div>
                  <label className="text-sm font-bold mb-2 block">Reason (Optional)</label>
                  <input type="text" id="blockReason" placeholder="e.g., Lunch break" className="w-full px-4 py-3 bg-gray-100 rounded-xl outline-none"/>
                </div>
              </div>
              <div className="flex gap-3 mt-6">
                <button onClick={()=>setShowBlockModal(false)} className="flex-1 py-3 bg-gray-100 rounded-xl font-bold">Cancel</button>
                <button onClick={()=>{
                  const date=document.getElementById('blockDate').value;
                  const start=document.getElementById('blockStart').value;
                  const end=document.getElementById('blockEnd').value;
                  const reason=document.getElementById('blockReason').value;
                  if(!date){toast.show('Select a date','warning');return}
                  DB.blockTimeSlot(provider.id,date,start,end,reason);
                  toast.show('Time slot blocked! ðŸš«','success');
                  setShowBlockModal(false);
                  setRefresh(r=>r+1);
                }} className="flex-1 py-3 bg-red-500 text-white rounded-xl font-bold">Block Slot</button>
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  // MODULE 16, 20, 41, 42: Profile with Photo Upload & Gallery
  const profilePhotoRef=useRef(null);
  const coverPhotoRef=useRef(null);
  const galleryPhotoRef=useRef(null);
  const[showGalleryModal,setShowGalleryModal]=useState(false);
  const[uploadingPhoto,setUploadingPhoto]=useState(null);

  const handleProPhotoUpload=async(e,type)=>{
    const file=e.target.files?.[0];
    if(!file)return;
    if(file.size>5*1024*1024){toast.show('Image too large (max 5MB)','error');return}
    setUploadingPhoto(type);
    const result=await DB.updateProviderPhoto(provider.id,file,type);
    if(result.success){
      toast.show(`${type==='cover'?'Cover':'Profile'} photo updated! ðŸ“¸`,'success');
      setRefresh(r=>r+1);
    }else{
      toast.show('Upload failed','error');
    }
    setUploadingPhoto(null);
  };

  const handleGalleryUpload=async(e)=>{
    const file=e.target.files?.[0];
    if(!file)return;
    if(file.size>5*1024*1024){toast.show('Image too large (max 5MB)','error');return}
    setUploadingPhoto('gallery');
    const result=await DB.addToGallery(provider.id,file);
    if(result.success){
      toast.show('Photo added to gallery! ðŸ–¼ï¸','success');
      setRefresh(r=>r+1);
    }else{
      toast.show('Upload failed','error');
    }
    setUploadingPhoto(null);
  };

  const renderProfile=()=>{
    const cat=categories.find(c=>c.id===provider.categoryId);
    const gallery=DB.getProviderGallery(provider.id);
    
    return(
      <div className="pb-32 anim-fade">
        {/* Cover & Avatar */}
        <div className="relative">
          <div className="h-40 overflow-hidden">
            <img src={provider.coverImage} className="w-full h-full object-cover"/>
            <div className="absolute inset-0 bg-gradient-to-b from-black/20 to-black/60"></div>
          </div>
          {/* Change Cover Button */}
          <button onClick={()=>coverPhotoRef.current?.click()} disabled={uploadingPhoto==='cover'} className="absolute top-4 right-4 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-xl flex items-center gap-2 text-white text-sm font-medium disabled:opacity-50">
            {uploadingPhoto==='cover'?<div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full spinner"></div>:<i className="fa-solid fa-camera"></i>}
            {uploadingPhoto==='cover'?'Uploading...':'Change Cover'}
          </button>
          <input ref={coverPhotoRef} type="file" accept="image/*" onChange={e=>handleProPhotoUpload(e,'cover')} className="hidden"/>
          
          {/* Profile Photo */}
          <div className="absolute -bottom-12 left-5">
            <div className="relative">
              <div className="w-24 h-24 rounded-3xl overflow-hidden border-4 border-white shadow-xl">
                <img src={provider.image} className="w-full h-full object-cover"/>
              </div>
              <button onClick={()=>profilePhotoRef.current?.click()} disabled={uploadingPhoto==='profile'} className="absolute -bottom-1 -right-1 w-8 h-8 bg-pink-500 rounded-full shadow-lg flex items-center justify-center text-white disabled:opacity-50">
                {uploadingPhoto==='profile'?<div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full spinner"></div>:<i className="fa-solid fa-camera text-xs"></i>}
              </button>
              <input ref={profilePhotoRef} type="file" accept="image/*" onChange={e=>handleProPhotoUpload(e,'profile')} className="hidden"/>
            </div>
          </div>
        </div>

        <div className="px-5 pt-16">
          {/* Name & Status */}
          <div className="flex items-start justify-between mb-6">
            <div>
              <div className="flex items-center gap-2">
                <h1 className="text-2xl font-bold">{provider.businessName}</h1>
                {provider.verified&&<i className="fa-solid fa-badge-check text-blue-500"></i>}
              </div>
              <p className="text-gray-500">{cat?.name}</p>
            </div>
            <span className={`px-3 py-1 rounded-full text-xs font-bold ${provider.status==='approved'?'bg-green-100 text-green-600':'bg-yellow-100 text-yellow-600'}`}>
              {provider.status}
            </span>
          </div>

          {/* Gallery Section */}
          <div className="mb-6">
            <div className="flex justify-between items-center mb-4">
              <h2 className="font-bold">Gallery ({gallery.length}/20)</h2>
              <button onClick={()=>setShowGalleryModal(true)} className="text-pink-500 text-sm font-bold">View All</button>
            </div>
            <div className="flex gap-3 overflow-x-auto pb-2 no-scrollbar">
              {/* Add Photo Button */}
              <button onClick={()=>galleryPhotoRef.current?.click()} disabled={uploadingPhoto==='gallery'||gallery.length>=20} className="w-20 h-20 shrink-0 rounded-2xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center text-gray-400 disabled:opacity-50">
                {uploadingPhoto==='gallery'?<div className="w-5 h-5 border-2 border-gray-300 border-t-pink-500 rounded-full spinner"></div>:<><i className="fa-solid fa-plus text-lg"></i><span className="text-[10px] mt-1">Add</span></>}
              </button>
              <input ref={galleryPhotoRef} type="file" accept="image/*" onChange={handleGalleryUpload} className="hidden"/>
              
              {/* Gallery Images */}
              {gallery.slice(0,5).map(img=>(
                <div key={img.id} className="w-20 h-20 shrink-0 rounded-2xl overflow-hidden">
                  <img src={img.url} className="w-full h-full object-cover"/>
                </div>
              ))}
              {gallery.length===0&&<p className="text-sm text-gray-400 py-6">No photos yet. Add your work samples!</p>}
            </div>
          </div>

          {/* Analytics Cards */}
          <h2 className="font-bold mb-4">Performance</h2>
          <div className="grid grid-cols-3 gap-3 mb-6">
            <div className="bg-white rounded-2xl p-4 border text-center">
              <i className="fa-solid fa-eye text-xl text-blue-500 mb-2"></i>
              <p className="text-lg font-bold">{Math.floor(Math.random()*1000)}</p>
              <p className="text-xs text-gray-500">Views</p>
            </div>
            <div className="bg-white rounded-2xl p-4 border text-center">
              <i className="fa-solid fa-heart text-xl text-red-500 mb-2"></i>
              <p className="text-lg font-bold">{Math.floor(Math.random()*100)}</p>
              <p className="text-xs text-gray-500">Favorites</p>
            </div>
            <div className="bg-white rounded-2xl p-4 border text-center">
              <i className="fa-solid fa-percent text-xl text-green-500 mb-2"></i>
              <p className="text-lg font-bold">{stats.totalBookings>0?Math.round((stats.completedBookings/stats.totalBookings)*100):0}%</p>
              <p className="text-xs text-gray-500">Success</p>
            </div>
          </div>

          {/* Profile Info */}
          <h2 className="font-bold mb-4">Business Info</h2>
          <div className="space-y-3">
            {[
              {icon:'fa-store',label:'Business Name',value:provider.businessName},
              {icon:'fa-tag',label:'Category',value:cat?.name||'N/A'},
              {icon:'fa-location-dot',label:'Location',value:`${provider.cityName||''}, ${provider.countryName||''}`},
              {icon:'fa-map-pin',label:'Address',value:provider.address},
              {icon:'fa-star',label:'Rating',value:`${provider.rating||'New'} (${provider.reviewCount||0} reviews)`},
            ].map(item=>(
              <div key={item.label} className="bg-white rounded-2xl p-4 border shadow-sm flex items-center gap-4">
                <div className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center shrink-0">
                  <i className={`fa-solid ${item.icon} text-gray-500`}></i>
                </div>
                <div className="flex-1 min-w-0">
                  <p className="text-xs text-gray-400">{item.label}</p>
                  <p className="font-medium truncate">{item.value}</p>
                </div>
              </div>
            ))}
          </div>

          {/* Actions */}
          <div className="mt-6 space-y-3">
            <button onClick={()=>setEditProfile(true)} className="w-full py-4 bg-gray-100 rounded-2xl font-bold flex items-center justify-center gap-2">
              <i className="fa-solid fa-pen"></i>Edit Profile
            </button>
            <button onClick={onLogout} className="w-full py-4 bg-red-50 text-red-500 rounded-2xl font-bold flex items-center justify-center gap-2">
              <i className="fa-solid fa-right-from-bracket"></i>Log Out
            </button>
          </div>
        </div>

        {/* Gallery Modal */}
        {showGalleryModal&&(
          <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
            <div className="p-5 border-b flex items-center justify-between">
              <div className="flex items-center gap-4">
                <button onClick={()=>setShowGalleryModal(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
                  <i className="fa-solid fa-arrow-left text-gray-600"></i>
                </button>
                <h1 className="text-xl font-bold">My Gallery</h1>
              </div>
              <button onClick={()=>galleryPhotoRef.current?.click()} disabled={gallery.length>=20} className="px-4 py-2 gradient-primary text-white rounded-xl text-sm font-bold disabled:opacity-50">
                <i className="fa-solid fa-plus mr-2"></i>Add Photo
              </button>
            </div>
            <div className="flex-1 overflow-y-auto p-5">
              {gallery.length>0?(
                <div className="grid grid-cols-2 gap-3">
                  {gallery.map(img=>(
                    <div key={img.id} className="relative group">
                      <div className="aspect-square rounded-2xl overflow-hidden">
                        <img src={img.url} className="w-full h-full object-cover"/>
                      </div>
                      <button onClick={()=>{DB.removeFromGallery(provider.id,img.id);toast.show('Photo removed','success');setRefresh(r=>r+1)}} className="absolute top-2 right-2 w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-opacity">
                        <i className="fa-solid fa-trash text-xs"></i>
                      </button>
                      {img.caption&&<p className="mt-2 text-sm text-gray-600">{img.caption}</p>}
                    </div>
                  ))}
                </div>
              ):(
                <div className="text-center py-16">
                  <i className="fa-solid fa-images text-6xl text-gray-200 mb-4"></i>
                  <p className="text-gray-500 font-medium">No photos yet</p>
                  <p className="text-sm text-gray-400 mt-1">Add your work samples to attract customers</p>
                </div>
              )}
            </div>
          </div>
        )}
      </div>
    );
  };

  // PLAN I: Reviews Management for Professional
  const[showReplyModal,setShowReplyModal]=useState(false);
  const[replyingTo,setReplyingTo]=useState(null);
  const[replyText,setReplyText]=useState('');

  const renderReviews=()=>{
    const myReviews=DB.getProviderReviews(provider.id);
    const analytics=DB.getRatingAnalytics(provider.id);
    
    return(
      <div className="p-5 pb-32 anim-fade">
        <h1 className="text-2xl font-bold mb-6">Reviews & Ratings</h1>

        {/* Rating Analytics (Module 54) */}
        <div className="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-3xl p-5 mb-6">
          <div className="flex items-center gap-6">
            <div className="text-center">
              <div className="text-5xl font-bold text-yellow-600">{analytics.average||0}</div>
              <div className="flex justify-center mt-1">
                {[1,2,3,4,5].map(i=><i key={i} className={`fa-solid fa-star text-sm ${i<=Math.round(analytics.average)?'text-yellow-400':'text-gray-300'}`}></i>)}
              </div>
              <p className="text-xs text-gray-500 mt-1">{analytics.total} reviews</p>
            </div>
            <div className="flex-1 space-y-1.5">
              {[5,4,3,2,1].map(star=>(
                <div key={star} className="flex items-center gap-2">
                  <span className="text-xs w-3">{star}</span>
                  <i className="fa-solid fa-star text-xs text-yellow-400"></i>
                  <div className="flex-1 h-2 bg-white rounded-full overflow-hidden">
                    <div className="h-full bg-yellow-400 rounded-full" style={{width:`${analytics.percentages[star]||0}%`}}></div>
                  </div>
                  <span className="text-xs text-gray-500 w-8">{analytics.percentages[star]||0}%</span>
                </div>
              ))}
            </div>
          </div>

          {/* Additional Stats */}
          <div className="grid grid-cols-3 gap-3 mt-4 pt-4 border-t border-yellow-200">
            <div className="text-center">
              <p className="text-lg font-bold text-yellow-600">{analytics.withPhotos}</p>
              <p className="text-xs text-gray-500">With Photos</p>
            </div>
            <div className="text-center">
              <p className="text-lg font-bold text-green-600">{analytics.responseRate}%</p>
              <p className="text-xs text-gray-500">Response Rate</p>
            </div>
            <div className="text-center">
              <p className="text-lg font-bold flex items-center justify-center gap-1">
                {analytics.recentTrend==='up'?<i className="fa-solid fa-arrow-up text-green-500"></i>:analytics.recentTrend==='down'?<i className="fa-solid fa-arrow-down text-red-500"></i>:<i className="fa-solid fa-minus text-gray-400"></i>}
              </p>
              <p className="text-xs text-gray-500">Trend</p>
            </div>
          </div>

          {/* Top Rated Badge (Module 55) */}
          {provider.topRated&&(
            <div className="mt-4 bg-white rounded-2xl p-3 flex items-center gap-3">
              <div className="w-10 h-10 bg-yellow-400 rounded-full flex items-center justify-center">
                <i className="fa-solid fa-trophy text-white"></i>
              </div>
              <div>
                <p className="font-bold text-sm">Top Rated! ðŸ†</p>
                <p className="text-xs text-gray-500">You're in the top providers!</p>
              </div>
            </div>
          )}
        </div>

        {/* Reviews List */}
        <h2 className="font-bold mb-4">All Reviews ({myReviews.length})</h2>
        {myReviews.length>0?(
          <div className="space-y-4">
            {myReviews.map(r=>{
              const customer=DB.getUserById(r.userId);
              return(
                <div key={r.id} className="bg-white rounded-2xl p-4 border shadow-sm">
                  <div className="flex items-start justify-between mb-2">
                    <div className="flex items-center gap-3">
                      <div className="w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center font-bold text-pink-600">
                        {r.userName?.charAt(0)||customer?.name?.charAt(0)||'C'}
                      </div>
                      <div>
                        <p className="font-bold text-sm">{r.userName||customer?.name||'Customer'}</p>
                        <div className="flex items-center gap-2">
                          <div className="flex">{[1,2,3,4,5].map(i=><i key={i} className={`fa-solid fa-star text-xs ${i<=r.rating?'text-yellow-400':'text-gray-300'}`}></i>)}</div>
                          <span className="text-xs text-gray-400">{new Date(r.createdAt).toLocaleDateString()}</span>
                        </div>
                      </div>
                    </div>
                    {r.helpful>0&&(
                      <span className="text-xs text-gray-400"><i className="fa-solid fa-thumbs-up mr-1"></i>{r.helpful}</span>
                    )}
                  </div>
                  
                  <p className="text-sm text-gray-600 mb-3">{r.text}</p>
                  
                  {r.photos&&r.photos.length>0&&(
                    <div className="flex gap-2 mb-3 overflow-x-auto">
                      {r.photos.map(p=><img key={p.id} src={p.url} className="w-16 h-16 rounded-lg object-cover shrink-0"/>)}
                    </div>
                  )}

                  {/* Provider Reply */}
                  {r.reply?(
                    <div className="bg-blue-50 rounded-xl p-3 border-l-4 border-blue-400">
                      <div className="flex items-center gap-2 mb-1">
                        <i className="fa-solid fa-reply text-blue-500 text-xs"></i>
                        <span className="text-xs font-bold text-blue-600">Your Reply</span>
                        <span className="text-xs text-gray-400">{new Date(r.reply.createdAt).toLocaleDateString()}</span>
                      </div>
                      <p className="text-sm text-gray-600">{r.reply.text}</p>
                    </div>
                  ):(
                    <button onClick={()=>{setReplyingTo(r);setShowReplyModal(true)}} className="text-sm text-pink-500 font-bold flex items-center gap-1">
                      <i className="fa-solid fa-reply"></i>Reply
                    </button>
                  )}
                </div>
              );
            })}
          </div>
        ):(
          <div className="text-center py-16">
            <i className="fa-solid fa-star text-6xl text-gray-200 mb-4"></i>
            <p className="text-gray-500 font-medium">No reviews yet</p>
            <p className="text-sm text-gray-400 mt-1">Reviews will appear after customers rate you</p>
          </div>
        )}

        {/* Reply Modal (Module 52) */}
        {showReplyModal&&replyingTo&&(
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50">
            <div className="bg-white rounded-3xl p-5 w-full max-w-md anim-scale">
              <h3 className="text-lg font-bold mb-4">Reply to Review</h3>
              
              {/* Original Review */}
              <div className="bg-gray-50 rounded-xl p-3 mb-4">
                <div className="flex items-center gap-2 mb-2">
                  <div className="flex">{[1,2,3,4,5].map(i=><i key={i} className={`fa-solid fa-star text-xs ${i<=replyingTo.rating?'text-yellow-400':'text-gray-300'}`}></i>)}</div>
                  <span className="text-xs text-gray-500">by {replyingTo.userName||'Customer'}</span>
                </div>
                <p className="text-sm text-gray-600">{replyingTo.text}</p>
              </div>

              <textarea value={replyText} onChange={e=>setReplyText(e.target.value)} placeholder="Write your reply..." className="w-full p-4 bg-gray-100 rounded-2xl resize-none h-28 outline-none focus:ring-2 ring-pink-200 mb-4"/>

              <div className="flex gap-3">
                <button onClick={()=>{setShowReplyModal(false);setReplyingTo(null);setReplyText('')}} className="flex-1 py-3 bg-gray-100 rounded-xl font-bold">Cancel</button>
                <button onClick={()=>{
                  if(!replyText.trim()){toast.show('Write a reply','warning');return}
                  DB.replyToReview(replyingTo.id,replyText,provider.businessName);
                  toast.show('Reply sent! ðŸ’¬','success');
                  setShowReplyModal(false);setReplyingTo(null);setReplyText('');
                  setRefresh(x=>x+1);
                }} disabled={!replyText.trim()} className="flex-1 py-3 gradient-primary text-white rounded-xl font-bold disabled:opacity-50">
                  Send Reply
                </button>
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  // Bottom Navigation - filtered by appSettings
  const allNavItems=[
    {id:'dashboard',icon:'fa-chart-pie',label:'Home'},
    {id:'bookings',icon:'fa-calendar-check',label:'Bookings'},
    {id:'services',icon:'fa-concierge-bell',label:'Services'},
    {id:'reviews',icon:'fa-star',label:'Reviews'},
    {id:'earnings',icon:'fa-wallet',label:'Earnings'},
    {id:'profile',icon:'fa-user',label:'Profile'}
  ];
  const navItems=allNavItems.filter(n=>appSettings.proNav?.[n.id]!==false);

  return(
    <div className="flex-1 overflow-y-auto bg-gray-50 h-full smooth-scroll">
      {tab==='dashboard'&&renderDashboard()}
      {tab==='bookings'&&renderBookings()}
      {tab==='services'&&renderServices()}
      {tab==='reviews'&&renderReviews()}
      {tab==='earnings'&&renderEarnings()}
      {tab==='availability'&&renderAvailability()}
      {tab==='profile'&&renderProfile()}
      
      {/* Bottom Nav - Compact & Glassy */}
      <div className="fixed bottom-3 left-1/2 -translate-x-1/2 w-[92%] max-w-sm z-50">
        <div className="glass-nav rounded-2xl px-1 py-1.5 flex justify-around items-center">
          {navItems.map(item=>(
            <button key={item.id} onClick={()=>setTab(item.id)} className={`flex flex-col items-center justify-center px-2 py-1.5 rounded-xl transition-all ${tab===item.id?'bg-white/15 text-white':'text-gray-400'}`}>
              <i className={`fa-solid ${item.icon} text-[12px]`}></i>
              <span className="text-[8px] font-medium mt-0.5">{item.label}</span>
            </button>
          ))}
        </div>
      </div>

      {/* Pro Chat List */}
      {showProChat&&!activeProChat&&(
        <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
          <div className="p-5 border-b flex items-center gap-4">
            <button onClick={()=>setShowProChat(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
              <i className="fa-solid fa-arrow-left text-gray-600"></i>
            </button>
            <h1 className="text-xl font-bold">Customer Messages</h1>
          </div>
          <div className="flex-1 overflow-y-auto">
            {DB.getProviderChats(provider.id).length>0?(
              <div className="divide-y">
                {DB.getProviderChats(provider.id).map(chat=>(
                  <button key={chat.id} onClick={()=>setActiveProChat(chat)} className="w-full p-4 flex items-center gap-4 hover:bg-gray-50 text-left">
                    <div className="relative">
                      <div className="w-14 h-14 rounded-2xl bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center text-pink-600 font-bold text-lg">
                        {chat.user?.name?.charAt(0)||'C'}
                      </div>
                      {chat.unreadProvider>0&&<span className="absolute -top-1 -right-1 w-5 h-5 bg-pink-500 text-white text-xs rounded-full flex items-center justify-center">{chat.unreadProvider}</span>}
                    </div>
                    <div className="flex-1 min-w-0">
                      <div className="flex justify-between items-center">
                        <h3 className="font-bold truncate">{chat.user?.name||'Customer'}</h3>
                        <span className="text-xs text-gray-400">{chat.lastMessageAt?new Date(chat.lastMessageAt).toLocaleDateString():''}</span>
                      </div>
                      <p className="text-sm text-gray-500 truncate">{chat.lastMessage||'Start a conversation'}</p>
                    </div>
                  </button>
                ))}
              </div>
            ):(
              <div className="flex flex-col items-center justify-center h-full text-center p-8">
                <i className="fa-solid fa-comments text-6xl text-gray-200 mb-4"></i>
                <p className="text-gray-500 font-medium">No messages yet</p>
                <p className="text-sm text-gray-400 mt-1">Messages from customers will appear here</p>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Pro Chat Window */}
      {activeProChat&&(
        <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
          <div className="p-4 border-b flex items-center gap-4">
            <button onClick={()=>setActiveProChat(null)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
              <i className="fa-solid fa-arrow-left text-gray-600"></i>
            </button>
            <div className="w-11 h-11 rounded-xl bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center text-pink-600 font-bold">
              {activeProChat.user?.name?.charAt(0)||'C'}
            </div>
            <div className="flex-1">
              <h3 className="font-bold">{activeProChat.user?.name||'Customer'}</h3>
              <p className="text-xs text-green-500"><i className="fa-solid fa-circle text-[6px] mr-1"></i>Online</p>
            </div>
          </div>
          
          <div className="flex-1 overflow-y-auto p-4 bg-gray-50">
            {DB.getChatMessages(activeProChat.id).length===0&&(
              <div className="text-center py-8"><p className="text-gray-400 text-sm">Start the conversation!</p></div>
            )}
            {DB.getChatMessages(activeProChat.id).map(msg=>(
              <div key={msg.id} className={`flex mb-3 ${msg.senderType==='provider'?'justify-end':'justify-start'}`}>
                <div className={`max-w-[75%] px-4 py-3 rounded-2xl ${msg.senderType==='provider'?'gradient-primary text-white rounded-br-md':'bg-white border rounded-bl-md'}`}>
                  <p className="text-sm">{msg.text}</p>
                  <p className={`text-[10px] mt-1 ${msg.senderType==='provider'?'text-white/70':'text-gray-400'}`}>{new Date(msg.createdAt).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</p>
                </div>
              </div>
            ))}
          </div>

          <div className="p-4 border-t bg-white">
            <div className="flex gap-2 overflow-x-auto pb-3 no-scrollbar">
              {DB.getQuickReplies().map(qr=>(
                <button key={qr.id} onClick={()=>setProChatMessage(qr.text)} className="shrink-0 px-3 py-1.5 bg-gray-100 rounded-full text-xs font-medium text-gray-600">{qr.text}</button>
              ))}
            </div>
            <div className="flex gap-2">
              <input type="text" value={proChatMessage} onChange={e=>setProChatMessage(e.target.value)} onKeyPress={e=>{if(e.key==='Enter'&&proChatMessage.trim()){DB.sendMessage(activeProChat.id,provider.id,'provider',proChatMessage);setProChatMessage('');setActiveProChat({...activeProChat,messages:DB.getChatMessages(activeProChat.id)})}}} placeholder="Type a message..." className="flex-1 px-4 py-3 bg-gray-100 rounded-xl outline-none text-sm"/>
              <button onClick={()=>{if(proChatMessage.trim()){DB.sendMessage(activeProChat.id,provider.id,'provider',proChatMessage);setProChatMessage('');setActiveProChat({...activeProChat,messages:DB.getChatMessages(activeProChat.id)})}}} disabled={!proChatMessage.trim()} className="w-11 h-11 gradient-primary rounded-xl flex items-center justify-center shrink-0 disabled:opacity-50">
                <i className="fa-solid fa-paper-plane text-white"></i>
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Pro Notifications */}
      {showProNotifications&&(
        <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
          <div className="p-5 border-b">
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center gap-4">
                <button onClick={()=>setShowProNotifications(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
                  <i className="fa-solid fa-arrow-left text-gray-600"></i>
                </button>
                <div>
                  <h1 className="text-xl font-bold">Notifications</h1>
                  <p className="text-xs text-gray-500">{DB.getUnreadNotificationCount(null,provider.id)} unread</p>
                </div>
              </div>
              <button onClick={()=>{DB.markAllNotificationsRead(null,provider.id);setRefresh(r=>r+1)}} className="text-sm text-pink-500 font-bold">Mark all read</button>
            </div>
            
            {/* Quick Stats */}
            <div className="flex gap-3">
              <div className="flex-1 bg-blue-50 rounded-xl p-3 text-center">
                <p className="text-lg font-bold text-blue-600">{DB.getNotificationStats(null,provider.id).today}</p>
                <p className="text-[10px] text-gray-500">Today</p>
              </div>
              <div className="flex-1 bg-green-50 rounded-xl p-3 text-center">
                <p className="text-lg font-bold text-green-600">{DB.getProviderNotifications(provider.id).filter(n=>n.type?.includes('booking')).length}</p>
                <p className="text-[10px] text-gray-500">Bookings</p>
              </div>
              <div className="flex-1 bg-yellow-50 rounded-xl p-3 text-center">
                <p className="text-lg font-bold text-yellow-600">{DB.getProviderNotifications(provider.id).filter(n=>n.type?.includes('review')).length}</p>
                <p className="text-[10px] text-gray-500">Reviews</p>
              </div>
            </div>
          </div>
          <div className="flex-1 overflow-y-auto">
            {DB.getProviderNotifications(provider.id).length>0?(
              <div className="divide-y">
                {DB.getProviderNotifications(provider.id).map(notif=>{
                  const typeInfo=DB.notificationTypes[notif.type]||{icon:'fa-bell',color:'gray'};
                  const timeAgo=(date)=>{
                    const diff=(Date.now()-new Date(date))/1000;
                    if(diff<60)return 'Just now';
                    if(diff<3600)return Math.floor(diff/60)+'m ago';
                    if(diff<86400)return Math.floor(diff/3600)+'h ago';
                    return Math.floor(diff/86400)+'d ago';
                  };
                  return(
                    <div key={notif.id} className={`p-4 flex gap-4 ${!notif.read?'bg-pink-50/50':''}`}>
                      <div className={`w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 ${typeInfo.color==='green'?'bg-green-100 text-green-600':typeInfo.color==='red'?'bg-red-100 text-red-600':typeInfo.color==='blue'?'bg-blue-100 text-blue-600':typeInfo.color==='yellow'?'bg-yellow-100 text-yellow-600':typeInfo.color==='purple'?'bg-purple-100 text-purple-600':'bg-gray-100 text-gray-600'}`}>
                        <i className={`fa-solid ${typeInfo.icon} text-lg`}></i>
                      </div>
                      <div className="flex-1 min-w-0">
                        <div className="flex justify-between items-start">
                          <h3 className={`font-bold text-sm ${!notif.read?'text-gray-900':'text-gray-600'}`}>{notif.title}</h3>
                          <span className="text-[10px] text-gray-400 shrink-0">{timeAgo(notif.createdAt)}</span>
                        </div>
                        <p className="text-sm text-gray-500 mt-0.5">{notif.message}</p>
                        {!notif.read&&(
                          <button onClick={()=>{DB.markNotificationRead(notif.id);setRefresh(r=>r+1)}} className="text-xs text-pink-500 font-medium mt-2">Mark as read</button>
                        )}
                      </div>
                      <button onClick={()=>{DB.deleteNotification(notif.id);setRefresh(r=>r+1)}} className="text-gray-300 hover:text-red-500 shrink-0">
                        <i className="fa-solid fa-trash text-xs"></i>
                      </button>
                    </div>
                  );
                })}
              </div>
            ):(
              <div className="flex flex-col items-center justify-center h-full text-center p-8">
                <i className="fa-solid fa-bell-slash text-6xl text-gray-200 mb-4"></i>
                <p className="text-gray-500 font-medium">No notifications yet</p>
                <p className="text-xs text-gray-400 mt-1">You'll be notified of new bookings and reviews</p>
              </div>
            )}
          </div>
          {DB.getProviderNotifications(provider.id).length>0&&(
            <div className="p-4 border-t">
              <button onClick={()=>{DB.clearNotifications(null,provider.id);setRefresh(r=>r+1)}} className="w-full py-3 bg-gray-100 rounded-xl text-sm font-bold text-gray-600">
                <i className="fa-solid fa-trash mr-2"></i>Clear All
              </button>
            </div>
          )}
        </div>
      )}

      {/* Pro Edit Profile Modal */}
      {editProfile&&(
        <div className="fixed inset-0 z-50 bg-white anim-fade flex flex-col">
          <div className="p-4 border-b flex items-center gap-4">
            <button onClick={()=>setEditProfile(false)} className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
              <i className="fa-solid fa-arrow-left text-gray-600"></i>
            </button>
            <h1 className="text-lg font-bold">Edit Business Profile</h1>
          </div>
          <div className="flex-1 overflow-y-auto p-4">
            {/* Business Name */}
            <div className="mb-4">
              <label className="text-xs text-gray-500 mb-1 block">Business Name</label>
              <input type="text" defaultValue={provider.businessName} id="proEditName" className="w-full p-3 bg-gray-50 rounded-xl border outline-none focus:border-pink-500 text-sm"/>
            </div>
            
            {/* Owner Name */}
            <div className="mb-4">
              <label className="text-xs text-gray-500 mb-1 block">Owner Name</label>
              <input type="text" defaultValue={provider.ownerName} id="proEditOwner" className="w-full p-3 bg-gray-50 rounded-xl border outline-none focus:border-pink-500 text-sm"/>
            </div>
            
            {/* Phone */}
            <div className="mb-4">
              <label className="text-xs text-gray-500 mb-1 block">Phone Number</label>
              <input type="tel" defaultValue={provider.phone} id="proEditPhone" className="w-full p-3 bg-gray-50 rounded-xl border outline-none focus:border-pink-500 text-sm"/>
            </div>
            
            {/* Address */}
            <div className="mb-4">
              <label className="text-xs text-gray-500 mb-1 block">Full Address</label>
              <input type="text" defaultValue={provider.address} id="proEditAddress" className="w-full p-3 bg-gray-50 rounded-xl border outline-none focus:border-pink-500 text-sm"/>
            </div>
            
            {/* Description */}
            <div className="mb-4">
              <label className="text-xs text-gray-500 mb-1 block">Business Description</label>
              <textarea defaultValue={provider.description||''} id="proEditDesc" rows="3" className="w-full p-3 bg-gray-50 rounded-xl border outline-none focus:border-pink-500 text-sm resize-none"/>
            </div>
            
            {/* Home Service Toggle */}
            <div className="mb-4 flex items-center justify-between bg-gray-50 rounded-xl p-4">
              <div>
                <p className="font-medium text-sm">Home Service Available</p>
                <p className="text-xs text-gray-500">Offer services at customer's location</p>
              </div>
              <button onClick={()=>{
                DB.updateProvider(provider.id,{homeService:!provider.homeService});
                toast.show(provider.homeService?'Home service disabled':'Home service enabled','success');
                setRefresh(r=>r+1);
              }} className={`w-12 h-7 rounded-full transition-all ${provider.homeService?'bg-green-500':'bg-gray-300'}`}>
                <div className={`w-5 h-5 bg-white rounded-full shadow transition-all ${provider.homeService?'ml-6':'ml-1'}`}></div>
              </button>
            </div>
          </div>
          <div className="p-4 border-t">
            <button onClick={()=>{
              const name=document.getElementById('proEditName')?.value;
              const owner=document.getElementById('proEditOwner')?.value;
              const phone=document.getElementById('proEditPhone')?.value;
              const address=document.getElementById('proEditAddress')?.value;
              const desc=document.getElementById('proEditDesc')?.value;
              
              if(!name||!owner||!phone||!address){
                toast.show('Please fill all required fields','warning');
                return;
              }
              
              DB.updateProvider(provider.id,{
                businessName:name,
                ownerName:owner,
                phone:phone,
                address:address,
                description:desc
              });
              toast.show('Profile updated successfully! âœ…','success');
              setEditProfile(false);
              setRefresh(r=>r+1);
            }} className="w-full py-3 gradient-primary text-white rounded-xl font-bold text-sm">
              Save Changes
            </button>
          </div>
        </div>
      )}
    </div>
  )
};

// ADMIN PANEL
const AdminPanel=({user,onLogout})=>{
  const[sidebarOpen,setSidebarOpen]=useState(true);
  const[currentPage,setCurrentPage]=useState('dashboard');
  const[editModal,setEditModal]=useState({open:false,type:null,data:null});
  const toast=useToast();

  const stats=DB.getStats();
  const users=DB.getUsers().filter(u=>u.role!=='admin');
  const providers=DB.getProviders();
  const categories=DB.getCategories();
  const services=DB.getServices();
  const bookings=DB.getBookings();

  const menuItems=[{id:'dashboard',icon:'dashboard',label:'Dashboard'},{id:'users',icon:'users',label:'Users'},{id:'providers',icon:'store',label:'Providers'},{id:'categories',icon:'categories',label:'Categories'},{id:'services',icon:'services',label:'Services'},{id:'bookings',icon:'bookings',label:'Bookings'}];

  const Sidebar=()=>(
    <div className={`${sidebarOpen?'w-64':'w-20'} bg-gray-900 text-white h-full flex flex-col transition-all duration-300`}>
      <div className="p-6 flex items-center gap-3">
        <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center shrink-0"><Icon name="spa"/></div>
        {sidebarOpen&&<span className="text-xl font-bold">GoBeauty</span>}
      </div>
      <nav className="flex-1 px-4">
        {menuItems.map(item=>(
          <button key={item.id} onClick={()=>setCurrentPage(item.id)} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl mb-1 ${currentPage===item.id?'bg-white/10 text-white':'text-gray-400 hover:bg-white/5'}`}>
            <Icon name={item.icon}/>
            {sidebarOpen&&<span className="font-medium">{item.label}</span>}
          </button>
        ))}
      </nav>
      <div className="p-4 border-t border-gray-800">
        <button onClick={onLogout} className="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-400 hover:bg-red-500/10">
          <Icon name="logout"/>
          {sidebarOpen&&<span className="font-medium">Logout</span>}
        </button>
      </div>
    </div>
  );

  const Header=()=>(
    <div className="bg-white border-b px-6 py-4 flex items-center justify-between">
      <div className="flex items-center gap-4">
        <button onClick={()=>setSidebarOpen(!sidebarOpen)} className="w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center"><Icon name="bars"/></button>
        <h1 className="text-xl font-bold capitalize">{currentPage}</h1>
      </div>
      <div className="flex items-center gap-3">
        <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center text-white font-bold">A</div>
        <div className="hidden md:block"><p className="font-bold text-sm">{user.name}</p><p className="text-xs text-gray-500">Admin</p></div>
      </div>
    </div>
  );

  const StatCard=({icon,value,label,color})=>(
    <div className="bg-white rounded-2xl p-6 border shadow-sm">
      <div className={`w-12 h-12 rounded-xl ${color} flex items-center justify-center mb-4`}><Icon name={icon} className="text-xl text-white"/></div>
      <p className="text-3xl font-bold">{value}</p>
      <p className="text-sm text-gray-500 mt-1">{label}</p>
    </div>
  );

  const DataTable=({columns,data,actions})=>(
    <div className="bg-white rounded-2xl border shadow-sm overflow-hidden">
      <div className="overflow-x-auto">
        <table className="w-full">
          <thead className="bg-gray-50 border-b">
            <tr>{columns.map(c=><th key={c.key} className="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase">{c.label}</th>)}{actions&&<th className="px-6 py-4 text-right text-xs font-bold text-gray-500 uppercase">Actions</th>}</tr>
          </thead>
          <tbody className="divide-y">
            {data.map((row,i)=>(
              <tr key={i} className="hover:bg-gray-50">
                {columns.map(c=><td key={c.key} className="px-6 py-4 text-sm text-gray-700">{c.render?c.render(row[c.key],row):row[c.key]}</td>)}
                {actions&&<td className="px-6 py-4 text-right"><div className="flex items-center justify-end gap-2">{actions(row)}</div></td>}
              </tr>
            ))}
          </tbody>
        </table>
      </div>
      {data.length===0&&<div className="p-12 text-center"><Icon name="info" className="text-4xl text-gray-300 mb-2"/><p className="text-gray-500">No data</p></div>}
    </div>
  );

  const renderDashboard=()=>(
    <div className="p-6">
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <StatCard icon="users" value={stats.totalUsers} label="Total Users" color="bg-blue-500"/>
        <StatCard icon="store" value={stats.totalProviders} label="Total Providers" color="bg-purple-500"/>
        <StatCard icon="calendar" value={stats.totalBookings} label="Total Bookings" color="bg-pink-500"/>
        <StatCard icon="money" value={`Rs. ${stats.totalRevenue}`} label="Revenue" color="bg-green-500"/>
      </div>
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div className="bg-white rounded-2xl p-6 border shadow-sm">
          <h3 className="font-bold mb-4">Booking Status</h3>
          <div className="space-y-4">
            <div className="flex justify-between items-center"><span className="text-gray-600">Pending</span><span className="font-bold">{stats.pendingBookings}</span></div>
            <div className="flex justify-between items-center"><span className="text-gray-600">Completed</span><span className="font-bold">{stats.completedBookings}</span></div>
            <div className="flex justify-between items-center"><span className="text-gray-600">Cancelled</span><span className="font-bold">{stats.cancelledBookings}</span></div>
          </div>
        </div>
        <div className="bg-white rounded-2xl p-6 border shadow-sm">
          <h3 className="font-bold mb-4">Provider Status</h3>
          <div className="space-y-4">
            <div className="flex justify-between items-center"><span className="text-gray-600">Active</span><span className="font-bold">{stats.activeProviders}</span></div>
            <div className="flex justify-between items-center"><span className="text-gray-600">Pending Approval</span><span className="font-bold">{stats.pendingProviders}</span></div>
          </div>
        </div>
      </div>
    </div>
  );

  const renderUsers=()=>(
    <div className="p-6">
      <h2 className="text-xl font-bold mb-6">Manage Users</h2>
      <DataTable
        columns={[
          {key:'name',label:'Name'},
          {key:'email',label:'Email'},
          {key:'role',label:'Role',render:v=><span className={`px-2 py-1 rounded-lg text-xs font-bold ${v==='professional'?'bg-purple-100 text-purple-600':'bg-blue-100 text-blue-600'}`}>{v}</span>},
          {key:'status',label:'Status',render:v=><span className={`px-2 py-1 rounded-lg text-xs font-bold ${v==='active'?'bg-green-100 text-green-600':'bg-red-100 text-red-600'}`}>{v}</span>}
        ]}
        data={users}
        actions={row=><button onClick={()=>{DB.updateUser(row.id,{status:row.status==='active'?'blocked':'active'});toast.show('Updated!','success')}} className={`px-3 py-1 rounded-lg text-xs font-bold ${row.status==='active'?'bg-red-100 text-red-600':'bg-green-100 text-green-600'}`}>{row.status==='active'?'Block':'Unblock'}</button>}
      />
    </div>
  );

  const renderProviders=()=>(
    <div className="p-6">
      <h2 className="text-xl font-bold mb-6">Manage Providers</h2>
      <DataTable
        columns={[
          {key:'businessName',label:'Business'},
          {key:'categoryId',label:'Category',render:v=>categories.find(c=>c.id===v)?.name||'N/A'},
          {key:'rating',label:'Rating',render:v=>v||'New'},
          {key:'status',label:'Status',render:v=><span className={`px-2 py-1 rounded-lg text-xs font-bold ${v==='approved'?'bg-green-100 text-green-600':v==='pending'?'bg-yellow-100 text-yellow-600':'bg-red-100 text-red-600'}`}>{v}</span>}
        ]}
        data={providers}
        actions={row=>(
          <>
            {row.status==='pending'&&<button onClick={()=>{DB.updateProvider(row.id,{status:'approved'});toast.show('Approved!','success')}} className="px-3 py-1 rounded-lg text-xs font-bold bg-green-100 text-green-600">Approve</button>}
            <button onClick={()=>{DB.updateProvider(row.id,{status:row.status==='approved'?'suspended':'approved'});toast.show('Updated!','success')}} className={`px-3 py-1 rounded-lg text-xs font-bold ${row.status==='approved'?'bg-red-100 text-red-600':'bg-green-100 text-green-600'}`}>{row.status==='approved'?'Suspend':'Activate'}</button>
          </>
        )}
      />
    </div>
  );

  const renderCategories=()=>(
    <div className="p-6">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-xl font-bold">Manage Categories</h2>
        <button onClick={()=>setEditModal({open:true,type:'category',data:null})} className="px-4 py-2 bg-gray-900 text-white rounded-xl font-bold text-sm flex items-center gap-2"><Icon name="plus"/>Add</button>
      </div>
      <DataTable
        columns={[
          {key:'name',label:'Name'},
          {key:'icon',label:'Icon',render:v=><Icon name={v} className="text-xl text-pink-500"/>},
          {key:'status',label:'Status',render:v=><span className={`px-2 py-1 rounded-lg text-xs font-bold ${v==='active'?'bg-green-100 text-green-600':'bg-red-100 text-red-600'}`}>{v}</span>}
        ]}
        data={categories}
        actions={row=>(
          <>
            <button onClick={()=>setEditModal({open:true,type:'category',data:row})} className="px-3 py-1 rounded-lg text-xs font-bold bg-blue-100 text-blue-600">Edit</button>
            <button onClick={()=>{DB.updateCategory(row.id,{status:row.status==='active'?'inactive':'active'});toast.show('Updated!','success')}} className={`px-3 py-1 rounded-lg text-xs font-bold ${row.status==='active'?'bg-red-100 text-red-600':'bg-green-100 text-green-600'}`}>{row.status==='active'?'Disable':'Enable'}</button>
          </>
        )}
      />
    </div>
  );

  const renderServices=()=>(
    <div className="p-6">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-xl font-bold">Manage Services</h2>
        <button onClick={()=>setEditModal({open:true,type:'service',data:null})} className="px-4 py-2 bg-gray-900 text-white rounded-xl font-bold text-sm flex items-center gap-2"><Icon name="plus"/>Add</button>
      </div>
      <DataTable
        columns={[
          {key:'name',label:'Name'},
          {key:'categoryId',label:'Category',render:v=>categories.find(c=>c.id===v)?.name||'N/A'},
          {key:'basePrice',label:'Price',render:v=>`Rs. ${v}`},
          {key:'duration',label:'Duration',render:v=>`${v} mins`}
        ]}
        data={services}
        actions={row=>(
          <>
            <button onClick={()=>setEditModal({open:true,type:'service',data:row})} className="px-3 py-1 rounded-lg text-xs font-bold bg-blue-100 text-blue-600">Edit</button>
            <button onClick={()=>{DB.deleteService(row.id);toast.show('Deleted!','success')}} className="px-3 py-1 rounded-lg text-xs font-bold bg-red-100 text-red-600">Delete</button>
          </>
        )}
      />
    </div>
  );

  const renderBookings=()=>(
    <div className="p-6">
      <h2 className="text-xl font-bold mb-6">All Bookings</h2>
      <DataTable
        columns={[
          {key:'id',label:'ID',render:v=>v.slice(-8)},
          {key:'userId',label:'Customer',render:v=>DB.getUserById(v)?.name||'N/A'},
          {key:'providerId',label:'Provider',render:v=>providers.find(p=>p.id===v)?.businessName||'N/A'},
          {key:'serviceName',label:'Service'},
          {key:'date',label:'Date'},
          {key:'price',label:'Price',render:v=>`Rs. ${v}`},
          {key:'status',label:'Status',render:v=><span className={`px-2 py-1 rounded-lg text-xs font-bold ${v==='pending'?'bg-yellow-100 text-yellow-600':v==='completed'?'bg-green-100 text-green-600':'bg-gray-100 text-gray-600'}`}>{v}</span>}
        ]}
        data={bookings.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt))}
      />
    </div>
  );

  // Modals
  const CategoryModal=()=>{
    const[form,setForm]=useState(editModal.data||{name:'',icon:'spa',status:'active'});
    const save=()=>{
      if(editModal.data)DB.updateCategory(editModal.data.id,form);
      else DB.addCategory({...form,id:'cat_'+Date.now()});
      toast.show('Saved!','success');
      setEditModal({open:false,type:null,data:null});
    };
    return(
      <Modal isOpen={editModal.open&&editModal.type==='category'} onClose={()=>setEditModal({open:false,type:null,data:null})} title={editModal.data?'Edit Category':'Add Category'}>
        <div className="space-y-4">
          <div><label className="block text-sm font-bold mb-2">Name</label><input value={form.name} onChange={e=>setForm({...form,name:e.target.value})} className="w-full px-4 py-3 border rounded-xl"/></div>
          <div><label className="block text-sm font-bold mb-2">Icon</label><select value={form.icon} onChange={e=>setForm({...form,icon:e.target.value})} className="w-full px-4 py-3 border rounded-xl"><option value="spa">Spa</option><option value="nails">Nails</option><option value="hair">Hair</option><option value="makeup">Makeup</option></select></div>
          <button onClick={save} className="w-full py-3 bg-gray-900 text-white rounded-xl font-bold">Save</button>
        </div>
      </Modal>
    )
  };

  const ServiceModal=()=>{
    const[form,setForm]=useState(editModal.data||{name:'',categoryId:'',basePrice:0,duration:30});
    const save=()=>{
      if(editModal.data)DB.updateService(editModal.data.id,form);
      else DB.addService({...form,id:'srv_'+Date.now()});
      toast.show('Saved!','success');
      setEditModal({open:false,type:null,data:null});
    };
    return(
      <Modal isOpen={editModal.open&&editModal.type==='service'} onClose={()=>setEditModal({open:false,type:null,data:null})} title={editModal.data?'Edit Service':'Add Service'}>
        <div className="space-y-4">
          <div><label className="block text-sm font-bold mb-2">Name</label><input value={form.name} onChange={e=>setForm({...form,name:e.target.value})} className="w-full px-4 py-3 border rounded-xl"/></div>
          <div><label className="block text-sm font-bold mb-2">Category</label><select value={form.categoryId} onChange={e=>setForm({...form,categoryId:e.target.value})} className="w-full px-4 py-3 border rounded-xl"><option value="">Select</option>{categories.map(c=><option key={c.id} value={c.id}>{c.name}</option>)}</select></div>
          <div><label className="block text-sm font-bold mb-2">Price (Rs.)</label><input type="number" value={form.basePrice} onChange={e=>setForm({...form,basePrice:Number(e.target.value)})} className="w-full px-4 py-3 border rounded-xl"/></div>
          <div><label className="block text-sm font-bold mb-2">Duration (mins)</label><input type="number" value={form.duration} onChange={e=>setForm({...form,duration:Number(e.target.value)})} className="w-full px-4 py-3 border rounded-xl"/></div>
          <button onClick={save} className="w-full py-3 bg-gray-900 text-white rounded-xl font-bold">Save</button>
        </div>
      </Modal>
    )
  };

  return(
    <div className="admin-layout h-screen bg-gray-50">
      <Sidebar/>
      <div className="flex-1 flex flex-col overflow-hidden">
        <Header/>
        <div className="flex-1 overflow-y-auto">
          {currentPage==='dashboard'&&renderDashboard()}
          {currentPage==='users'&&renderUsers()}
          {currentPage==='providers'&&renderProviders()}
          {currentPage==='categories'&&renderCategories()}
          {currentPage==='services'&&renderServices()}
          {currentPage==='bookings'&&renderBookings()}
        </div>
      </div>
      <CategoryModal/>
      <ServiceModal/>
    </div>
  )
};

// FORGOT PASSWORD - Premium 2025 UI
const ForgotPasswordScreen=({goLogin})=>{
  const[step,setStep]=useState(1); // 1=email, 2=otp, 3=newPassword
  const[email,setEmail]=useState('');
  const[otp,setOtp]=useState(['','','','','','']);
  const[newPassword,setNewPassword]=useState('');
  const[confirmPassword,setConfirmPassword]=useState('');
  const[loading,setLoading]=useState(false);
  const[error,setError]=useState('');
  const[showPwd,setShowPwd]=useState(false);
  const toast=useToast();
  const otpRefs=[useRef(),useRef(),useRef(),useRef(),useRef(),useRef()];

  const handleSendOtp=async e=>{
    e.preventDefault();
    setError('');
    const user=DB.getUserByEmail(email);
    if(!user){setError('No account found with this email');return}
    setLoading(true);
    await new Promise(r=>setTimeout(r,1000));
    toast.show('OTP sent to your email! ðŸ“§','success');
    setStep(2);
    setLoading(false);
  };

  const handleOtpChange=(index,value)=>{
    if(value.length>1)return;
    const newOtp=[...otp];
    newOtp[index]=value;
    setOtp(newOtp);
    if(value&&index<5)otpRefs[index+1].current?.focus();
  };

  const handleVerifyOtp=async e=>{
    e.preventDefault();
    const code=otp.join('');
    if(code.length!==6){setError('Please enter complete OTP');return}
    setLoading(true);
    await new Promise(r=>setTimeout(r,800));
    // Demo: any 6 digit OTP works
    toast.show('OTP verified! âœ…','success');
    setStep(3);
    setLoading(false);
  };

  const handleResetPassword=async e=>{
    e.preventDefault();
    if(newPassword!==confirmPassword){setError('Passwords do not match');return}
    if(newPassword.length<6){setError('Password must be at least 6 characters');return}
    setLoading(true);
    await new Promise(r=>setTimeout(r,800));
    const user=DB.getUserByEmail(email);
    if(user)DB.updateUser(user.id,{password:newPassword});
    toast.show('Password reset successful! ðŸŽ‰','success');
    setLoading(false);
    goLogin();
  };

  return(
    <div className="flex-1 flex flex-col h-full bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 relative overflow-hidden">
      <div className="blob-1 -top-20 -right-20 opacity-50"></div>
      <div className="blob-2 bottom-20 -left-20 opacity-40"></div>
      
      <div className="flex-1 overflow-y-auto px-6 pt-10 pb-8 z-10">
        {/* Back Button */}
        <button onClick={goLogin} className="flex items-center gap-2 text-gray-500 hover:text-gray-700 font-medium mb-6 anim-fade">
          <i className="fa-solid fa-arrow-left"></i>Back to Login
        </button>

        {/* Header */}
        <div className="text-center mb-8 anim-slide-down">
          <div className="w-20 h-20 gradient-secondary rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-glow-purple">
            <i className={`fa-solid ${step===1?'fa-envelope':step===2?'fa-shield-halved':'fa-lock'} text-3xl text-white`}></i>
          </div>
          <h1 className="text-3xl font-bold text-gray-900">
            {step===1?'Forgot Password':step===2?'Verify OTP':'New Password'}<span className="text-gradient">.</span>
          </h1>
          <p className="text-gray-500 text-sm mt-2 font-medium">
            {step===1?'Enter your email to receive OTP':step===2?'Enter the 6-digit code sent to your email':'Create a new secure password'}
          </p>
        </div>

        {/* Progress */}
        <div className="flex items-center justify-center gap-2 mb-8">
          {[1,2,3].map(s=>(
            <div key={s} className={`w-12 h-1.5 rounded-full transition-all ${step>=s?'gradient-primary':'bg-gray-200'}`}></div>
          ))}
        </div>

        {error&&(
          <div className="bg-red-50 border-2 border-red-100 text-red-600 px-4 py-3 rounded-2xl mb-5 text-sm flex items-center gap-3 anim-scale">
            <i className="fa-solid fa-circle-exclamation text-lg"></i>
            <span className="font-medium">{error}</span>
          </div>
        )}

        {/* Step 1: Email */}
        {step===1&&(
          <form onSubmit={handleSendOtp} className="anim-slide-up">
            <div className="relative mb-6">
              <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <i className="fa-solid fa-envelope text-lg text-gray-400"></i>
              </div>
              <input type="email" value={email} onChange={e=>setEmail(e.target.value)} required placeholder="Email address" className="w-full input-premium"/>
            </div>
            <button type="submit" disabled={loading} className="w-full btn-primary flex justify-center items-center gap-3">
              {loading?<><div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div><span>Sending...</span></>:<><span>Send OTP</span><i className="fa-solid fa-paper-plane"></i></>}
            </button>
          </form>
        )}

        {/* Step 2: OTP */}
        {step===2&&(
          <form onSubmit={handleVerifyOtp} className="anim-slide-up">
            <div className="flex justify-center gap-3 mb-6">
              {otp.map((digit,i)=>(
                <input key={i} ref={otpRefs[i]} type="text" maxLength={1} value={digit} onChange={e=>handleOtpChange(i,e.target.value)} onKeyDown={e=>{if(e.key==='Backspace'&&!digit&&i>0)otpRefs[i-1].current?.focus()}} className="w-12 h-14 text-center text-xl font-bold rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:ring-4 focus:ring-purple-100 outline-none transition-all"/>
              ))}
            </div>
            <p className="text-center text-sm text-gray-500 mb-6">
              Didn't receive code? <button type="button" onClick={()=>toast.show('OTP resent!','success')} className="text-purple-600 font-semibold">Resend</button>
            </p>
            <button type="submit" disabled={loading} className="w-full btn-primary flex justify-center items-center gap-3">
              {loading?<><div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div><span>Verifying...</span></>:<><span>Verify OTP</span><i className="fa-solid fa-check"></i></>}
            </button>
          </form>
        )}

        {/* Step 3: New Password */}
        {step===3&&(
          <form onSubmit={handleResetPassword} className="anim-slide-up space-y-4">
            <div className="relative">
              <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <i className="fa-solid fa-lock text-lg text-gray-400"></i>
              </div>
              <input type={showPwd?"text":"password"} value={newPassword} onChange={e=>setNewPassword(e.target.value)} required placeholder="New Password" minLength={6} className="w-full input-premium pr-12"/>
              <button type="button" onClick={()=>setShowPwd(!showPwd)} className="absolute inset-y-0 right-0 pr-4 flex items-center">
                <i className={`fa-solid ${showPwd?'fa-eye-slash':'fa-eye'} text-gray-400`}></i>
              </button>
            </div>
            <div className="relative">
              <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <i className="fa-solid fa-lock text-lg text-gray-400"></i>
              </div>
              <input type={showPwd?"text":"password"} value={confirmPassword} onChange={e=>setConfirmPassword(e.target.value)} required placeholder="Confirm Password" className="w-full input-premium"/>
            </div>
            <button type="submit" disabled={loading} className="w-full btn-primary flex justify-center items-center gap-3 mt-6">
              {loading?<><div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spinner"></div><span>Resetting...</span></>:<><span>Reset Password</span><i className="fa-solid fa-check"></i></>}
            </button>
          </form>
        )}
      </div>
    </div>
  )
};

// MAIN APP
const App=()=>{
  const[screen,setScreen]=useState('login');
  const[currentUser,setCurrentUser]=useState(null);
  const[toastData,setToastData]=useState(null);
  const[showLogout,setShowLogout]=useState(false);

  const showToast=(message,type='info')=>setToastData({message,type});

  const handleLogin=user=>{
    if(user.role==='admin'){window.location.href='admin.html';return}
    setCurrentUser(user);
    setScreen(user.role==='professional'?'professional':'customer');
  };

  const handleLogout=()=>setShowLogout(true);
  const confirmLogout=()=>{setShowLogout(false);setCurrentUser(null);setScreen('login')};

  return(
    <ToastContext.Provider value={{show:showToast}}>
      <div className="w-full h-full flex flex-col overflow-hidden">
        {(screen==='login'||screen==='register'||screen==='forgot'||screen==='customer'||screen==='professional')&&(
          <div className="mobile-container w-full h-full flex flex-col">
            {screen==='login'&&<LoginScreen onLoggedIn={handleLogin} goRegister={()=>setScreen('register')} goForgotPassword={()=>setScreen('forgot')}/>}
            {screen==='register'&&<RegisterScreen onRegistered={handleLogin} goLogin={()=>setScreen('login')}/>}
            {screen==='forgot'&&<ForgotPasswordScreen goLogin={()=>setScreen('login')}/>}
            {screen==='customer'&&currentUser&&<CustomerApp user={currentUser} onLogout={handleLogout}/>}
            {screen==='professional'&&currentUser&&<ProfessionalApp user={currentUser} onLogout={handleLogout}/>}
          </div>
        )}
        {screen==='admin'&&(window.location.href='admin.html')}
        <ConfirmDialog isOpen={showLogout} onClose={()=>setShowLogout(false)} onConfirm={confirmLogout} title="Log Out" message="Are you sure you want to log out?"/>
        {toastData&&<Toast message={toastData.message} type={toastData.type} onClose={()=>setToastData(null)}/>}
      </div>
    </ToastContext.Provider>
  )
};

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
